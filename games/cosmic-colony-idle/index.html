<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸš€ Cosmic Colony Idle - ìš°ì£¼ ì‹ë¯¼ì§€ ë°©ì¹˜í˜•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0015; --card: #1a0a2e; --accent: #00d4ff;
            --text: #e0e0ff; --sub: #8888cc; --glow: rgba(0,212,255,0.4);
            --red: #ff3366; --green: #00ff88; --yellow: #ffaa00; --purple: #aa00ff;
        }
        body {
            font-family: 'Courier New', monospace;
            background: radial-gradient(circle at 30% 20%, #0f0520 0%, #0a0015 50%, #000000 100%);
            color: var(--text); overflow-x: hidden;
            min-height: 100vh; position: relative;
        }
        /* Stars background */
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.3s; }
        
        /* Main layout */
        .container {
            max-width: 1200px; margin: 0 auto; padding: 15px;
            position: relative; z-index: 1;
        }
        header {
            text-align: center; padding: 20px 0;
            background: linear-gradient(135deg, rgba(26,10,46,0.8), rgba(15,5,32,0.8));
            border-radius: 12px; margin-bottom: 15px;
            border: 1px solid rgba(0,212,255,0.2);
        }
        header h1 {
            font-size: 1.8rem; color: var(--accent);
            text-shadow: 0 0 20px var(--glow);
        }
        .subtitle { font-size: 0.9rem; color: var(--sub); margin-top: 5px; }
        
        /* Resource display */
        .resources {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px; margin-bottom: 15px;
        }
        .resource {
            background: rgba(26,10,46,0.6); padding: 12px;
            border-radius: 8px; text-align: center;
            border: 1px solid rgba(0,212,255,0.2);
            transition: all 0.3s;
        }
        .resource:hover { border-color: var(--accent); transform: scale(1.05); }
        .resource .icon { font-size: 1.5rem; margin-bottom: 5px; }
        .resource .name { font-size: 0.8rem; color: var(--sub); }
        .resource .value {
            font-size: 1.1rem; color: var(--accent); font-weight: bold;
            margin: 3px 0;
        }
        .resource .rate { font-size: 0.7rem; color: var(--green); }
        
        /* Click area */
        .click-area {
            position: relative; height: 250px;
            background: radial-gradient(circle, rgba(170,0,255,0.2), transparent);
            border-radius: 12px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden;
            border: 2px solid rgba(170,0,255,0.3);
            transition: all 0.2s;
        }
        .click-area:active { transform: scale(0.98); }
        .planet {
            width: 150px; height: 150px; border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            box-shadow: 0 0 60px rgba(255,107,53,0.6), inset -20px -20px 40px rgba(0,0,0,0.5);
            position: relative;
            transition: transform 0.1s;
        }
        .planet:active { transform: scale(0.95); }
        .planet::after {
            content: ''; position: absolute; top: 20%; left: 15%;
            width: 30px; height: 30px; background: rgba(0,0,0,0.2);
            border-radius: 50%;
        }
        
        /* Buildings grid */
        .buildings {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 10px; margin-bottom: 15px;
        }
        .building {
            background: rgba(26,10,46,0.7); padding: 12px;
            border-radius: 8px; border: 1px solid rgba(0,212,255,0.15);
            transition: all 0.3s;
        }
        .building:hover { border-color: var(--accent); }
        .building.locked { opacity: 0.5; filter: grayscale(0.8); }
        .building-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px;
        }
        .building-title {
            display: flex; align-items: center; gap: 8px;
        }
        .building-title .icon { font-size: 1.5rem; }
        .building-title .info h3 {
            font-size: 0.95rem; color: var(--accent);
        }
        .building-title .info .count {
            font-size: 0.75rem; color: var(--sub);
        }
        .building-production {
            font-size: 0.8rem; color: var(--green);
            margin-bottom: 6px;
        }
        .building-cost {
            font-size: 0.75rem; color: var(--yellow);
            margin-bottom: 8px;
        }
        .btn {
            width: 100%; padding: 8px;
            background: linear-gradient(135deg, #00d4ff, #0088ff);
            border: none; border-radius: 6px;
            color: white; font-weight: bold; cursor: pointer;
            transition: all 0.2s; font-size: 0.85rem;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px var(--glow); }
        .btn:active { transform: translateY(0); }
        .btn:disabled {
            background: linear-gradient(135deg, #333, #222);
            cursor: not-allowed; opacity: 0.5;
        }
        
        /* Upgrades */
        .upgrades {
            background: rgba(26,10,46,0.5); padding: 15px;
            border-radius: 8px; margin-bottom: 15px;
            border: 1px solid rgba(0,212,255,0.2);
        }
        .upgrades h2 {
            font-size: 1.2rem; color: var(--accent); margin-bottom: 12px;
        }
        .upgrade-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
        }
        .upgrade {
            background: rgba(15,5,32,0.7); padding: 10px;
            border-radius: 6px; border: 1px solid rgba(0,212,255,0.15);
        }
        .upgrade h4 { font-size: 0.85rem; color: var(--accent); margin-bottom: 4px; }
        .upgrade p { font-size: 0.7rem; color: var(--sub); margin-bottom: 6px; }
        .upgrade .cost { font-size: 0.75rem; color: var(--yellow); margin-bottom: 6px; }
        
        /* Prestige */
        .prestige {
            background: linear-gradient(135deg, rgba(170,0,255,0.3), rgba(255,0,170,0.3));
            padding: 15px; border-radius: 12px; text-align: center;
            margin-bottom: 15px; border: 2px solid rgba(170,0,255,0.5);
        }
        .prestige h2 { font-size: 1.3rem; color: #ffaaff; margin-bottom: 8px; }
        .prestige p { font-size: 0.85rem; color: var(--text); margin-bottom: 10px; }
        .prestige .stardust {
            font-size: 1.5rem; color: #ffff00;
            text-shadow: 0 0 10px rgba(255,255,0,0.8);
            margin: 10px 0;
        }
        .prestige .btn {
            background: linear-gradient(135deg, #aa00ff, #ff00aa);
            max-width: 300px; margin: 0 auto;
        }
        
        /* Events */
        .event-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); z-index: 1000;
            display: none; align-items: center; justify-content: center;
        }
        .event-overlay.active { display: flex; }
        .event-popup {
            background: linear-gradient(135deg, #1a0a2e, #0f0520);
            border: 3px solid var(--accent);
            border-radius: 16px; padding: 25px; max-width: 400px;
            text-align: center; position: relative;
            box-shadow: 0 0 40px var(--glow);
        }
        .event-popup h2 {
            font-size: 1.5rem; color: var(--accent);
            margin-bottom: 15px;
        }
        .event-popup p { margin-bottom: 15px; line-height: 1.5; }
        .event-popup .choices {
            display: flex; gap: 10px; justify-content: center;
        }
        .event-popup .btn { max-width: 150px; }
        
        /* Achievements */
        .achievements {
            background: rgba(26,10,46,0.5); padding: 15px;
            border-radius: 8px; margin-bottom: 15px;
        }
        .achievements h2 { font-size: 1.2rem; color: var(--accent); margin-bottom: 10px; }
        .achievement-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 8px;
        }
        .achievement {
            background: rgba(15,5,32,0.7); padding: 8px;
            border-radius: 6px; text-align: center;
            border: 1px solid rgba(0,212,255,0.15);
            transition: all 0.3s;
        }
        .achievement.unlocked {
            border-color: var(--green);
            background: rgba(0,255,136,0.1);
        }
        .achievement .icon { font-size: 1.8rem; }
        .achievement .name { font-size: 0.75rem; color: var(--sub); margin-top: 4px; }
        .achievement.unlocked .name { color: var(--green); }
        
        /* Particles */
        .particle {
            position: absolute; pointer-events: none;
            font-size: 1.2rem; font-weight: bold;
            animation: float-up 1s forwards;
            z-index: 100;
        }
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-60px); }
        }
        
        /* Stats */
        .stats {
            background: rgba(26,10,46,0.5); padding: 12px;
            border-radius: 8px; font-size: 0.8rem;
            color: var(--sub);
        }
        .stats .row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        
        /* Mobile adjustments */
        @media (max-width: 600px) {
            header h1 { font-size: 1.5rem; }
            .resources { grid-template-columns: repeat(2, 1fr); }
            .buildings { grid-template-columns: 1fr; }
            .click-area { height: 200px; }
            .planet { width: 120px; height: 120px; }
        }
        
        /* Tabs */
        .tabs {
            display: flex; gap: 5px; margin-bottom: 15px;
            background: rgba(26,10,46,0.5); padding: 8px;
            border-radius: 8px;
        }
        .tab {
            flex: 1; padding: 10px;
            background: rgba(15,5,32,0.7);
            border: 1px solid rgba(0,212,255,0.15);
            border-radius: 6px; text-align: center;
            cursor: pointer; transition: all 0.2s;
        }
        .tab.active {
            background: linear-gradient(135deg, #00d4ff, #0088ff);
            border-color: var(--accent);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <header>
            <h1>ğŸš€ Cosmic Colony Idle</h1>
            <p class="subtitle">í™©ë¬´ì§€ í–‰ì„±ì— ìš°ì£¼ ì‹ë¯¼ì§€ë¥¼ ê±´ì„¤í•˜ì„¸ìš”</p>
        </header>
        
        <div class="resources" id="resources"></div>
        
        <div class="tabs">
            <div class="tab active" data-tab="main">ğŸ  ì‹ë¯¼ì§€</div>
            <div class="tab" data-tab="upgrades">âš¡ ì—…ê·¸ë ˆì´ë“œ</div>
            <div class="tab" data-tab="achievements">ğŸ† ì—…ì </div>
        </div>
        
        <div class="tab-content active" id="tab-main">
            <div class="click-area" id="clickArea">
                <div class="planet" id="planet"></div>
            </div>
            
            <div class="buildings" id="buildings"></div>
        </div>
        
        <div class="tab-content" id="tab-upgrades">
            <div class="upgrades">
                <h2>âš¡ ì—…ê·¸ë ˆì´ë“œ</h2>
                <div class="upgrade-grid" id="upgradeGrid"></div>
            </div>
        </div>
        
        <div class="tab-content" id="tab-achievements">
            <div class="achievements">
                <h2>ğŸ† ì—…ì </h2>
                <div class="achievement-list" id="achievementList"></div>
            </div>
        </div>
        
        <div class="prestige">
            <h2>âœ¨ ìƒˆ í–‰ì„± íƒì‚¬ (í”„ë ˆìŠ¤í‹°ì§€)</h2>
            <p>ëª¨ë“  ì§„í–‰ë„ë¥¼ ì´ˆê¸°í™”í•˜ê³  ìƒˆë¡œìš´ í–‰ì„±ìœ¼ë¡œ ì´ì£¼í•©ë‹ˆë‹¤</p>
            <div class="stardust">â­ íšë“ ê°€ëŠ¥: <span id="potentialStardust">0</span> ìŠ¤íƒ€ë”ìŠ¤íŠ¸</div>
            <p style="font-size:0.8rem; color: var(--sub);">í˜„ì¬ ë³´ìœ : <span id="currentStardust">0</span> ìŠ¤íƒ€ë”ìŠ¤íŠ¸ (ì˜êµ¬ +<span id="stardustBonus">0</span>% ìƒì‚°ëŸ‰)</p>
            <button class="btn" id="prestigeBtn">ğŸš€ ìƒˆ í–‰ì„±ìœ¼ë¡œ ì¶œë°œ</button>
        </div>
        
        <div class="stats">
            <h3 style="margin-bottom: 8px; color: var(--accent);">ğŸ“Š í†µê³„</h3>
            <div class="row"><span>ì´ í´ë¦­ ìˆ˜:</span> <span id="statClicks">0</span></div>
            <div class="row"><span>ì´ ê±´ë¬¼ ìˆ˜:</span> <span id="statBuildings">0</span></div>
            <div class="row"><span>íƒì‚¬ íšŸìˆ˜:</span> <span id="statPrestiges">0</span></div>
            <div class="row"><span>í”Œë ˆì´ ì‹œê°„:</span> <span id="statTime">0ì´ˆ</span></div>
        </div>
    </div>
    
    <div class="event-overlay" id="eventOverlay">
        <div class="event-popup" id="eventPopup"></div>
    </div>
    
    <script>
        // === Game State ===
        const game = {
            resources: {
                minerals: 0,
                energy: 0,
                food: 0,
                research: 0
            },
            buildings: {},
            upgrades: {},
            achievements: {},
            stardust: 0,
            stats: {
                totalClicks: 0,
                totalBuildings: 0,
                prestiges: 0,
                playTime: 0
            },
            lastSave: Date.now(),
            startTime: Date.now()
        };
        
        // === Audio Context ===
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, duration, type = 'sine') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            osc.type = type;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
        }
        
        // === Data Definitions ===
        const resourceDefs = {
            minerals: { icon: 'â›ï¸', name: 'ê´‘ë¬¼', color: '#ffaa00' },
            energy: { icon: 'âš¡', name: 'ì—ë„ˆì§€', color: '#00d4ff' },
            food: { icon: 'ğŸŒ¾', name: 'ì‹ëŸ‰', color: '#00ff88' },
            research: { icon: 'ğŸ”¬', name: 'ì—°êµ¬', color: '#aa00ff' }
        };
        
        const buildingDefs = {
            mine: { icon: 'â›ï¸', name: 'ê´‘ì‚°', base: { minerals: 10 }, cost: { minerals: 10 }, prod: { minerals: 1 }, unlock: 0 },
            solar: { icon: 'â˜€ï¸', name: 'íƒœì–‘ê´‘íŒ¨ë„', base: { energy: 10 }, cost: { minerals: 25 }, prod: { energy: 1 }, unlock: 0 },
            farm: { icon: 'ğŸŒ¾', name: 'ë†ì¥', base: { food: 10 }, cost: { minerals: 30, energy: 10 }, prod: { food: 1 }, unlock: 0 },
            lab: { icon: 'ğŸ”¬', name: 'ì—°êµ¬ì†Œ', base: { research: 5 }, cost: { minerals: 50, energy: 20 }, prod: { research: 0.5 }, unlock: 0 },
            factory: { icon: 'ğŸ­', name: 'ê³µì¥', base: { minerals: 30 }, cost: { minerals: 100, energy: 50 }, prod: { minerals: 5 }, unlock: 10 },
            habitat: { icon: 'ğŸ˜ï¸', name: 'ì£¼ê±°êµ¬ì—­', base: { food: 50 }, cost: { minerals: 150, energy: 75, food: 50 }, prod: { food: 10 }, unlock: 20 },
            defense: { icon: 'ğŸ›¡ï¸', name: 'ë°©ì–´íƒ‘', base: {}, cost: { minerals: 200, energy: 100 }, prod: {}, unlock: 30 },
            spaceport: { icon: 'ğŸš€', name: 'ìš°ì£¼í•­', base: { minerals: 100 }, cost: { minerals: 500, energy: 250, food: 100 }, prod: { minerals: 20, energy: 10 }, unlock: 50 },
            terraform: { icon: 'ğŸŒ', name: 'í…Œë¼í¬ë¨¸', base: { food: 200 }, cost: { minerals: 1000, energy: 500, research: 100 }, prod: { food: 50, energy: 25 }, unlock: 100 },
            quantum: { icon: 'ğŸ’»', name: 'ì–‘ìì»´í“¨í„°', base: { research: 100 }, cost: { minerals: 2000, energy: 1000, research: 200 }, prod: { research: 25 }, unlock: 200 }
        };
        
        const upgradeDefs = {
            mineEff1: { name: 'ê´‘ì‚° íš¨ìœ¨ I', desc: 'ê´‘ì‚° ìƒì‚° +50%', cost: { research: 10 }, effect: () => { /* applied in calc */ }, building: 'mine', multi: 0.5 },
            mineEff2: { name: 'ê´‘ì‚° íš¨ìœ¨ II', desc: 'ê´‘ì‚° ìƒì‚° +100%', cost: { research: 50 }, effect: () => {}, building: 'mine', multi: 1.0, requires: ['mineEff1'] },
            solarEff1: { name: 'íƒœì–‘ê´‘ íš¨ìœ¨ I', desc: 'íƒœì–‘ê´‘ ìƒì‚° +50%', cost: { research: 15 }, effect: () => {}, building: 'solar', multi: 0.5 },
            solarEff2: { name: 'íƒœì–‘ê´‘ íš¨ìœ¨ II', desc: 'íƒœì–‘ê´‘ ìƒì‚° +100%', cost: { research: 75 }, effect: () => {}, building: 'solar', multi: 1.0, requires: ['solarEff1'] },
            farmEff1: { name: 'ë†ì¥ íš¨ìœ¨ I', desc: 'ë†ì¥ ìƒì‚° +50%', cost: { research: 20 }, effect: () => {}, building: 'farm', multi: 0.5 },
            farmEff2: { name: 'ë†ì¥ íš¨ìœ¨ II', desc: 'ë†ì¥ ìƒì‚° +100%', cost: { research: 100 }, effect: () => {}, building: 'farm', multi: 1.0, requires: ['farmEff1'] },
            clickPower1: { name: 'í´ë¦­ íŒŒì›Œ I', desc: 'í´ë¦­ ë‹¹ +1 ê´‘ë¬¼', cost: { research: 25 }, effect: () => {}, click: 1 },
            clickPower2: { name: 'í´ë¦­ íŒŒì›Œ II', desc: 'í´ë¦­ ë‹¹ +5 ê´‘ë¬¼', cost: { research: 150 }, effect: () => {}, click: 5, requires: ['clickPower1'] },
            globalEff1: { name: 'ì „ì—­ ìƒì‚° I', desc: 'ëª¨ë“  ìƒì‚° +25%', cost: { research: 100 }, effect: () => {}, global: 0.25 },
            globalEff2: { name: 'ì „ì—­ ìƒì‚° II', desc: 'ëª¨ë“  ìƒì‚° +50%', cost: { research: 500 }, effect: () => {}, global: 0.5, requires: ['globalEff1'] }
        };
        
        const achievementDefs = {
            click1: { icon: 'ğŸ‘†', name: 'ì²« í´ë¦­', desc: '1ë²ˆ í´ë¦­', check: () => game.stats.totalClicks >= 1 },
            click100: { icon: 'ğŸ‘†', name: 'í´ë¦­ ë§ˆìŠ¤í„°', desc: '100ë²ˆ í´ë¦­', check: () => game.stats.totalClicks >= 100 },
            click1000: { icon: 'ğŸ‘†', name: 'í´ë¦­ ì „ì„¤', desc: '1000ë²ˆ í´ë¦­', check: () => game.stats.totalClicks >= 1000 },
            build1: { icon: 'ğŸ—ï¸', name: 'ì²« ê±´ë¬¼', desc: 'ê±´ë¬¼ 1ê°œ ê±´ì„¤', check: () => game.stats.totalBuildings >= 1 },
            build10: { icon: 'ğŸ—ï¸', name: 'ì‘ì€ ì‹ë¯¼ì§€', desc: 'ê±´ë¬¼ 10ê°œ ê±´ì„¤', check: () => game.stats.totalBuildings >= 10 },
            build50: { icon: 'ğŸ—ï¸', name: 'ëŒ€ë„ì‹œ', desc: 'ê±´ë¬¼ 50ê°œ ê±´ì„¤', check: () => game.stats.totalBuildings >= 50 },
            build100: { icon: 'ğŸ—ï¸', name: 'ê±°ëŒ€ ì‹ë¯¼ì§€', desc: 'ê±´ë¬¼ 100ê°œ ê±´ì„¤', check: () => game.stats.totalBuildings >= 100 },
            mineral1k: { icon: 'â›ï¸', name: 'ê´‘ë¬¼ ìˆ˜ì§‘ê°€', desc: 'ê´‘ë¬¼ 1000 ë³´ìœ ', check: () => game.resources.minerals >= 1000 },
            mineral1m: { icon: 'â›ï¸', name: 'ê´‘ë¬¼ ì¬ë²Œ', desc: 'ê´‘ë¬¼ 1M ë³´ìœ ', check: () => game.resources.minerals >= 1000000 },
            energy1k: { icon: 'âš¡', name: 'ì—ë„ˆì§€ ì¶©ì „', desc: 'ì—ë„ˆì§€ 1000 ë³´ìœ ', check: () => game.resources.energy >= 1000 },
            food1k: { icon: 'ğŸŒ¾', name: 'ì‹ëŸ‰ í™•ë³´', desc: 'ì‹ëŸ‰ 1000 ë³´ìœ ', check: () => game.resources.food >= 1000 },
            research100: { icon: 'ğŸ”¬', name: 'ì—°êµ¬ ì‹œì‘', desc: 'ì—°êµ¬ 100 ë³´ìœ ', check: () => game.resources.research >= 100 },
            research1k: { icon: 'ğŸ”¬', name: 'ê³¼í•™ ì„ êµ¬ì', desc: 'ì—°êµ¬ 1000 ë³´ìœ ', check: () => game.resources.research >= 1000 },
            prestige1: { icon: 'âœ¨', name: 'ì²« íƒì‚¬', desc: 'í”„ë ˆìŠ¤í‹°ì§€ 1íšŒ', check: () => game.stats.prestiges >= 1 },
            prestige5: { icon: 'âœ¨', name: 'íƒí—˜ê°€', desc: 'í”„ë ˆìŠ¤í‹°ì§€ 5íšŒ', check: () => game.stats.prestiges >= 5 },
            prestige10: { icon: 'âœ¨', name: 'ìš°ì£¼ ê°œì²™ì', desc: 'í”„ë ˆìŠ¤í‹°ì§€ 10íšŒ', check: () => game.stats.prestiges >= 10 },
            allBuildings: { icon: 'ğŸ†', name: 'ì™„ì „í•œ ì‹ë¯¼ì§€', desc: 'ëª¨ë“  ê±´ë¬¼ ë³´ìœ ', check: () => Object.keys(buildingDefs).every(k => (game.buildings[k] || 0) > 0) },
            quantum1: { icon: 'ğŸ’»', name: 'ì–‘ì ì‹œëŒ€', desc: 'ì–‘ìì»´í“¨í„° 1ê°œ ê±´ì„¤', check: () => (game.buildings.quantum || 0) >= 1 },
            terraform1: { icon: 'ğŸŒ', name: 'í–‰ì„± ê°œì¡°', desc: 'í…Œë¼í¬ë¨¸ 1ê°œ ê±´ì„¤', check: () => (game.buildings.terraform || 0) >= 1 },
            stardust100: { icon: 'â­', name: 'ìŠ¤íƒ€ë”ìŠ¤íŠ¸ ìˆ˜ì§‘ê°€', desc: 'ìŠ¤íƒ€ë”ìŠ¤íŠ¸ 100 ë³´ìœ ', check: () => game.stardust >= 100 }
        };
        
        // === Utility Functions ===
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num).toString();
            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
            let tier = Math.floor(Math.log10(num) / 3);
            if (tier >= suffixes.length) tier = suffixes.length - 1;
            const scaled = num / Math.pow(1000, tier);
            return scaled.toFixed(2) + suffixes[tier];
        }
        
        function getClickPower() {
            let power = 1;
            Object.keys(game.upgrades).forEach(u => {
                if (upgradeDefs[u] && upgradeDefs[u].click) power += upgradeDefs[u].click;
            });
            return power * getStardustMultiplier();
        }
        
        function getBuildingMultiplier(building) {
            let multi = 1;
            Object.keys(game.upgrades).forEach(u => {
                const def = upgradeDefs[u];
                if (def && def.building === building && def.multi) {
                    multi += def.multi;
                }
            });
            Object.keys(game.upgrades).forEach(u => {
                const def = upgradeDefs[u];
                if (def && def.global) multi += def.global;
            });
            return multi * getStardustMultiplier();
        }
        
        function getStardustMultiplier() {
            return 1 + game.stardust * 0.01;
        }
        
        function calculatePotentialStardust() {
            let total = 0;
            Object.keys(game.buildings).forEach(k => {
                total += game.buildings[k] || 0;
            });
            return Math.floor(Math.sqrt(total));
        }
        
        function canAfford(costs) {
            return Object.keys(costs).every(r => game.resources[r] >= costs[r]);
        }
        
        function spend(costs) {
            Object.keys(costs).forEach(r => game.resources[r] -= costs[r]);
        }
        
        function getBuildingCost(building, count) {
            const def = buildingDefs[building];
            const costs = {};
            Object.keys(def.cost).forEach(r => {
                costs[r] = Math.floor(def.cost[r] * Math.pow(1.15, count));
            });
            return costs;
        }
        
        // === Core Game Loop ===
        function gameLoop(delta) {
            // Production
            Object.keys(buildingDefs).forEach(key => {
                const count = game.buildings[key] || 0;
                if (count > 0) {
                    const def = buildingDefs[key];
                    const multi = getBuildingMultiplier(key);
                    Object.keys(def.prod).forEach(res => {
                        game.resources[res] += def.prod[res] * count * multi * (delta / 1000);
                    });
                }
            });
            
            // Update play time
            game.stats.playTime = Math.floor((Date.now() - game.startTime) / 1000);
            
            // Check achievements
            checkAchievements();
            
            // Render
            render();
        }
        
        function checkAchievements() {
            Object.keys(achievementDefs).forEach(key => {
                if (!game.achievements[key] && achievementDefs[key].check()) {
                    game.achievements[key] = true;
                    showNotification(`ğŸ† ì—…ì  ë‹¬ì„±: ${achievementDefs[key].name}`);
                    playSound(800, 0.2);
                }
            });
        }
        
        function showNotification(text) {
            const notif = document.createElement('div');
            notif.textContent = text;
            notif.style.position = 'fixed';
            notif.style.top = '50px';
            notif.style.left = '50%';
            notif.style.transform = 'translateX(-50%)';
            notif.style.background = 'linear-gradient(135deg, #00d4ff, #0088ff)';
            notif.style.padding = '12px 24px';
            notif.style.borderRadius = '8px';
            notif.style.zIndex = '2000';
            notif.style.boxShadow = '0 4px 20px rgba(0,212,255,0.6)';
            notif.style.animation = 'float-up 2s forwards';
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 2000);
        }
        
        // === Rendering ===
        function render() {
            renderResources();
            renderBuildings();
            renderUpgrades();
            renderAchievements();
            renderPrestige();
            renderStats();
        }
        
        function renderResources() {
            const container = document.getElementById('resources');
            container.innerHTML = '';
            Object.keys(resourceDefs).forEach(key => {
                const def = resourceDefs[key];
                const value = game.resources[key];
                const rate = calculateResourceRate(key);
                const div = document.createElement('div');
                div.className = 'resource';
                div.innerHTML = `
                    <div class="icon">${def.icon}</div>
                    <div class="name">${def.name}</div>
                    <div class="value">${formatNumber(value)}</div>
                    ${rate > 0 ? `<div class="rate">+${formatNumber(rate)}/ì´ˆ</div>` : ''}
                `;
                container.appendChild(div);
            });
        }
        
        function calculateResourceRate(resource) {
            let rate = 0;
            Object.keys(buildingDefs).forEach(key => {
                const count = game.buildings[key] || 0;
                const def = buildingDefs[key];
                if (def.prod[resource]) {
                    rate += def.prod[resource] * count * getBuildingMultiplier(key);
                }
            });
            return rate;
        }
        
        function renderBuildings() {
            const container = document.getElementById('buildings');
            container.innerHTML = '';
            Object.keys(buildingDefs).forEach(key => {
                const def = buildingDefs[key];
                const count = game.buildings[key] || 0;
                const totalBuildings = game.stats.totalBuildings;
                const locked = totalBuildings < def.unlock;
                const cost = getBuildingCost(key, count);
                const canBuy = !locked && canAfford(cost);
                
                const div = document.createElement('div');
                div.className = `building ${locked ? 'locked' : ''}`;
                
                let prodText = '';
                if (Object.keys(def.prod).length > 0) {
                    const prodList = Object.keys(def.prod).map(r => 
                        `${resourceDefs[r].icon} +${formatNumber(def.prod[r] * getBuildingMultiplier(key))}/ì´ˆ`
                    ).join(', ');
                    prodText = `<div class="building-production">${prodList}</div>`;
                }
                
                const costText = Object.keys(cost).map(r => 
                    `${resourceDefs[r].icon} ${formatNumber(cost[r])}`
                ).join(', ');
                
                div.innerHTML = `
                    <div class="building-header">
                        <div class="building-title">
                            <span class="icon">${def.icon}</span>
                            <div class="info">
                                <h3>${def.name}</h3>
                                <div class="count">ë³´ìœ : ${count}ê°œ</div>
                            </div>
                        </div>
                    </div>
                    ${prodText}
                    <div class="building-cost">${locked ? `ğŸ”’ ê±´ë¬¼ ${def.unlock}ê°œ í•„ìš”` : `ë¹„ìš©: ${costText}`}</div>
                    <button class="btn" ${!canBuy ? 'disabled' : ''}>ê±´ì„¤</button>
                `;
                
                div.querySelector('.btn').onclick = () => buyBuilding(key);
                container.appendChild(div);
            });
        }
        
        function renderUpgrades() {
            const container = document.getElementById('upgradeGrid');
            container.innerHTML = '';
            Object.keys(upgradeDefs).forEach(key => {
                const def = upgradeDefs[key];
                const owned = game.upgrades[key];
                if (owned) return;
                
                // Check requirements
                if (def.requires && !def.requires.every(r => game.upgrades[r])) return;
                
                const cost = def.cost;
                const canBuy = canAfford(cost);
                
                const div = document.createElement('div');
                div.className = 'upgrade';
                const costText = Object.keys(cost).map(r => 
                    `${resourceDefs[r].icon} ${formatNumber(cost[r])}`
                ).join(', ');
                
                div.innerHTML = `
                    <h4>${def.name}</h4>
                    <p>${def.desc}</p>
                    <div class="cost">${costText}</div>
                    <button class="btn" ${!canBuy ? 'disabled' : ''}>ì—°êµ¬</button>
                `;
                
                div.querySelector('.btn').onclick = () => buyUpgrade(key);
                container.appendChild(div);
            });
        }
        
        function renderAchievements() {
            const container = document.getElementById('achievementList');
            container.innerHTML = '';
            Object.keys(achievementDefs).forEach(key => {
                const def = achievementDefs[key];
                const unlocked = game.achievements[key];
                
                const div = document.createElement('div');
                div.className = `achievement ${unlocked ? 'unlocked' : ''}`;
                div.innerHTML = `
                    <div class="icon">${def.icon}</div>
                    <div class="name">${def.name}</div>
                `;
                div.title = def.desc;
                container.appendChild(div);
            });
        }
        
        function renderPrestige() {
            const potential = calculatePotentialStardust();
            document.getElementById('potentialStardust').textContent = potential;
            document.getElementById('currentStardust').textContent = game.stardust;
            document.getElementById('stardustBonus').textContent = (game.stardust * 1).toFixed(0);
            document.getElementById('prestigeBtn').disabled = potential === 0;
        }
        
        function renderStats() {
            document.getElementById('statClicks').textContent = formatNumber(game.stats.totalClicks);
            document.getElementById('statBuildings').textContent = game.stats.totalBuildings;
            document.getElementById('statPrestiges').textContent = game.stats.prestiges;
            const time = game.stats.playTime;
            const hours = Math.floor(time / 3600);
            const mins = Math.floor((time % 3600) / 60);
            const secs = time % 60;
            document.getElementById('statTime').textContent = hours > 0 
                ? `${hours}ì‹œê°„ ${mins}ë¶„` 
                : mins > 0 ? `${mins}ë¶„ ${secs}ì´ˆ` : `${secs}ì´ˆ`;
        }
        
        // === Actions ===
        function clickPlanet(e) {
            const power = getClickPower();
            game.resources.minerals += power;
            game.stats.totalClicks++;
            
            playSound(300, 0.05, 'square');
            
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = `+${formatNumber(power)}`;
            particle.style.left = e.clientX + 'px';
            particle.style.top = e.clientY + 'px';
            particle.style.color = resourceDefs.minerals.color;
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1000);
            
            const planet = document.getElementById('planet');
            planet.style.transform = 'scale(0.95)';
            setTimeout(() => planet.style.transform = '', 100);
            
            render();
        }
        
        function buyBuilding(key) {
            const count = game.buildings[key] || 0;
            const cost = getBuildingCost(key, count);
            if (canAfford(cost)) {
                spend(cost);
                game.buildings[key] = count + 1;
                game.stats.totalBuildings++;
                playSound(500, 0.15);
                render();
            }
        }
        
        function buyUpgrade(key) {
            const def = upgradeDefs[key];
            if (canAfford(def.cost)) {
                spend(def.cost);
                game.upgrades[key] = true;
                playSound(700, 0.2);
                showNotification(`âš¡ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ: ${def.name}`);
                render();
            }
        }
        
        function prestige() {
            const potential = calculatePotentialStardust();
            if (potential === 0) return;
            
            if (!confirm(`ì •ë§ ìƒˆ í–‰ì„±ìœ¼ë¡œ íƒì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ì§„í–‰ë„ê°€ ì´ˆê¸°í™”ë˜ê³  ${potential} ìŠ¤íƒ€ë”ìŠ¤íŠ¸ë¥¼ íšë“í•©ë‹ˆë‹¤.\nìŠ¤íƒ€ë”ìŠ¤íŠ¸ëŠ” ì˜êµ¬ì ìœ¼ë¡œ ëª¨ë“  ìƒì‚°ëŸ‰ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.`)) {
                return;
            }
            
            game.stardust += potential;
            game.stats.prestiges++;
            
            // Reset
            game.resources = { minerals: 0, energy: 0, food: 0, research: 0 };
            game.buildings = {};
            game.upgrades = {};
            
            playSound(1000, 0.5, 'sawtooth');
            showNotification(`âœ¨ ìƒˆ í–‰ì„± ë„ì°©! +${potential} ìŠ¤íƒ€ë”ìŠ¤íŠ¸`);
            
            // Screen shake
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 300);
            
            render();
            save();
        }
        
        // === Events ===
        const events = [
            {
                name: 'ìš´ì„ ì¶©ëŒ',
                desc: 'ê±°ëŒ€ ìš´ì„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤! ë¹ ë¥´ê²Œ í´ë¦­í•´ì„œ íŒŒê´´í•˜ì„¸ìš”!',
                type: 'meteor',
                action: () => {
                    let clicks = 0;
                    const required = 20;
                    const overlay = document.getElementById('eventOverlay');
                    const popup = document.getElementById('eventPopup');
                    
                    popup.innerHTML = `
                        <h2>â˜„ï¸ ìš´ì„ ì¶©ëŒ!</h2>
                        <p>ìš´ì„ì„ íŒŒê´´í•˜ì„¸ìš”! ${clicks}/${required}</p>
                        <button class="btn" id="meteorBtn">ğŸ’¥ íŒŒê´´!</button>
                    `;
                    overlay.classList.add('active');
                    
                    const btn = document.getElementById('meteorBtn');
                    btn.onclick = () => {
                        clicks++;
                        playSound(400, 0.05);
                        if (clicks >= required) {
                            const reward = Math.floor(game.resources.minerals * 0.5);
                            game.resources.minerals += reward;
                            showNotification(`âœ… ìš´ì„ íŒŒê´´! +${formatNumber(reward)} ê´‘ë¬¼`);
                            overlay.classList.remove('active');
                        } else {
                            popup.querySelector('p').textContent = `ìš´ì„ì„ íŒŒê´´í•˜ì„¸ìš”! ${clicks}/${required}`;
                        }
                    };
                }
            },
            {
                name: 'ì™¸ê³„ì¸ êµì—­',
                desc: 'í‰í™”ë¡œìš´ ì™¸ê³„ì¸ì´ êµì—­ì„ ì œì•ˆí•©ë‹ˆë‹¤.',
                type: 'trade',
                action: () => {
                    const overlay = document.getElementById('eventOverlay');
                    const popup = document.getElementById('eventPopup');
                    
                    popup.innerHTML = `
                        <h2>ğŸ‘½ ì™¸ê³„ì¸ êµì—­</h2>
                        <p>ê´‘ë¬¼ 500ì„ ì—ë„ˆì§€ 300ìœ¼ë¡œ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                        <div class="choices">
                            <button class="btn" id="acceptTrade">ìˆ˜ë½</button>
                            <button class="btn" id="declineTrade">ê±°ì ˆ</button>
                        </div>
                    `;
                    overlay.classList.add('active');
                    
                    document.getElementById('acceptTrade').onclick = () => {
                        if (game.resources.minerals >= 500) {
                            game.resources.minerals -= 500;
                            game.resources.energy += 300;
                            showNotification('âœ… êµì—­ ì™„ë£Œ!');
                            playSound(600, 0.2);
                        } else {
                            showNotification('âŒ ê´‘ë¬¼ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
                        }
                        overlay.classList.remove('active');
                    };
                    
                    document.getElementById('declineTrade').onclick = () => {
                        overlay.classList.remove('active');
                    };
                }
            },
            {
                name: 'íƒœì–‘ í­í’',
                desc: 'íƒœì–‘ í­í’ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤! ë°©ì–´ ì‹œìŠ¤í…œì„ ê°€ë™í•˜ì„¸ìš”.',
                type: 'storm',
                action: () => {
                    const defenses = game.buildings.defense || 0;
                    const damage = Math.max(0, 10 - defenses);
                    const loss = Math.floor(game.resources.energy * 0.01 * damage);
                    
                    game.resources.energy = Math.max(0, game.resources.energy - loss);
                    
                    const overlay = document.getElementById('eventOverlay');
                    const popup = document.getElementById('eventPopup');
                    
                    popup.innerHTML = `
                        <h2>âš ï¸ íƒœì–‘ í­í’!</h2>
                        <p>${defenses > 0 ? `ë°©ì–´íƒ‘ ${defenses}ê°œê°€ í”¼í•´ë¥¼ ë§‰ì•˜ìŠµë‹ˆë‹¤!` : 'ë°©ì–´ ì‹œì„¤ì´ ì—†ì–´ í”¼í•´ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤!'}</p>
                        <p>ì—ë„ˆì§€ ì†ì‹¤: ${formatNumber(loss)}</p>
                        <button class="btn" id="closeStorm">í™•ì¸</button>
                    `;
                    overlay.classList.add('active');
                    
                    document.getElementById('closeStorm').onclick = () => {
                        overlay.classList.remove('active');
                    };
                    
                    playSound(200, 0.3, 'sawtooth');
                    document.body.classList.add('shake');
                    setTimeout(() => document.body.classList.remove('shake'), 300);
                }
            }
        ];
        
        function triggerRandomEvent() {
            if (game.stats.totalBuildings < 5) return; // Don't trigger early
            const event = events[Math.floor(Math.random() * events.length)];
            event.action();
        }
        
        // === Save/Load ===
        function save() {
            localStorage.setItem('cosmicColonyIdleSave', JSON.stringify(game));
        }
        
        function load() {
            const saved = localStorage.getItem('cosmicColonyIdleSave');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(game, data);
                game.startTime = Date.now() - (game.stats.playTime * 1000);
            }
        }
        
        // === Tab System ===
        document.querySelectorAll('.tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            };
        });
        
        // === Initialize ===
        function init() {
            // Create stars
            const starsEl = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 2 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsEl.appendChild(star);
            }
            
            load();
            render();
            
            // Click handler
            document.getElementById('clickArea').onclick = clickPlanet;
            document.getElementById('prestigeBtn').onclick = prestige;
            
            // Game loop
            let lastTime = Date.now();
            setInterval(() => {
                const now = Date.now();
                const delta = now - lastTime;
                lastTime = now;
                gameLoop(delta);
            }, 100);
            
            // Auto-save
            setInterval(save, 30000);
            
            // Random events
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% chance every 30s
                    triggerRandomEvent();
                }
            }, 30000);
            
            // Resume from offline
            if (game.lastSave) {
                const offlineTime = (Date.now() - game.lastSave) / 1000;
                if (offlineTime > 60) {
                    const offlineGains = {};
                    Object.keys(buildingDefs).forEach(key => {
                        const count = game.buildings[key] || 0;
                        const def = buildingDefs[key];
                        const multi = getBuildingMultiplier(key);
                        Object.keys(def.prod).forEach(res => {
                            offlineGains[res] = (offlineGains[res] || 0) + def.prod[res] * count * multi * Math.min(offlineTime, 3600);
                        });
                    });
                    
                    Object.keys(offlineGains).forEach(r => {
                        game.resources[r] += offlineGains[r];
                    });
                    
                    const gainText = Object.keys(offlineGains)
                        .filter(r => offlineGains[r] > 0)
                        .map(r => `${resourceDefs[r].icon} +${formatNumber(offlineGains[r])}`)
                        .join(', ');
                    
                    if (gainText) {
                        showNotification(`â° ì˜¤í”„ë¼ì¸ ìˆ˜ìµ: ${gainText}`);
                    }
                }
            }
            game.lastSave = Date.now();
        }
        
        init();
        
        // === Additional Game Systems ===
        
        /**
         * Achievement System Enhancement
         * Tracks detailed player progression and milestones
         * Provides additional gameplay motivation through meta-progression
         */
        const extendedAchievements = {
            speedRunner1: {
                icon: 'âš¡',
                name: 'ìŠ¤í”¼ë“œëŸ¬ë„ˆ',
                desc: '10ë¶„ ì•ˆì— ê±´ë¬¼ 10ê°œ ê±´ì„¤',
                check: () => game.stats.totalBuildings >= 10 && game.stats.playTime < 600
            },
            hoarder: {
                icon: 'ğŸ’°',
                name: 'ìˆ˜ì§‘ê´‘',
                desc: 'ëª¨ë“  ìì› 10000 ì´ìƒ ë³´ìœ ',
                check: () => Object.values(game.resources).every(v => v >= 10000)
            },
            scientist: {
                icon: 'ğŸ”¬',
                name: 'ê³¼í•™ì',
                desc: 'ëª¨ë“  ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ',
                check: () => Object.keys(upgradeDefs).every(k => game.upgrades[k])
            },
            megaColony: {
                icon: 'ğŸŒŸ',
                name: 'ë©”ê°€ ì‹ë¯¼ì§€',
                desc: 'ê±´ë¬¼ 1000ê°œ ê±´ì„¤',
                check: () => game.stats.totalBuildings >= 1000
            },
            clickMaster: {
                icon: 'ğŸ‘‘',
                name: 'í´ë¦­ ë§ˆìŠ¤í„°',
                desc: '10000ë²ˆ í´ë¦­',
                check: () => game.stats.totalClicks >= 10000
            },
            prestigeMaster: {
                icon: 'âœ¨',
                name: 'í”„ë ˆìŠ¤í‹°ì§€ ë§ˆìŠ¤í„°',
                desc: 'í”„ë ˆìŠ¤í‹°ì§€ 25íšŒ',
                check: () => game.stats.prestiges >= 25
            },
            marathonPlayer: {
                icon: 'â±ï¸',
                name: 'ë§ˆë¼í†¤ í”Œë ˆì´ì–´',
                desc: 'ì´ í”Œë ˆì´ ì‹œê°„ 1ì‹œê°„ ì´ìƒ',
                check: () => game.stats.playTime >= 3600
            }
        };
        
        // Merge extended achievements
        Object.assign(achievementDefs, extendedAchievements);
        
        /**
         * Building Production Calculator
         * Calculates optimal building ratios for maximum efficiency
         */
        function calculateOptimalRatio() {
            const ratios = {};
            let total = 0;
            Object.keys(buildingDefs).forEach(key => {
                ratios[key] = game.buildings[key] || 0;
                total += ratios[key];
            });
            return total > 0 ? ratios : null;
        }
        
        /**
         * Resource Efficiency Metrics
         * Tracks production efficiency and identifies bottlenecks
         */
        function analyzeEfficiency() {
            const analysis = {};
            Object.keys(resourceDefs).forEach(res => {
                const rate = calculateResourceRate(res);
                const current = game.resources[res];
                analysis[res] = {
                    rate: rate,
                    timeToDouble: rate > 0 ? current / rate : Infinity,
                    efficiency: rate * current
                };
            });
            return analysis;
        }
        
        /**
         * Event System Enhancements
         * Additional random events for variety
         */
        const additionalEvents = [
            {
                name: 'ê³ ëŒ€ ìœ ì  ë°œê²¬',
                desc: 'ê³ ëŒ€ ë¬¸ëª…ì˜ ìœ ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!',
                type: 'ruins',
                action: () => {
                    const bonus = Math.floor(game.resources.research * 0.3);
                    game.resources.research += bonus;
                    showNotification(`ğŸ›ï¸ ê³ ëŒ€ ìœ ì ! +${formatNumber(bonus)} ì—°êµ¬`);
                    playSound(750, 0.3);
                }
            },
            {
                name: 'í’ë¶€í•œ ê´‘ë§¥',
                desc: 'ê±°ëŒ€í•œ ê´‘ë§¥ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!',
                type: 'vein',
                action: () => {
                    const bonus = Math.floor(game.resources.minerals * 0.5);
                    game.resources.minerals += bonus;
                    showNotification(`â›ï¸ ê´‘ë§¥ ë°œê²¬! +${formatNumber(bonus)} ê´‘ë¬¼`);
                    playSound(350, 0.3);
                }
            },
            {
                name: 'ì—ë„ˆì§€ ì˜¤ë²„ë¡œë“œ',
                desc: 'ì—ë„ˆì§€ ì‹œìŠ¤í…œì´ ê³¼ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤!',
                type: 'overload',
                action: () => {
                    const bonus = Math.floor(game.resources.energy * 0.4);
                    game.resources.energy += bonus;
                    showNotification(`âš¡ ì—ë„ˆì§€ ê¸‰ì¦! +${formatNumber(bonus)} ì—ë„ˆì§€`);
                    playSound(850, 0.25);
                }
            },
            {
                name: 'ëŒ€í’ë…„',
                desc: 'ì‹ëŸ‰ ìƒì‚°ì´ ê¸‰ì¦í–ˆìŠµë‹ˆë‹¤!',
                type: 'harvest',
                action: () => {
                    const bonus = Math.floor(game.resources.food * 0.6);
                    game.resources.food += bonus;
                    showNotification(`ğŸŒ¾ ëŒ€í’ë…„! +${formatNumber(bonus)} ì‹ëŸ‰`);
                    playSound(450, 0.3);
                }
            }
        ];
        
        events.push(...additionalEvents);
        
        /**
         * Advanced Building Upgrade System
         * Allows buildings to be upgraded individually for enhanced production
         */
        const buildingUpgrades = {
            mine: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            solar: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            farm: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            lab: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            factory: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            habitat: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            defense: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            spaceport: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            terraform: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 },
            quantum: { level: 0, maxLevel: 5, costMulti: 2, prodMulti: 1.5 }
        };
        
        /**
         * Milestone System
         * Tracks major progression milestones and rewards player
         */
        const milestones = {
            buildings10: { threshold: 10, reward: 'minerals', amount: 1000, claimed: false },
            buildings25: { threshold: 25, reward: 'energy', amount: 500, claimed: false },
            buildings50: { threshold: 50, reward: 'research', amount: 200, claimed: false },
            buildings100: { threshold: 100, reward: 'all', amount: 5000, claimed: false },
            prestige3: { threshold: 3, type: 'prestige', reward: 'stardust', amount: 10, claimed: false },
            prestige10: { threshold: 10, type: 'prestige', reward: 'stardust', amount: 50, claimed: false }
        };
        
        function checkMilestones() {
            Object.keys(milestones).forEach(key => {
                const m = milestones[key];
                if (m.claimed) return;
                
                const value = m.type === 'prestige' ? game.stats.prestiges : game.stats.totalBuildings;
                if (value >= m.threshold) {
                    if (m.reward === 'all') {
                        Object.keys(game.resources).forEach(r => {
                            game.resources[r] += m.amount;
                        });
                        showNotification(`ğŸ‰ ë§ˆì¼ìŠ¤í†¤! ëª¨ë“  ìì› +${formatNumber(m.amount)}`);
                    } else if (m.reward === 'stardust') {
                        game.stardust += m.amount;
                        showNotification(`ğŸ‰ ë§ˆì¼ìŠ¤í†¤! +${m.amount} ìŠ¤íƒ€ë”ìŠ¤íŠ¸`);
                    } else {
                        game.resources[m.reward] += m.amount;
                        showNotification(`ğŸ‰ ë§ˆì¼ìŠ¤í†¤! +${formatNumber(m.amount)} ${resourceDefs[m.reward].name}`);
                    }
                    m.claimed = true;
                    playSound(900, 0.4);
                }
            });
        }
        
        // Enhanced game loop with milestones
        setInterval(checkMilestones, 5000);
        
        /**
         * Statistics Tracking Enhancement
         * Detailed statistics for advanced players
         */
        const detailedStats = {
            totalResourcesGained: { minerals: 0, energy: 0, food: 0, research: 0 },
            totalResourcesSpent: { minerals: 0, energy: 0, food: 0, research: 0 },
            buildingsBuilt: {},
            upgradesPurchased: 0,
            eventsTriggered: 0,
            achievementsUnlocked: 0
        };
        
        /**
         * Export/Import Save System
         * Allows players to backup and restore their progress
         */
        function exportSave() {
            const saveData = JSON.stringify(game);
            const encoded = btoa(saveData);
            return encoded;
        }
        
        function importSave(encoded) {
            try {
                const decoded = atob(encoded);
                const data = JSON.parse(decoded);
                Object.assign(game, data);
                render();
                showNotification('âœ… ì €ì¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ!');
                return true;
            } catch (e) {
                showNotification('âŒ ì˜ëª»ëœ ì €ì¥ ë°ì´í„°');
                return false;
            }
        }
        
        /**
         * Performance Optimization
         * Throttle rendering for better performance on low-end devices
         */
        let renderQueued = false;
        function queueRender() {
            if (!renderQueued) {
                renderQueued = true;
                requestAnimationFrame(() => {
                    render();
                    renderQueued = false;
                });
            }
        }
        
        /**
         * Tutorial System
         * Guide new players through basic mechanics
         */
        const tutorialSteps = [
            { condition: () => game.stats.totalClicks === 0, message: 'í–‰ì„±ì„ í´ë¦­í•´ì„œ ê´‘ë¬¼ì„ ì±„êµ´í•˜ì„¸ìš”!' },
            { condition: () => game.resources.minerals >= 10 && (game.buildings.mine || 0) === 0, message: 'ê´‘ì‚°ì„ ê±´ì„¤í•´ì„œ ìë™ìœ¼ë¡œ ê´‘ë¬¼ì„ ìƒì‚°í•˜ì„¸ìš”!' },
            { condition: () => (game.buildings.mine || 0) >= 1 && (game.buildings.solar || 0) === 0, message: 'ì—ë„ˆì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤. íƒœì–‘ê´‘íŒ¨ë„ì„ ê±´ì„¤í•˜ì„¸ìš”!' },
            { condition: () => Object.keys(game.upgrades).length === 0 && game.resources.research >= 10, message: 'ì—…ê·¸ë ˆì´ë“œ íƒ­ì—ì„œ ì—°êµ¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”!' },
            { condition: () => game.stats.totalBuildings >= 10 && game.stats.prestiges === 0, message: 'í”„ë ˆìŠ¤í‹°ì§€ë¡œ ì˜êµ¬ ë³´ë„ˆìŠ¤ë¥¼ ë°›ìœ¼ì„¸ìš”!' }
        ];
        
        let currentTutorialStep = 0;
        function checkTutorial() {
            if (currentTutorialStep >= tutorialSteps.length) return;
            const step = tutorialSteps[currentTutorialStep];
            if (step.condition()) {
                showNotification(`ğŸ’¡ ${step.message}`);
                currentTutorialStep++;
            }
        }
        
        setInterval(checkTutorial, 10000);
    </script>
</body>
</html>