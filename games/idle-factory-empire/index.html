<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üè≠ Idle Factory Empire</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #eee;
            overflow-x: hidden;
        }
        #app {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(0, 0, 0, 0.3);
        }
        header {
            background: linear-gradient(135deg, #0f3460, #533483);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
        }
        #money {
            font-size: 32px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }
        #perSec {
            font-size: 14px;
            color: #8fce00;
            margin-top: 5px;
        }
        nav {
            display: flex;
            background: #0a0a0a;
            border-bottom: 2px solid #533483;
        }
        nav button {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        nav button.active {
            color: #fff;
            background: rgba(83, 52, 131, 0.3);
            border-bottom-color: #e94560;
        }
        .tab {
            display: none;
            padding: 20px;
        }
        .tab.active {
            display: block;
        }
        .factory {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #533483;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }
        .factory:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        .factory:active:before {
            transform: translateX(100%);
        }
        .factory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .factory-icon {
            font-size: 36px;
        }
        .factory-info {
            flex: 1;
            margin-left: 15px;
        }
        .factory-name {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
        }
        .factory-level {
            font-size: 12px;
            color: #8fce00;
        }
        .factory-stats {
            font-size: 13px;
            color: #aaa;
            margin: 5px 0;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #0a0a0a;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8fce00, #0f0);
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(143, 206, 0, 0.8);
        }
        .factory-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-collect {
            background: linear-gradient(135deg, #0f0, #0a0);
            color: #fff;
        }
        .btn-collect:active {
            transform: scale(0.95);
        }
        .btn-collect:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        .upgrade-item {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 2px solid #533483;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .upgrade-item h3 {
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 8px;
        }
        .upgrade-item p {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 10px;
        }
        .upgrade-cost {
            font-size: 14px;
            color: #8fce00;
            margin-bottom: 10px;
        }
        .manager-item {
            background: linear-gradient(135deg, #16213e, #533483);
            border: 2px solid #e94560;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .achievement {
            background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .achievement.locked {
            opacity: 0.5;
            border-color: #555;
        }
        .achievement-icon {
            font-size: 32px;
        }
        .achievement-info {
            flex: 1;
        }
        .achievement-name {
            font-size: 15px;
            font-weight: bold;
            color: #ffd700;
        }
        .achievement-desc {
            font-size: 12px;
            color: #aaa;
        }
        .prestige-box {
            background: linear-gradient(135deg, #533483, #e94560);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        .prestige-box h2 {
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        .prestige-box p {
            font-size: 16px;
            margin-bottom: 15px;
        }
        .btn-prestige {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }
        .btn-prestige:active {
            transform: scale(0.95);
        }
        .btn-prestige:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            box-shadow: none;
        }
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 24px;
            animation: particle-float 1s ease-out forwards;
            z-index: 1000;
        }
        @keyframes particle-float {
            to {
                transform: translateY(-100px);
                opacity: 0;
            }
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .stat-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #533483;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .stat-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>üè≠ Idle Factory Empire</h1>
            <div id="money">$0</div>
            <div id="perSec">$/sec: 0</div>
        </header>
        <nav>
            <button class="tab-btn active" data-tab="factories">üè≠ Í≥µÏû•</button>
            <button class="tab-btn" data-tab="upgrades">‚¨Ü ÏóÖÍ∑∏Î†àÏù¥Îìú</button>
            <button class="tab-btn" data-tab="managers">üëî Îß§ÎãàÏ†Ä</button>
            <button class="tab-btn" data-tab="achievements">üèÜ ÏóÖÏ†Å</button>
        </nav>
        <div id="factories" class="tab active"></div>
        <div id="upgrades" class="tab"></div>
        <div id="managers" class="tab"></div>
        <div id="achievements" class="tab"></div>
    </div>
    <script>
        const audio = new AudioContext();
        function playSound(freq, duration, type = 'sine') {
            const osc = audio.createOscillator();
            const gain = audio.createGain();
            osc.connect(gain);
            gain.connect(audio.destination);
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.05, audio.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + duration);
            osc.start();
            osc.stop(audio.currentTime + duration);
        }

        function formatNumber(n) {
            const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
            let tier = Math.floor(Math.log10(Math.abs(n)) / 3);
            if (tier <= 0) return Math.floor(n).toLocaleString();
            tier = Math.min(tier, suffixes.length - 1);
            const scaled = n / Math.pow(10, tier * 3);
            return scaled.toFixed(2) + suffixes[tier];
        }

        function spawnParticle(x, y, emoji) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.textContent = emoji;
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        }

        const factoryTemplates = [
            { id: 'bakery', name: 'ÎπµÏßë', icon: 'üçû', baseCost: 10, baseProfit: 1, baseTime: 2 },
            { id: 'lumber', name: 'Î™©Ïû¨ÏÜå', icon: 'ü™µ', baseCost: 100, baseProfit: 10, baseTime: 4 },
            { id: 'steel', name: 'Ï†úÏ≤†ÏÜå', icon: '‚öôÔ∏è', baseCost: 1000, baseProfit: 80, baseTime: 6 },
            { id: 'electronics', name: 'Ï†ÑÏûêÍ≥µÏû•', icon: 'üíª', baseCost: 10000, baseProfit: 500, baseTime: 8 },
            { id: 'space', name: 'Ïö∞Ï£ºÍ∏∞ÏßÄ', icon: 'üöÄ', baseCost: 100000, baseProfit: 5000, baseTime: 12 }
        ];

        let gameState = {
            money: 0,
            totalEarned: 0,
            prestigePoints: 0,
            prestigeMultiplier: 1,
            playTime: 0,
            factories: {},
            upgrades: {},
            managers: {},
            achievements: {},
            lastSave: Date.now()
        };

        factoryTemplates.forEach(t => {
            gameState.factories[t.id] = {
                level: 0,
                progress: 0,
                unlocked: t.id === 'bakery'
            };
        });

        const upgradeTemplates = [
            { id: 'speed1', name: 'ÏÉùÏÇ∞ ÏÜçÎèÑ +10%', desc: 'Î™®Îì† Í≥µÏû•Ïùò ÏÉùÏÇ∞ ÏÜçÎèÑ 10% Ï¶ùÍ∞Ä', cost: 500, type: 'speed', value: 0.1 },
            { id: 'profit1', name: 'ÏàòÏùµ +20%', desc: 'Î™®Îì† Í≥µÏû•Ïùò ÏàòÏùµ 20% Ï¶ùÍ∞Ä', cost: 1000, type: 'profit', value: 0.2 },
            { id: 'speed2', name: 'ÏÉùÏÇ∞ ÏÜçÎèÑ +15%', desc: 'Î™®Îì† Í≥µÏû•Ïùò ÏÉùÏÇ∞ ÏÜçÎèÑ 15% Ï¶ùÍ∞Ä', cost: 5000, type: 'speed', value: 0.15 },
            { id: 'profit2', name: 'ÏàòÏùµ +30%', desc: 'Î™®Îì† Í≥µÏû•Ïùò ÏàòÏùµ 30% Ï¶ùÍ∞Ä', cost: 10000, type: 'profit', value: 0.3 },
            { id: 'auto1', name: 'ÏûêÎèôÌôîÏú® +5%', desc: 'Îß§ÎãàÏ†ÄÍ∞Ä ÏóÜÏñ¥ÎèÑ 5% ÌôïÎ•†Î°ú ÏûêÎèô ÏàòÏßë', cost: 20000, type: 'auto', value: 0.05 }
        ];

        upgradeTemplates.forEach(u => {
            gameState.upgrades[u.id] = { purchased: false };
        });

        const managerTemplates = [
            { id: 'm1', name: 'Alice', desc: 'ÎπµÏßë ÏûêÎèô Í¥ÄÎ¶¨', factory: 'bakery', cost: 200 },
            { id: 'm2', name: 'Bob', desc: 'Î™©Ïû¨ÏÜå ÏûêÎèô Í¥ÄÎ¶¨', factory: 'lumber', cost: 2000 },
            { id: 'm3', name: 'Charlie', desc: 'Ï†úÏ≤†ÏÜå ÏûêÎèô Í¥ÄÎ¶¨', factory: 'steel', cost: 20000 },
            { id: 'm4', name: 'Diana', desc: 'Ï†ÑÏûêÍ≥µÏû• ÏûêÎèô Í¥ÄÎ¶¨', factory: 'electronics', cost: 200000 },
            { id: 'm5', name: 'Elon', desc: 'Ïö∞Ï£ºÍ∏∞ÏßÄ ÏûêÎèô Í¥ÄÎ¶¨', factory: 'space', cost: 2000000 }
        ];

        managerTemplates.forEach(m => {
            gameState.managers[m.id] = { hired: false };
        });

        const achievementTemplates = [
            { id: 'a1', name: 'Ï≤´ ÏÉùÏÇ∞', desc: 'Îπµ 1Í∞ú ÏÉùÏÇ∞', icon: 'üéâ', check: () => gameState.totalEarned >= 1 },
            { id: 'a2', name: 'Î∞±ÎßåÏû•Ïûê', desc: 'Ï¥ù ÏàòÏùµ 1M Îã¨ÏÑ±', icon: 'üí∞', check: () => gameState.totalEarned >= 1000000 },
            { id: 'a3', name: 'Îß§ÎãàÏ†Ä 5Î™Ö', desc: 'Îß§ÎãàÏ†Ä 5Î™Ö Í≥†Ïö©', icon: 'üëî', check: () => Object.values(gameState.managers).filter(m => m.hired).length >= 5 },
            { id: 'a4', name: 'Ïö∞Ï£º Í∞úÏ≤ôÏûê', desc: 'Ïö∞Ï£ºÍ∏∞ÏßÄ Î†àÎ≤® 10', icon: 'üöÄ', check: () => gameState.factories.space.level >= 10 },
            { id: 'a5', name: 'ÌîÑÎ†àÏä§Ìã∞ÏßÄ ÎßàÏä§ÌÑ∞', desc: 'ÌîÑÎ†àÏä§Ìã∞ÏßÄ 1Ìöå', icon: '‚≠ê', check: () => gameState.prestigePoints > 0 }
        ];

        achievementTemplates.forEach(a => {
            gameState.achievements[a.id] = { unlocked: false };
        });

        function calculateFactoryCost(factory) {
            const template = factoryTemplates.find(t => t.id === factory);
            return Math.floor(template.baseCost * Math.pow(1.15, gameState.factories[factory].level));
        }

        function calculateFactoryProfit(factory) {
            const template = factoryTemplates.find(t => t.id === factory);
            const level = gameState.factories[factory].level;
            let profit = template.baseProfit * level;
            
            const profitUpgrades = upgradeTemplates.filter(u => u.type === 'profit' && gameState.upgrades[u.id].purchased);
            profitUpgrades.forEach(u => profit *= (1 + u.value));
            
            profit *= gameState.prestigeMultiplier;
            return profit;
        }

        function calculateFactoryTime(factory) {
            const template = factoryTemplates.find(t => t.id === factory);
            let time = template.baseTime;
            
            const speedUpgrades = upgradeTemplates.filter(u => u.type === 'speed' && gameState.upgrades[u.id].purchased);
            speedUpgrades.forEach(u => time *= (1 - u.value));
            
            return time;
        }

        function canAfford(cost) {
            return gameState.money >= cost;
        }

        function buyFactory(factoryId) {
            const cost = calculateFactoryCost(factoryId);
            if (!canAfford(cost)) return;
            
            gameState.money -= cost;
            gameState.factories[factoryId].level++;
            
            const nextId = factoryTemplates.findIndex(t => t.id === factoryId) + 1;
            if (nextId < factoryTemplates.length) {
                gameState.factories[factoryTemplates[nextId].id].unlocked = true;
            }
            
            playSound(500, 0.1);
            renderFactories();
            renderUpgrades();
            renderManagers();
            updateHeader();
        }

        function collectFactory(factoryId) {
            const profit = calculateFactoryProfit(factoryId);
            gameState.money += profit;
            gameState.totalEarned += profit;
            gameState.factories[factoryId].progress = 0;
            
            playSound(600, 0.05);
            spawnParticle(Math.random() * window.innerWidth, Math.random() * 300 + 100, 'üí∞');
            
            updateHeader();
            checkAchievements();
        }

        function buyUpgrade(upgradeId) {
            const upgrade = upgradeTemplates.find(u => u.id === upgradeId);
            if (!canAfford(upgrade.cost) || gameState.upgrades[upgradeId].purchased) return;
            
            gameState.money -= upgrade.cost;
            gameState.upgrades[upgradeId].purchased = true;
            
            playSound(700, 0.15);
            renderUpgrades();
            updateHeader();
        }

        function hireManager(managerId) {
            const manager = managerTemplates.find(m => m.id === managerId);
            if (!canAfford(manager.cost) || gameState.managers[managerId].hired) return;
            
            gameState.money -= manager.cost;
            gameState.managers[managerId].hired = true;
            
            playSound(800, 0.2);
            renderManagers();
            updateHeader();
            checkAchievements();
        }

        function canPrestige() {
            return gameState.totalEarned >= 1000000;
        }

        function prestige() {
            if (!canPrestige()) return;
            
            const points = Math.floor(gameState.totalEarned / 1000000);
            gameState.prestigePoints += points;
            gameState.prestigeMultiplier = 1 + gameState.prestigePoints * 0.1;
            
            gameState.money = 0;
            gameState.totalEarned = 0;
            factoryTemplates.forEach(t => {
                gameState.factories[t.id].level = 0;
                gameState.factories[t.id].progress = 0;
                gameState.factories[t.id].unlocked = t.id === 'bakery';
            });
            upgradeTemplates.forEach(u => {
                gameState.upgrades[u.id].purchased = false;
            });
            managerTemplates.forEach(m => {
                gameState.managers[m.id].hired = false;
            });
            
            playSound(1000, 0.5);
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    spawnParticle(Math.random() * window.innerWidth, Math.random() * window.innerHeight, '‚≠ê');
                }, i * 20);
            }
            
            renderAll();
            checkAchievements();
        }

        function checkAchievements() {
            achievementTemplates.forEach(a => {
                if (!gameState.achievements[a.id].unlocked && a.check()) {
                    gameState.achievements[a.id].unlocked = true;
                    playSound(900, 0.3);
                    spawnParticle(window.innerWidth / 2, 200, a.icon);
                    renderAchievements();
                }
            });
        }

        function renderFactories() {
            const container = document.getElementById('factories');
            container.innerHTML = '';
            
            factoryTemplates.forEach(template => {
                const state = gameState.factories[template.id];
                if (!state.unlocked) return;
                
                const div = document.createElement('div');
                div.className = 'factory';
                
                const cost = calculateFactoryCost(template.id);
                const profit = calculateFactoryProfit(template.id);
                const time = calculateFactoryTime(template.id);
                const hasManager = managerTemplates.find(m => m.factory === template.id && gameState.managers[m.id].hired);
                
                div.innerHTML = `
                    <div class="factory-header">
                        <div class="factory-icon">${template.icon}</div>
                        <div class="factory-info">
                            <div class="factory-name">${template.name}</div>
                            <div class="factory-level">Level ${state.level}</div>
                        </div>
                    </div>
                    <div class="factory-stats">
                        ÏàòÏùµ: $${formatNumber(profit)} | ÏãúÍ∞Ñ: ${time.toFixed(1)}s
                        ${hasManager ? ' | ü§ñ ÏûêÎèô' : ''}
                    </div>
                    ${state.level > 0 ? `<div class="progress-bar"><div class="progress-fill" style="width: ${state.progress * 100}%"></div></div>` : ''}
                    <div class="factory-buttons">
                        <button class="btn btn-collect" onclick="buyFactory('${template.id}')" ${!canAfford(cost) ? 'disabled' : ''}>
                            ÏóÖÍ∑∏Î†àÏù¥Îìú $${formatNumber(cost)}
                        </button>
                        ${state.level > 0 ? `<button class="btn btn-collect" onclick="collectFactory('${template.id}')" ${state.progress < 1 ? 'disabled' : ''}>ÏàòÌôï</button>` : ''}
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades');
            container.innerHTML = '<div class="prestige-box"><h2>üåü ÌîÑÎ†àÏä§Ìã∞ÏßÄ</h2><p>ÌòÑÏû¨ Î∞∞Ïú®: x' + gameState.prestigeMultiplier.toFixed(1) + '</p><p>Ìè¨Ïù∏Ìä∏: ' + gameState.prestigePoints + '</p><button class="btn-prestige" onclick="prestige()" ' + (!canPrestige() ? 'disabled' : '') + '>ÌîÑÎ†àÏä§Ìã∞ÏßÄ (1M ÌïÑÏöî)</button></div>';
            
            upgradeTemplates.forEach(upgrade => {
                const state = gameState.upgrades[upgrade.id];
                const div = document.createElement('div');
                div.className = 'upgrade-item';
                div.innerHTML = `
                    <h3>${upgrade.name} ${state.purchased ? '‚úÖ' : ''}</h3>
                    <p>${upgrade.desc}</p>
                    <div class="upgrade-cost">ÎπÑÏö©: $${formatNumber(upgrade.cost)}</div>
                    <button class="btn btn-collect" onclick="buyUpgrade('${upgrade.id}')" ${!canAfford(upgrade.cost) || state.purchased ? 'disabled' : ''}>
                        ${state.purchased ? 'Íµ¨Îß§ÏôÑÎ£å' : 'Íµ¨Îß§'}
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function renderManagers() {
            const container = document.getElementById('managers');
            container.innerHTML = '';
            
            managerTemplates.forEach(manager => {
                const state = gameState.managers[manager.id];
                const div = document.createElement('div');
                div.className = 'manager-item';
                div.innerHTML = `
                    <h3>üëî ${manager.name} ${state.hired ? '‚úÖ' : ''}</h3>
                    <p>${manager.desc}</p>
                    <div class="upgrade-cost">ÎπÑÏö©: $${formatNumber(manager.cost)}</div>
                    <button class="btn btn-collect" onclick="hireManager('${manager.id}')" ${!canAfford(manager.cost) || state.hired ? 'disabled' : ''}>
                        ${state.hired ? 'Í≥†Ïö©ÏôÑÎ£å' : 'Í≥†Ïö©'}
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function renderAchievements() {
            const container = document.getElementById('achievements');
            container.innerHTML = '';
            
            const stats = document.createElement('div');
            stats.className = 'stats-grid';
            stats.innerHTML = `
                <div class="stat-card"><div class="stat-label">Ï¥ù ÏàòÏùµ</div><div class="stat-value">$${formatNumber(gameState.totalEarned)}</div></div>
                <div class="stat-card"><div class="stat-label">ÌîåÎ†àÏù¥ ÏãúÍ∞Ñ</div><div class="stat-value">${Math.floor(gameState.playTime / 60)}Î∂Ñ</div></div>
                <div class="stat-card"><div class="stat-label">Îã¨ÏÑ± ÏóÖÏ†Å</div><div class="stat-value">${Object.values(gameState.achievements).filter(a => a.unlocked).length}/${achievementTemplates.length}</div></div>
                <div class="stat-card"><div class="stat-label">ÌîÑÎ†àÏä§Ìã∞ÏßÄ</div><div class="stat-value">${gameState.prestigePoints}</div></div>
            `;
            container.appendChild(stats);
            
            achievementTemplates.forEach(achievement => {
                const state = gameState.achievements[achievement.id];
                const div = document.createElement('div');
                div.className = 'achievement' + (state.unlocked ? '' : ' locked');
                div.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateHeader() {
            document.getElementById('money').textContent = '$' + formatNumber(gameState.money);
            
            let perSec = 0;
            factoryTemplates.forEach(t => {
                const manager = managerTemplates.find(m => m.factory === t.id && gameState.managers[m.id].hired);
                if (manager && gameState.factories[t.id].level > 0) {
                    const profit = calculateFactoryProfit(t.id);
                    const time = calculateFactoryTime(t.id);
                    perSec += profit / time;
                }
            });
            
            document.getElementById('perSec').textContent = '$/sec: ' + formatNumber(perSec);
        }

        function renderAll() {
            renderFactories();
            renderUpgrades();
            renderManagers();
            renderAchievements();
            updateHeader();
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        function gameLoop() {
            factoryTemplates.forEach(template => {
                const state = gameState.factories[template.id];
                if (state.level > 0) {
                    const time = calculateFactoryTime(template.id);
                    const manager = managerTemplates.find(m => m.factory === template.id && gameState.managers[m.id].hired);
                    
                    const autoRate = upgradeTemplates.filter(u => u.type === 'auto' && gameState.upgrades[u.id].purchased).reduce((sum, u) => sum + u.value, 0);
                    
                    state.progress += 1 / (time * 60);
                    if (state.progress >= 1) {
                        if (manager || Math.random() < autoRate) {
                            collectFactory(template.id);
                        }
                    }
                }
            });
            
            gameState.playTime++;
            renderFactories();
            updateHeader();
        }

        function saveGame() {
            gameState.lastSave = Date.now();
            localStorage.setItem('idleFactorySave', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('idleFactorySave');
            if (saved) {
                const loaded = JSON.parse(saved);
                Object.assign(gameState, loaded);
                
                const offlineTime = Math.min((Date.now() - gameState.lastSave) / 1000, 3600 * 8);
                if (offlineTime > 60) {
                    let offlineEarnings = 0;
                    factoryTemplates.forEach(template => {
                        const state = gameState.factories[template.id];
                        const manager = managerTemplates.find(m => m.factory === template.id && gameState.managers[m.id].hired);
                        if (manager && state.level > 0) {
                            const profit = calculateFactoryProfit(template.id);
                            const time = calculateFactoryTime(template.id);
                            offlineEarnings += (profit / time) * offlineTime;
                        }
                    });
                    
                    if (offlineEarnings > 0) {
                        gameState.money += offlineEarnings;
                        gameState.totalEarned += offlineEarnings;
                        alert(`Ïò§ÌîÑÎùºÏù∏ ÏàòÏùµ: $${formatNumber(offlineEarnings)}\n(${Math.floor(offlineTime / 60)}Î∂Ñ)`);
                    }
                }
            }
        }

        loadGame();
        renderAll();
        checkAchievements();
        
        setInterval(gameLoop, 1000 / 60);
        setInterval(saveGame, 30000);
        window.addEventListener('beforeunload', saveGame);
    </script>
</body>
</html>