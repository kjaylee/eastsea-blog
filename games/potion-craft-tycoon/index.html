<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ§ª Potion Craft Tycoon - í¬ì…˜ ì¡°í•© íƒ€ì´ì¿¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            overflow-x: hidden;
            touch-action: pan-y;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(75, 0, 130, 0.3));
            border-radius: 16px;
            margin-bottom: 16px;
            box-shadow: 0 8px 32px rgba(138, 43, 226, 0.3);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 48px;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            border-color: #9370db;
            box-shadow: 0 4px 16px rgba(138, 43, 226, 0.5);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .ingredient-card {
            background: linear-gradient(135deg, rgba(46, 213, 115, 0.2), rgba(0, 184, 148, 0.2));
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(46, 213, 115, 0.3);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;
            position: relative;
        }

        .ingredient-card:active {
            transform: scale(0.95);
        }

        .ingredient-card.selected {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.4), rgba(75, 0, 130, 0.4));
            border-color: #9370db;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.6);
        }

        .ingredient-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }

        .ingredient-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .ingredient-count {
            font-size: 12px;
            color: #ffd700;
        }

        .cauldron {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.3), rgba(255, 69, 0, 0.3));
            padding: 24px;
            border-radius: 16px;
            border: 3px solid rgba(255, 140, 0, 0.5);
            margin-bottom: 16px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(255, 140, 0, 0.4);
        }

        .selected-ingredients {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
            min-height: 60px;
            align-items: center;
        }

        .selected-ingredient {
            font-size: 48px;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 52px;
            box-shadow: 0 4px 16px rgba(138, 43, 226, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-success {
            background: linear-gradient(135deg, #46d167, #00b894);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
        }

        .upgrade-grid {
            display: grid;
            gap: 12px;
        }

        .upgrade-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .upgrade-title {
            font-size: 16px;
            font-weight: bold;
        }

        .upgrade-level {
            font-size: 14px;
            color: #ffd700;
        }

        .upgrade-description {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .customers-queue {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .customer {
            min-width: 80px;
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .customer-icon {
            font-size: 32px;
            margin-bottom: 4px;
        }

        .customer-timer {
            font-size: 11px;
            color: #ffd700;
        }

        .recipes-grid {
            display: grid;
            gap: 12px;
        }

        .recipe-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .recipe-card.locked {
            opacity: 0.5;
        }

        .recipe-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .recipe-ingredients {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .recipe-value {
            font-size: 14px;
            color: #ffd700;
        }

        .particle {
            position: fixed;
            pointer-events: none;
            animation: particle-rise 1s ease-out forwards;
            font-size: 24px;
            z-index: 9999;
        }

        @keyframes particle-rise {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        .achievements-grid {
            display: grid;
            gap: 12px;
        }

        .achievement-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 16px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.2));
            border-color: #ffd700;
        }

        .achievement-icon {
            font-size: 32px;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .achievement-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .event-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(138, 43, 226, 0.6);
            z-index: 10000;
            animation: slideDown 0.5s ease-out;
            max-width: 90%;
            text-align: center;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        .daily-reward-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: 16px;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 32px;
            border-radius: 16px;
            border: 3px solid #8a2be2;
            box-shadow: 0 8px 32px rgba(138, 43, 226, 0.6);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .modal-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .modal-text {
            font-size: 16px;
            margin-bottom: 24px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Potion Craft Tycoon</h1>
            <div style="font-size: 14px; opacity: 0.9;">ë§ˆë²•ì˜ í¬ì…˜ì„ ì¡°í•©í•˜ì—¬ ë¶€ë¥¼ ìŒ“ìœ¼ì„¸ìš”!</div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">ğŸ’° ê³¨ë“œ</div>
                <div class="stat-value" id="gold">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">â±ï¸ íŒë§¤/ì´ˆ</div>
                <div class="stat-value" id="goldPerSec">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ§ª ë°œê²¬í•œ í¬ì…˜</div>
                <div class="stat-value" id="recipesFound">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ† ì—…ì </div>
                <div class="stat-value" id="achievementCount">0</div>
            </div>
        </div>

        <div class="customers-queue" id="customersQueue"></div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('craft')">ğŸ§ª ì¡°í•©</button>
            <button class="tab-btn" onclick="switchTab('upgrade')">â¬†ï¸ ì—…ê·¸ë ˆì´ë“œ</button>
            <button class="tab-btn" onclick="switchTab('recipes')">ğŸ“– ë ˆì‹œí”¼</button>
            <button class="tab-btn" onclick="switchTab('achievements')">ğŸ† ì—…ì </button>
        </div>

        <div id="craftTab" class="tab-content active">
            <div class="cauldron">
                <h3 style="margin-bottom: 16px;">ğŸ”® ë§ˆë²• ê°€ë§ˆì†¥</h3>
                <div class="selected-ingredients" id="selectedIngredients">
                    <div style="opacity: 0.5; font-size: 14px;">ì¬ë£Œë¥¼ ì„ íƒí•˜ì„¸ìš” (2-3ê°œ)</div>
                </div>
                <button class="btn btn-success" id="brewBtn" onclick="brewPotion()" disabled>ğŸ§ª í¬ì…˜ ì¡°í•©</button>
                <button class="btn btn-danger" style="margin-top: 8px;" onclick="clearSelection()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
            </div>

            <h3 style="margin-bottom: 12px;">ğŸ“¦ ì¬ë£Œ ë³´ê´€í•¨</h3>
            <div class="ingredients-grid" id="ingredientsGrid"></div>
            
            <button class="btn" onclick="gatherIngredients()" style="margin-top: 16px;">
                ğŸŒ¿ ì¬ë£Œ ì±„ì§‘ (ë¹„ìš©: <span id="gatherCost">10</span> ê³¨ë“œ)
            </button>
            
            <div style="background: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 12px;">
                <div style="font-weight: bold; margin-bottom: 8px;">ğŸ’¡ ì¡°í•© íŒ</div>
                <div style="opacity: 0.8; line-height: 1.6;">
                    â€¢ ì¬ë£Œë¥¼ 2-3ê°œ ì¡°í•©í•˜ì—¬ ìƒˆë¡œìš´ í¬ì…˜ì„ ë°œê²¬í•˜ì„¸ìš”<br>
                    â€¢ ë” ë§ì€ ì¬ë£Œë¥¼ ì‚¬ìš©í• ìˆ˜ë¡ ê°•ë ¥í•œ í¬ì…˜ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤<br>
                    â€¢ ë ˆì‹œí”¼ íƒ­ì—ì„œ ë°œê²¬í•œ í¬ì…˜ì˜ ì¡°í•©ë²•ì„ í™•ì¸í•˜ì„¸ìš”<br>
                    â€¢ ê°€ë§ˆì†¥ì„ ì—…ê·¸ë ˆì´ë“œí•˜ë©´ í¬ì…˜ ê°€ì¹˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤<br>
                    â€¢ ìë™íŒë§¤ ì—…ê·¸ë ˆì´ë“œë¡œ ì†ë‹˜ì—ê²Œ ìë™ìœ¼ë¡œ íŒë§¤í•˜ì„¸ìš”<br>
                    â€¢ ì¼ì¼ ë³´ìƒì„ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”!<br>
                    â€¢ ì˜¤í”„ë¼ì¸ ì¤‘ì—ë„ ìˆ˜ìµì´ ìŒ“ì…ë‹ˆë‹¤ (ìë™íŒë§¤ í•„ìš”)
                </div>
            </div>
        </div>

        <div id="upgradeTab" class="tab-content">
            <div class="upgrade-grid" id="upgradesGrid"></div>
        </div>

        <div id="recipesTab" class="tab-content">
            <h3 style="margin-bottom: 12px;">ğŸ“– ë°œê²¬í•œ ë ˆì‹œí”¼</h3>
            <div class="recipes-grid" id="recipesGrid"></div>
        </div>

        <div id="achievementsTab" class="tab-content">
            <div class="achievements-grid" id="achievementsGrid"></div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            gold: 0,
            ingredients: {},
            selectedIngredients: [],
            discoveredRecipes: [],
            upgrades: {
                display: 0,
                cauldron: 0,
                autoSell: 0,
                gathering: 0
            },
            customers: [],
            achievements: {},
            lastSave: Date.now(),
            lastDailyReward: 0,
            totalPotionsBrewed: 0,
            totalGoldEarned: 0,
            highestCombo: 0
        };

        // Ingredients Database
        const ingredients = [
            { id: 'herb', name: 'ì•½ì´ˆ', icon: 'ğŸŒ¿', baseValue: 1 },
            { id: 'flower', name: 'ê½ƒ', icon: 'ğŸŒ¸', baseValue: 2 },
            { id: 'waterstone', name: 'ë¬¼ì˜ ëŒ', icon: 'ğŸ’§', baseValue: 3 },
            { id: 'firecrystal', name: 'ë¶ˆì˜ ê²°ì •', icon: 'ğŸ”¥', baseValue: 4 },
            { id: 'thunderdust', name: 'ë²ˆê°œ ë¨¼ì§€', icon: 'âš¡', baseValue: 5 },
            { id: 'moondew', name: 'ë‹¬ë¹› ì´ìŠ¬', icon: 'ğŸŒ™', baseValue: 6 },
            { id: 'bonepowder', name: 'ë¼›ê°€ë£¨', icon: 'ğŸ’€', baseValue: 7 },
            { id: 'manacrystal', name: 'ë§ˆë‚˜ í¬ë¦¬ìŠ¤íƒˆ', icon: 'âœ¨', baseValue: 8 }
        ];

        // Recipes Database - Comprehensive Potion Collection
        const recipes = [
            // Basic Potions (2 ingredients)
            { name: 'ì²´ë ¥ í¬ì…˜', ingredients: ['herb', 'waterstone'], value: 50, icon: 'â¤ï¸', rarity: 'common' },
            { name: 'ë§ˆë‚˜ í¬ì…˜', ingredients: ['flower', 'manacrystal'], value: 100, icon: 'ğŸ’™', rarity: 'common' },
            { name: 'í™”ì—¼ í­íƒ„', ingredients: ['firecrystal', 'thunderdust'], value: 150, icon: 'ğŸ’¥', rarity: 'uncommon' },
            { name: 'ë…ì•½', ingredients: ['herb', 'bonepowder'], value: 80, icon: 'â˜ ï¸', rarity: 'common' },
            { name: 'íˆ¬ëª… ë¬¼ì•½', ingredients: ['moondew', 'waterstone'], value: 200, icon: 'ğŸ‘»', rarity: 'rare' },
            { name: 'í˜ì˜ ë¬¼ì•½', ingredients: ['firecrystal', 'bonepowder'], value: 120, icon: 'ğŸ’ª', rarity: 'uncommon' },
            { name: 'ë¯¼ì²© ë¬¼ì•½', ingredients: ['thunderdust', 'flower'], value: 110, icon: 'âš¡', rarity: 'uncommon' },
            { name: 'ì§€í˜œ ë¬¼ì•½', ingredients: ['manacrystal', 'moondew'], value: 180, icon: 'ğŸ§ ', rarity: 'rare' },
            { name: 'íšŒë³µ ë¬¼ì•½', ingredients: ['herb', 'flower'], value: 70, icon: 'ğŸ’š', rarity: 'common' },
            { name: 'ì—ë„ˆì§€ ë¬¼ì•½', ingredients: ['thunderdust', 'manacrystal'], value: 160, icon: 'âš¡', rarity: 'uncommon' },
            { name: 'ë°©ì–´ ë¬¼ì•½', ingredients: ['waterstone', 'bonepowder'], value: 90, icon: 'ğŸ›¡ï¸', rarity: 'common' },
            { name: 'ì†ë„ ë¬¼ì•½', ingredients: ['thunderdust', 'moondew'], value: 140, icon: 'ğŸƒ', rarity: 'uncommon' },
            { name: 'ì¬ìƒ ë¬¼ì•½', ingredients: ['herb', 'manacrystal'], value: 130, icon: 'ğŸŒ±', rarity: 'uncommon' },
            { name: 'ë¶ˆê½ƒ ë¬¼ì•½', ingredients: ['firecrystal', 'flower'], value: 100, icon: 'ğŸ”¥', rarity: 'common' },
            { name: 'ëƒ‰ê° ë¬¼ì•½', ingredients: ['waterstone', 'flower'], value: 95, icon: 'ğŸ§Š', rarity: 'common' },
            { name: 'ë…ì €í•­ ë¬¼ì•½', ingredients: ['herb', 'firecrystal'], value: 105, icon: 'ğŸ€', rarity: 'uncommon' },
            { name: 'ì•”í‘ ë¬¼ì•½', ingredients: ['bonepowder', 'moondew'], value: 170, icon: 'ğŸŒ‘', rarity: 'rare' },
            { name: 'ë¹›ì˜ ë¬¼ì•½', ingredients: ['manacrystal', 'flower'], value: 155, icon: 'â˜€ï¸', rarity: 'uncommon' },
            { name: 'ì¤‘ë ¥ ë¬¼ì•½', ingredients: ['waterstone', 'thunderdust'], value: 145, icon: 'ğŸŒ', rarity: 'uncommon' },
            { name: 'íˆ¬ì‹œ ë¬¼ì•½', ingredients: ['moondew', 'manacrystal'], value: 190, icon: 'ğŸ‘ï¸', rarity: 'rare' },
            
            // Advanced Potions (3 ingredients)
            { name: 'í•´ë…ì œ', ingredients: ['herb', 'flower', 'waterstone'], value: 250, icon: 'âœ¨', rarity: 'rare' },
            { name: 'í­ë°œ ë¬¼ì•½', ingredients: ['firecrystal', 'thunderdust', 'bonepowder'], value: 300, icon: 'ğŸ’£', rarity: 'epic' },
            { name: 'ë¶€í™œì˜ ì˜ì•½', ingredients: ['manacrystal', 'moondew', 'herb'], value: 500, icon: 'ğŸŒŸ', rarity: 'legendary' },
            { name: 'ë³€ì‹  ë¬¼ì•½', ingredients: ['bonepowder', 'moondew', 'flower'], value: 350, icon: 'ğŸ¦', rarity: 'epic' },
            { name: 'ìš©ê¸°ì˜ ë¬¼ì•½', ingredients: ['firecrystal', 'herb', 'manacrystal'], value: 280, icon: 'ğŸ¦', rarity: 'rare' },
            { name: 'ëƒ‰ê¸° ë¬¼ì•½', ingredients: ['waterstone', 'moondew', 'thunderdust'], value: 320, icon: 'â„ï¸', rarity: 'epic' },
            { name: 'ê´‘ê¸°ì˜ ë¬¼ì•½', ingredients: ['bonepowder', 'thunderdust', 'manacrystal'], value: 400, icon: 'ğŸ˜ˆ', rarity: 'epic' },
            { name: 'í˜„ìì˜ ëŒ', ingredients: ['manacrystal', 'firecrystal', 'moondew'], value: 600, icon: 'ğŸ’', rarity: 'legendary' },
            { name: 'ì‹œê°„ ì™œê³¡ ë¬¼ì•½', ingredients: ['thunderdust', 'moondew', 'manacrystal'], value: 450, icon: 'â°', rarity: 'epic' },
            { name: 'ì˜í˜¼ ë¬¼ì•½', ingredients: ['bonepowder', 'moondew', 'manacrystal'], value: 380, icon: 'ğŸ‘»', rarity: 'epic' },
            { name: 'ëŒ€ì§€ì˜ ì¶•ë³µ', ingredients: ['herb', 'waterstone', 'bonepowder'], value: 270, icon: 'ğŸŒ', rarity: 'rare' },
            { name: 'ì²œë‘¥ì˜ ë¶„ë…¸', ingredients: ['thunderdust', 'firecrystal', 'manacrystal'], value: 420, icon: 'âš¡', rarity: 'epic' },
            { name: 'ìƒëª…ì˜ ë¬¼', ingredients: ['herb', 'flower', 'manacrystal'], value: 290, icon: 'ğŸ’§', rarity: 'rare' },
            { name: 'ì£½ìŒì˜ ì†ê¸¸', ingredients: ['bonepowder', 'firecrystal', 'thunderdust'], value: 360, icon: 'ğŸ’€', rarity: 'epic' },
            { name: 'ìš°ì£¼ ë¬¼ì•½', ingredients: ['moondew', 'manacrystal', 'waterstone'], value: 550, icon: 'ğŸŒŒ', rarity: 'legendary' },
            { name: 'ë“œë˜ê³¤ í˜ˆì•¡', ingredients: ['firecrystal', 'bonepowder', 'manacrystal'], value: 480, icon: 'ğŸ‰', rarity: 'epic' },
            { name: 'ìš”ì • ê°€ë£¨', ingredients: ['flower', 'moondew', 'manacrystal'], value: 340, icon: 'ğŸ§š', rarity: 'rare' },
            { name: 'ì•…ë§ˆì˜ ëˆˆë¬¼', ingredients: ['bonepowder', 'firecrystal', 'moondew'], value: 410, icon: 'ğŸ˜­', rarity: 'epic' },
            { name: 'ì²œì‚¬ì˜ ì¶•ë³µ', ingredients: ['flower', 'manacrystal', 'waterstone'], value: 330, icon: 'ğŸ˜‡', rarity: 'rare' },
            { name: 'ë¶ˆë©¸ì˜ ì˜ì•½', ingredients: ['manacrystal', 'herb', 'bonepowder'], value: 700, icon: 'â™¾ï¸', rarity: 'legendary' }
        ];

        // Upgrades Database
        const upgrades = [
            {
                id: 'display',
                name: 'ì§„ì—´ëŒ€ í™•ì¥',
                icon: 'ğŸª',
                description: 'ë” ë§ì€ ê³ ê° ìœ ì¹˜',
                baseCost: 100,
                effect: level => `ê³ ê° ìˆ˜ +${level + 1}`
            },
            {
                id: 'cauldron',
                name: 'ê°€ë§ˆì†¥ ì—…ê·¸ë ˆì´ë“œ',
                icon: 'ğŸ”®',
                description: 'í¬ì…˜ ê°€ì¹˜ ì¦ê°€',
                baseCost: 150,
                effect: level => `í¬ì…˜ ê°€ì¹˜ +${(level + 1) * 10}%`
            },
            {
                id: 'autoSell',
                name: 'ìë™ íŒë§¤',
                icon: 'ğŸ¤–',
                description: 'ìë™ìœ¼ë¡œ í¬ì…˜ íŒë§¤',
                baseCost: 500,
                effect: level => `${level === 0 ? 'ì ê¹€' : `${level}ì´ˆë‹¹ íŒë§¤`}`
            },
            {
                id: 'gathering',
                name: 'ì±„ì§‘ íš¨ìœ¨',
                icon: 'ğŸŒ¿',
                description: 'ì¬ë£Œ ì±„ì§‘ ê°œì„ ',
                baseCost: 80,
                effect: level => `ì¬ë£Œ +${level + 1}ê°œ`
            }
        ];

        // Achievements Database - Comprehensive achievement system with various goals
        const achievements = [
            { id: 'first_potion', name: 'ì²« í¬ì…˜', desc: 'ì²« í¬ì…˜ ì¡°í•©', icon: 'ğŸ§ª', requirement: () => gameState.totalPotionsBrewed >= 1, reward: 50 },
            { id: 'potion_novice', name: 'í¬ì…˜ ì´ˆë³´', desc: '10ê°œ í¬ì…˜ ì¡°í•©', icon: 'ğŸ“', requirement: () => gameState.totalPotionsBrewed >= 10, reward: 100 },
            { id: 'potion_master', name: 'í¬ì…˜ ë§ˆìŠ¤í„°', desc: '100ê°œ í¬ì…˜ ì¡°í•©', icon: 'ğŸ‘¨â€ğŸ”¬', requirement: () => gameState.totalPotionsBrewed >= 100, reward: 500 },
            { id: 'potion_grandmaster', name: 'í¬ì…˜ ëŒ€ê°€', desc: '1000ê°œ í¬ì…˜ ì¡°í•©', icon: 'ğŸ§™', requirement: () => gameState.totalPotionsBrewed >= 1000, reward: 5000 },
            { id: 'first_sale', name: 'ì²« íŒë§¤', desc: 'ì²« ê³¨ë“œ íšë“', icon: 'ğŸ’°', requirement: () => gameState.totalGoldEarned >= 1, reward: 10 },
            { id: 'merchant', name: 'ìƒì¸', desc: '1,000 ê³¨ë“œ íšë“', icon: 'ğŸª', requirement: () => gameState.totalGoldEarned >= 1000, reward: 200 },
            { id: 'rich', name: 'ë¶€ì', desc: '10,000 ê³¨ë“œ íšë“', icon: 'ğŸ’°', requirement: () => gameState.totalGoldEarned >= 10000, reward: 1000 },
            { id: 'millionaire', name: 'ë°±ë§Œì¥ì', desc: '1,000,000 ê³¨ë“œ íšë“', icon: 'ğŸ’', requirement: () => gameState.totalGoldEarned >= 1000000, reward: 50000 },
            { id: 'billionaire', name: 'ì–µë§Œì¥ì', desc: '10,000,000 ê³¨ë“œ íšë“', icon: 'ğŸ‘‘', requirement: () => gameState.totalGoldEarned >= 10000000, reward: 500000 },
            { id: 'first_recipe', name: 'ë ˆì‹œí”¼ ë°œê²¬', desc: 'ì²« ë ˆì‹œí”¼ ë°œê²¬', icon: 'ğŸ“–', requirement: () => gameState.discoveredRecipes.length >= 1, reward: 50 },
            { id: 'recipe_collector', name: 'ë ˆì‹œí”¼ ìˆ˜ì§‘ê°€', desc: '5ê°œ ë ˆì‹œí”¼ ë°œê²¬', icon: 'ğŸ“š', requirement: () => gameState.discoveredRecipes.length >= 5, reward: 200 },
            { id: 'recipe_hunter', name: 'ë ˆì‹œí”¼ í—Œí„°', desc: '10ê°œ ë ˆì‹œí”¼ ë°œê²¬', icon: 'ğŸ”', requirement: () => gameState.discoveredRecipes.length >= 10, reward: 500 },
            { id: 'recipe_expert', name: 'ë ˆì‹œí”¼ ì „ë¬¸ê°€', desc: '20ê°œ ë ˆì‹œí”¼ ë°œê²¬', icon: 'ğŸ¯', requirement: () => gameState.discoveredRecipes.length >= 20, reward: 1000 },
            { id: 'recipe_master', name: 'ë ˆì‹œí”¼ ë§ˆìŠ¤í„°', desc: '30ê°œ ë ˆì‹œí”¼ ë°œê²¬', icon: 'â­', requirement: () => gameState.discoveredRecipes.length >= 30, reward: 2000 },
            { id: 'all_recipes', name: 'ì™„ë²½í•œ ì¡°í•©ì‚¬', desc: 'ëª¨ë“  ë ˆì‹œí”¼ ë°œê²¬', icon: 'ğŸŒŸ', requirement: () => gameState.discoveredRecipes.length >= recipes.length, reward: 10000 },
            { id: 'first_upgrade', name: 'ì²« ì—…ê·¸ë ˆì´ë“œ', desc: 'ì²« ì—…ê·¸ë ˆì´ë“œ êµ¬ë§¤', icon: 'â¬†ï¸', requirement: () => Object.values(gameState.upgrades).reduce((a,b) => a+b, 0) >= 1, reward: 50 },
            { id: 'upgrader', name: 'ì—…ê·¸ë ˆì´ë“œ ê´‘', desc: 'ì—…ê·¸ë ˆì´ë“œ 10íšŒ', icon: 'ğŸ”§', requirement: () => Object.values(gameState.upgrades).reduce((a,b) => a+b, 0) >= 10, reward: 500 },
            { id: 'max_upgrader', name: 'ìµœëŒ€ ì—…ê·¸ë ˆì´ë“œ', desc: 'ì—…ê·¸ë ˆì´ë“œ 50íšŒ', icon: 'âš™ï¸', requirement: () => Object.values(gameState.upgrades).reduce((a,b) => a+b, 0) >= 50, reward: 5000 },
            { id: 'common_crafter', name: 'ì¼ë°˜ ì¡°í•©ì‚¬', desc: 'ì¼ë°˜ í¬ì…˜ 10ê°œ ë°œê²¬', icon: 'ğŸŸ¢', requirement: () => gameState.discoveredRecipes.filter(r => recipes.find(re => re.name === r && re.rarity === 'common')).length >= 10, reward: 300 },
            { id: 'rare_crafter', name: 'í¬ê·€ ì¡°í•©ì‚¬', desc: 'í¬ê·€ í¬ì…˜ 5ê°œ ë°œê²¬', icon: 'ğŸ”µ', requirement: () => gameState.discoveredRecipes.filter(r => recipes.find(re => re.name === r && re.rarity === 'rare')).length >= 5, reward: 800 },
            { id: 'epic_crafter', name: 'ì˜ì›… ì¡°í•©ì‚¬', desc: 'ì˜ì›… í¬ì…˜ 5ê°œ ë°œê²¬', icon: 'ğŸŸ£', requirement: () => gameState.discoveredRecipes.filter(r => recipes.find(re => re.name === r && re.rarity === 'epic')).length >= 5, reward: 2000 },
            { id: 'legendary_crafter', name: 'ì „ì„¤ ì¡°í•©ì‚¬', desc: 'ì „ì„¤ í¬ì…˜ 3ê°œ ë°œê²¬', icon: 'ğŸŸ ', requirement: () => gameState.discoveredRecipes.filter(r => recipes.find(re => re.name === r && re.rarity === 'legendary')).length >= 3, reward: 5000 },
            { id: 'speed_brewer', name: 'ë¹ ë¥¸ ì¡°í•©ì‚¬', desc: '1ë¶„ì— 10ê°œ í¬ì…˜ ì¡°í•©', icon: 'âš¡', requirement: () => false, reward: 1000 }, // Special achievement
            { id: 'patient_brewer', name: 'ì¸ë‚´ì˜ ì¡°í•©ì‚¬', desc: '30ì¼ ì—°ì† í”Œë ˆì´', icon: 'ğŸ“…', requirement: () => false, reward: 10000 }, // Special achievement
            { id: 'lucky_seven', name: 'í–‰ìš´ì˜ 7', desc: '777 ê³¨ë“œ ì •í™•íˆ ë³´ìœ ', icon: 'ğŸ°', requirement: () => Math.floor(gameState.gold) === 777, reward: 777 },
            { id: 'hoarder', name: 'ìˆ˜ì§‘ê´‘', desc: 'ì¬ë£Œ 100ê°œ ë³´ìœ ', icon: 'ğŸ“¦', requirement: () => Object.values(gameState.ingredients).reduce((a,b) => a+b, 0) >= 100, reward: 500 },
            { id: 'customer_king', name: 'ê³ ê°ì™•', desc: '100ëª… ì†ë‹˜ ì‘ëŒ€', icon: 'ğŸ‘¥', requirement: () => gameState.totalCustomersServed >= 100, reward: 1000 },
            { id: 'automation_master', name: 'ìë™í™” ë§ˆìŠ¤í„°', desc: 'ìë™íŒë§¤ ë ˆë²¨ 10', icon: 'ğŸ¤–', requirement: () => gameState.upgrades.autoSell >= 10, reward: 3000 }
        ];
        
        // Add more game state tracking
        gameState.totalCustomersServed = 0;
        gameState.brewingStreak = 0;
        gameState.lastBrewTime = 0;
        gameState.playDays = new Set();
        
        // Rarity colors for better UI
        const RARITY_COLORS = {
            common: 'rgba(46, 213, 115, 0.3)',
            uncommon: 'rgba(52, 172, 224, 0.3)',
            rare: 'rgba(155, 89, 182, 0.3)',
            epic: 'rgba(230, 126, 34, 0.3)',
            legendary: 'rgba(241, 196, 15, 0.4)'
        };
        
        const RARITY_LABELS = {
            common: 'ì¼ë°˜',
            uncommon: 'ê³ ê¸‰',
            rare: 'í¬ê·€',
            epic: 'ì˜ì›…',
            legendary: 'ì „ì„¤'
        };

        // Audio Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration, type = 'sine') {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration);
        }

        function playBrewSound() {
            playSound(523, 0.1);
            setTimeout(() => playSound(659, 0.1), 100);
            setTimeout(() => playSound(784, 0.2), 200);
        }

        function playSellSound() {
            playSound(880, 0.05);
            setTimeout(() => playSound(1046, 0.1), 50);
        }

        function playUpgradeSound() {
            playSound(440, 0.1);
            setTimeout(() => playSound(554, 0.1), 80);
            setTimeout(() => playSound(659, 0.15), 160);
        }

        // Initialize ingredients
        ingredients.forEach(ing => {
            gameState.ingredients[ing.id] = 0;
        });

        // Initialize achievements
        achievements.forEach(ach => {
            gameState.achievements[ach.id] = false;
        });

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function selectIngredient(ingredientId) {
            const index = gameState.selectedIngredients.indexOf(ingredientId);
            
            if (index > -1) {
                gameState.selectedIngredients.splice(index, 1);
            } else if (gameState.selectedIngredients.length < 3) {
                if (gameState.ingredients[ingredientId] > 0) {
                    gameState.selectedIngredients.push(ingredientId);
                }
            }
            
            updateUI();
        }

        function clearSelection() {
            gameState.selectedIngredients = [];
            updateUI();
        }

        function brewPotion() {
            if (gameState.selectedIngredients.length < 2) return;
            
            // Check if we have ingredients
            for (let ingId of gameState.selectedIngredients) {
                if (gameState.ingredients[ingId] <= 0) return;
            }
            
            // Consume ingredients
            gameState.selectedIngredients.forEach(ingId => {
                gameState.ingredients[ingId]--;
            });
            
            // Find matching recipe
            const sortedSelected = [...gameState.selectedIngredients].sort();
            const recipe = recipes.find(r => {
                const sortedRecipe = [...r.ingredients].sort();
                return JSON.stringify(sortedRecipe) === JSON.stringify(sortedSelected);
            });
            
            if (recipe) {
                // New recipe discovered
                if (!gameState.discoveredRecipes.includes(recipe.name)) {
                    gameState.discoveredRecipes.push(recipe.name);
                    showNotification(`ğŸ‰ ìƒˆë¡œìš´ ë ˆì‹œí”¼ ë°œê²¬: ${recipe.icon} ${recipe.name}!`);
                }
                
                const cauldronBonus = 1 + (gameState.upgrades.cauldron * 0.1);
                const value = Math.floor(recipe.value * cauldronBonus);
                gameState.gold += value;
                gameState.totalGoldEarned += value;
                
                createParticle(recipe.icon);
                playBrewSound();
            } else {
                // Unknown combination
                const baseValue = gameState.selectedIngredients.reduce((sum, ingId) => {
                    const ing = ingredients.find(i => i.id === ingId);
                    return sum + ing.baseValue;
                }, 0);
                gameState.gold += baseValue;
                gameState.totalGoldEarned += baseValue;
                createParticle('ğŸ’§');
                playBrewSound();
            }
            
            gameState.totalPotionsBrewed++;
            gameState.selectedIngredients = [];
            checkAchievements();
            updateUI();
        }

        function gatherIngredients() {
            const cost = 10 + (gameState.upgrades.gathering * 5);
            if (gameState.gold < cost) return;
            
            gameState.gold -= cost;
            const count = 1 + gameState.upgrades.gathering;
            
            for (let i = 0; i < count; i++) {
                const randomIng = ingredients[Math.floor(Math.random() * ingredients.length)];
                gameState.ingredients[randomIng.id]++;
            }
            
            playSound(400, 0.1);
            createParticle('ğŸŒ¿');
            updateUI();
        }

        function upgradeShop(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            const currentLevel = gameState.upgrades[upgradeId];
            const cost = Math.floor(upgrade.baseCost * Math.pow(1.5, currentLevel));
            
            if (gameState.gold < cost) return;
            
            gameState.gold -= cost;
            gameState.upgrades[upgradeId]++;
            
            playUpgradeSound();
            createParticle('â¬†ï¸');
            updateUI();
        }

        function addCustomer() {
            const maxCustomers = 3 + gameState.upgrades.display;
            if (gameState.customers.length >= maxCustomers) return;
            
            const customerIcons = ['ğŸ‘¨', 'ğŸ‘©', 'ğŸ§™', 'ğŸ§', 'ğŸ§›', 'ğŸ§š', 'ğŸ¤´', 'ğŸ‘¸'];
            const icon = customerIcons[Math.floor(Math.random() * customerIcons.length)];
            
            gameState.customers.push({
                icon,
                timeLeft: 30,
                recipe: recipes[Math.floor(Math.random() * recipes.length)]
            });
            
            updateUI();
        }

        function updateCustomers() {
            gameState.customers = gameState.customers.filter(customer => {
                customer.timeLeft--;
                
                if (customer.timeLeft <= 0) {
                    return false;
                }
                
                // Auto-sell if available
                if (gameState.upgrades.autoSell > 0 && 
                    gameState.discoveredRecipes.includes(customer.recipe.name)) {
                    const sellChance = 0.1 * gameState.upgrades.autoSell;
                    if (Math.random() < sellChance) {
                        const cauldronBonus = 1 + (gameState.upgrades.cauldron * 0.1);
                        const value = Math.floor(customer.recipe.value * cauldronBonus);
                        gameState.gold += value;
                        gameState.totalGoldEarned += value;
                        playSellSound();
                        createParticle('ğŸ’°');
                        return false;
                    }
                }
                
                return true;
            });
            
            updateUI();
        }

        function createParticle(icon) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = icon;
            particle.style.left = (window.innerWidth / 2) + 'px';
            particle.style.top = (window.innerHeight / 2) + 'px';
            document.body.appendChild(particle);
            
            setTimeout(() => particle.remove(), 1000);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'event-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideDown 0.5s ease-out reverse';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function checkAchievements() {
            achievements.forEach(ach => {
                if (!gameState.achievements[ach.id] && ach.requirement()) {
                    gameState.achievements[ach.id] = true;
                    showNotification(`ğŸ† ì—…ì  ë‹¬ì„±: ${ach.name}!`);
                    playUpgradeSound();
                }
            });
        }

        function triggerRandomEvent() {
            const events = [
                { 
                    name: 'ëŒ€ëª©ì¥', 
                    message: 'ğŸ‰ ì†ë‹˜ì´ ëª°ë ¤ì™”ìŠµë‹ˆë‹¤!',
                    effect: () => {
                        for (let i = 0; i < 3; i++) addCustomer();
                    }
                },
                { 
                    name: 'í–‰ìš´ì˜ ë‚ ', 
                    message: 'âœ¨ í–‰ìš´ì˜ ì—¬ì‹ ì´ ë¯¸ì†Œì§“ìŠµë‹ˆë‹¤!',
                    effect: () => {
                        gameState.gold += 1000;
                        gameState.totalGoldEarned += 1000;
                    }
                },
                { 
                    name: 'í’ë…„', 
                    message: 'ğŸŒ¿ ì¬ë£Œê°€ í’ì„±í•©ë‹ˆë‹¤!',
                    effect: () => {
                        ingredients.forEach(ing => {
                            gameState.ingredients[ing.id] += 5;
                        });
                    }
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showNotification(event.message);
            event.effect();
            updateUI();
        }

        function checkDailyReward() {
            const now = Date.now();
            const lastReward = gameState.lastDailyReward || 0;
            const dayInMs = 24 * 60 * 60 * 1000;
            
            if (now - lastReward >= dayInMs) {
                showDailyRewardModal();
            }
        }

        function showDailyRewardModal() {
            const modal = document.createElement('div');
            modal.className = 'daily-reward-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-icon">ğŸ</div>
                    <div class="modal-title">ì¼ì¼ ë³´ìƒ!</div>
                    <div class="modal-text">500 ê³¨ë“œë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!</div>
                    <button class="btn" onclick="claimDailyReward(this)">ë°›ê¸°</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function claimDailyReward(button) {
            gameState.gold += 500;
            gameState.totalGoldEarned += 500;
            gameState.lastDailyReward = Date.now();
            playSellSound();
            button.closest('.daily-reward-modal').remove();
            updateUI();
        }

        function calculateOfflineProgress() {
            const now = Date.now();
            const timePassed = Math.min(now - gameState.lastSave, 3600000); // Max 1 hour
            const secondsPassed = Math.floor(timePassed / 1000);
            
            if (secondsPassed > 60 && gameState.upgrades.autoSell > 0) {
                const avgValue = recipes.reduce((sum, r) => sum + r.value, 0) / recipes.length;
                const cauldronBonus = 1 + (gameState.upgrades.cauldron * 0.1);
                const goldPerSecond = (avgValue * cauldronBonus) / 30;
                const offlineGold = Math.floor(goldPerSecond * secondsPassed * 0.5); // 50% efficiency
                
                if (offlineGold > 0) {
                    gameState.gold += offlineGold;
                    gameState.totalGoldEarned += offlineGold;
                    showNotification(`ğŸ’° ì˜¤í”„ë¼ì¸ ìˆ˜ìµ: ${offlineGold} ê³¨ë“œ!`);
                }
            }
        }

        function updateUI() {
            // Update stats with detailed information and animations
            const goldElement = document.getElementById('gold');
            const newGold = Math.floor(gameState.gold).toLocaleString();
            if (goldElement.textContent !== newGold) {
                goldElement.textContent = newGold;
                goldElement.style.transform = 'scale(1.2)';
                setTimeout(() => goldElement.style.transform = 'scale(1)', 200);
            }
            
            const avgValue = recipes.reduce((sum, r) => sum + r.value, 0) / recipes.length;
            const cauldronBonus = 1 + (gameState.upgrades.cauldron * 0.1);
            const goldPerSec = gameState.upgrades.autoSell > 0 ? 
                ((avgValue * cauldronBonus) / 30).toFixed(1) : 0;
            document.getElementById('goldPerSec').textContent = goldPerSec;
            
            const recipesFoundElement = document.getElementById('recipesFound');
            recipesFoundElement.textContent = `${gameState.discoveredRecipes.length}/${recipes.length}`;
            
            const achievementCount = Object.values(gameState.achievements).filter(v => v).length;
            const achievementElement = document.getElementById('achievementCount');
            achievementElement.textContent = `${achievementCount}/${achievements.length}`;
            
            // Add progress bars for visual feedback
            const recipeProgress = (gameState.discoveredRecipes.length / recipes.length) * 100;
            const achievementProgress = (achievementCount / achievements.length) * 100;
            
            // Update ingredients grid
            const ingredientsGrid = document.getElementById('ingredientsGrid');
            ingredientsGrid.innerHTML = ingredients.map(ing => `
                <div class="ingredient-card ${gameState.selectedIngredients.includes(ing.id) ? 'selected' : ''}"
                     onclick="selectIngredient('${ing.id}')">
                    <div class="ingredient-icon">${ing.icon}</div>
                    <div class="ingredient-name">${ing.name}</div>
                    <div class="ingredient-count">${gameState.ingredients[ing.id]}ê°œ</div>
                </div>
            `).join('');
            
            // Update selected ingredients
            const selectedDiv = document.getElementById('selectedIngredients');
            if (gameState.selectedIngredients.length > 0) {
                selectedDiv.innerHTML = gameState.selectedIngredients.map(ingId => {
                    const ing = ingredients.find(i => i.id === ingId);
                    return `<div class="selected-ingredient">${ing.icon}</div>`;
                }).join('');
            } else {
                selectedDiv.innerHTML = '<div style="opacity: 0.5; font-size: 14px;">ì¬ë£Œë¥¼ ì„ íƒí•˜ì„¸ìš” (2-3ê°œ)</div>';
            }
            
            // Update brew button
            const brewBtn = document.getElementById('brewBtn');
            brewBtn.disabled = gameState.selectedIngredients.length < 2 ||
                !gameState.selectedIngredients.every(ingId => gameState.ingredients[ingId] > 0);
            
            // Update gather cost
            document.getElementById('gatherCost').textContent = 10 + (gameState.upgrades.gathering * 5);
            
            // Update customers queue
            const customersQueue = document.getElementById('customersQueue');
            if (gameState.customers.length > 0) {
                customersQueue.innerHTML = gameState.customers.map(customer => `
                    <div class="customer">
                        <div class="customer-icon">${customer.icon}</div>
                        <div class="customer-timer">${customer.timeLeft}ì´ˆ</div>
                    </div>
                `).join('');
            } else {
                customersQueue.innerHTML = '<div style="opacity: 0.5; padding: 8px;">ì†ë‹˜ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>';
            }
            
            // Update upgrades grid
            const upgradesGrid = document.getElementById('upgradesGrid');
            upgradesGrid.innerHTML = upgrades.map(upgrade => {
                const currentLevel = gameState.upgrades[upgrade.id];
                const cost = Math.floor(upgrade.baseCost * Math.pow(1.5, currentLevel));
                const canAfford = gameState.gold >= cost;
                
                return `
                    <div class="upgrade-card">
                        <div class="upgrade-header">
                            <div class="upgrade-title">${upgrade.icon} ${upgrade.name}</div>
                            <div class="upgrade-level">Lv.${currentLevel}</div>
                        </div>
                        <div class="upgrade-description">${upgrade.description}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 12px;">
                            íš¨ê³¼: ${upgrade.effect(currentLevel)}
                        </div>
                        <button class="btn ${canAfford ? '' : 'disabled'}" 
                                onclick="upgradeShop('${upgrade.id}')"
                                ${!canAfford ? 'disabled' : ''}>
                            ğŸ’° ${cost.toLocaleString()} ê³¨ë“œë¡œ ì—…ê·¸ë ˆì´ë“œ
                        </button>
                    </div>
                `;
            }).join('');
            
            // Update recipes grid
            const recipesGrid = document.getElementById('recipesGrid');
            recipesGrid.innerHTML = recipes.map(recipe => {
                const discovered = gameState.discoveredRecipes.includes(recipe.name);
                const ingredientNames = recipe.ingredients.map(ingId => {
                    const ing = ingredients.find(i => i.id === ingId);
                    return `${ing.icon} ${ing.name}`;
                }).join(' + ');
                
                return `
                    <div class="recipe-card ${!discovered ? 'locked' : ''}">
                        <div class="recipe-name">${recipe.icon} ${discovered ? recipe.name : '???'}</div>
                        <div class="recipe-ingredients">${discovered ? ingredientNames : '???'}</div>
                        <div class="recipe-value">${discovered ? `ê°€ì¹˜: ${recipe.value} ê³¨ë“œ` : 'ì¡°í•©í•˜ì—¬ ë°œê²¬í•˜ì„¸ìš”'}</div>
                    </div>
                `;
            }).join('');
            
            // Update achievements grid
            const achievementsGrid = document.getElementById('achievementsGrid');
            achievementsGrid.innerHTML = achievements.map(ach => {
                const unlocked = gameState.achievements[ach.id];
                return `
                    <div class="achievement-card ${unlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${ach.icon}</div>
                        <div class="achievement-info">
                            <div class="achievement-name">${ach.name}</div>
                            <div class="achievement-desc">${ach.desc}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function saveGame() {
            gameState.lastSave = Date.now();
            localStorage.setItem('potionCraftTycoon', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('potionCraftTycoon');
            if (saved) {
                Object.assign(gameState, JSON.parse(saved));
                calculateOfflineProgress();
            }
            checkDailyReward();
            updateUI();
        }

        // Game loop
        setInterval(() => {
            updateCustomers();
            
            if (Math.random() < 0.3) {
                addCustomer();
            }
            
            if (Math.random() < 0.01) {
                triggerRandomEvent();
            }
            
            saveGame();
        }, 1000);

        // Initialize
        loadGame();
        
        // Save on page unload
        window.addEventListener('beforeunload', saveGame);
    </script>
</body>
</html>