<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A/B Test Calculator | AB í…ŒìŠ¤íŠ¸ ê³„ì‚°ê¸°</title>
  <meta name="description" content="A/B í…ŒìŠ¤íŠ¸ ì „í™˜ìœ¨, uplift, z-score, p-valueë¥¼ ê³„ì‚°í•˜ëŠ” í†µê³„ ê³„ì‚°ê¸°" />
  <style>
    :root {
      --bg: #0d111a;
      --panel: #171d2d;
      --panel-2: #11172a;
      --line: #2a3554;
      --text: #e8efff;
      --muted: #aab5d8;
      --a: #7c95ff;
      --b: #36d8b1;
      --warn: #ffbc5f;
      --danger: #ff6e72;
      --shadow: 0 16px 34px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--text);
      background: radial-gradient(circle at 12% -10%, #212d56 0%, #0d111a 45%);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      min-height: 100vh;
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 20px 14px 64px; }
    .head { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 14px; }
    h1 { margin: 0; font-size: clamp(1.15rem, 2.8vw, 1.7rem); }
    .sub { margin-top: 5px; color: var(--muted); font-size: .9rem; }
    .home {
      text-decoration: none;
      color: #d9e4ff;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: #121a31;
      padding: 8px 12px;
      font-size: .88rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    .card {
      background: linear-gradient(165deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .card h2 { margin: 0 0 10px; font-size: 1rem; }
    label { display: block; margin: 0 0 6px; color: var(--muted); font-size: .8rem; }
    input, select, button {
      width: 100%;
      border: 1px solid var(--line);
      background: #0d1325;
      color: var(--text);
      border-radius: 10px;
      padding: 10px 11px;
      font-size: .92rem;
    }
    input:focus, select:focus { outline: 2px solid rgba(124,149,255,.35); border-color: #5d7cf9; }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .set { margin-bottom: 10px; }
    .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
    button { border: none; cursor: pointer; font-weight: 700; background: linear-gradient(135deg, #607dff, #4e68ef); }
    .soft { background: #1a2545; border: 1px solid var(--line); font-weight: 600; }

    .metrics {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    .pill {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px;
      background: #0f1630;
      min-height: 76px;
    }
    .k { color: var(--muted); font-size: .76rem; margin-bottom: 5px; }
    .v { font-size: 1.03rem; font-weight: 800; }
    .va { color: var(--a); }
    .vb { color: var(--b); }
    .warn { color: var(--warn); }
    .danger { color: var(--danger); }

    .result {
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      background: #0f1732;
      font-size: .9rem;
      line-height: 1.5;
    }
    .bar-wrap { margin-top: 12px; }
    .bar {
      width: 100%;
      height: 14px;
      border-radius: 999px;
      overflow: hidden;
      background: #182447;
      border: 1px solid #314676;
    }
    .fill {
      height: 100%;
      width: 50%;
      background: linear-gradient(90deg, var(--a), var(--b));
      transition: width .3s ease;
    }
    .mini { color: var(--muted); font-size: .78rem; margin-top: 6px; }

    .table-wrap {
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: auto;
      margin-top: 10px;
      background: #0e1631;
    }
    table { width: 100%; border-collapse: collapse; min-width: 620px; }
    th, td {
      border-bottom: 1px solid #23345f;
      padding: 8px;
      font-size: .82rem;
      text-align: right;
      white-space: nowrap;
    }
    th:first-child, td:first-child { text-align: left; }
    th { color: #b7c4e8; background: #121f40; }

    @media (max-width: 860px) {
      .grid { grid-template-columns: 1fr; }
      .metrics { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <div class="head">
      <div>
        <h1>ğŸ§ª AB í…ŒìŠ¤íŠ¸ ê³„ì‚°ê¸°</h1>
        <div class="sub">ì „í™˜ìœ¨ ì°¨ì´ê°€ ìš°ì—°ì¸ì§€, ì‹¤ì œ ê°œì„ ì¸ì§€ ë¹ ë¥´ê²Œ ê²€ì¦í•©ë‹ˆë‹¤.</div>
      </div>
      <a class="home" href="/tools/">ì „ì²´ ë„êµ¬</a>
    </div>

    <section class="grid">
      <article class="card">
        <h2>ì‹¤í—˜ ë°ì´í„° ì…ë ¥</h2>

        <div class="set">
          <label>ê·¸ë£¹ A (ê¸°ì¤€ì•ˆ)</label>
          <div class="two">
            <input id="visA" type="number" min="1" value="12000" placeholder="ë°©ë¬¸ì ìˆ˜" />
            <input id="convA" type="number" min="0" value="936" placeholder="ì „í™˜ ìˆ˜" />
          </div>
        </div>

        <div class="set">
          <label>ê·¸ë£¹ B (ë³€ê²½ì•ˆ)</label>
          <div class="two">
            <input id="visB" type="number" min="1" value="11840" placeholder="ë°©ë¬¸ì ìˆ˜" />
            <input id="convB" type="number" min="0" value="1042" placeholder="ì „í™˜ ìˆ˜" />
          </div>
        </div>

        <div class="two">
          <div>
            <label for="alpha">ìœ ì˜ìˆ˜ì¤€ (Î±)</label>
            <select id="alpha">
              <option value="0.10">90% ì‹ ë¢° (Î±=0.10)</option>
              <option value="0.05" selected>95% ì‹ ë¢° (Î±=0.05)</option>
              <option value="0.01">99% ì‹ ë¢° (Î±=0.01)</option>
            </select>
          </div>
          <div>
            <label for="tail">ê²€ì • ìœ í˜•</label>
            <select id="tail">
              <option value="two" selected>ì–‘ì¸¡ê²€ì • (ì°¨ì´ ì¡´ì¬)</option>
              <option value="one">ë‹¨ì¸¡ê²€ì • (Bê°€ ë” í¼)</option>
            </select>
          </div>
        </div>

        <div class="btns">
          <button id="calcBtn" type="button">ê³„ì‚°</button>
          <button id="sampleBtn" type="button" class="soft">ìƒ˜í”Œ ë°ì´í„°</button>
          <button id="saveBtn" type="button" class="soft">ì €ì¥</button>
          <button id="loadBtn" type="button" class="soft">ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>

        <div class="mini">2-proportion z-test ê¸°ì¤€. ì‘ì€ í‘œë³¸ì—ì„œëŠ” ë² ì´ì§€ì•ˆ/í”¼ì…” ê²€ì •ì„ ë³‘í–‰í•˜ì„¸ìš”.</div>
      </article>

      <article class="card">
        <h2>í•µì‹¬ ê²°ê³¼</h2>

        <div class="metrics">
          <div class="pill"><div class="k">A ì „í™˜ìœ¨</div><div class="v va" id="rateA">-</div></div>
          <div class="pill"><div class="k">B ì „í™˜ìœ¨</div><div class="v vb" id="rateB">-</div></div>
          <div class="pill"><div class="k">Uplift (B vs A)</div><div class="v" id="uplift">-</div></div>
          <div class="pill"><div class="k">z-score</div><div class="v" id="zScore">-</div></div>
          <div class="pill"><div class="k">p-value</div><div class="v" id="pValue">-</div></div>
          <div class="pill"><div class="k">íŒì •</div><div class="v warn" id="decision">-</div></div>
        </div>

        <div class="bar-wrap">
          <div class="bar"><div id="fill" class="fill"></div></div>
          <div class="mini" id="fillText">ì „í™˜ìœ¨ ì°¨ì´ ì‹œê°í™”</div>
        </div>

        <div class="result" id="explain">ê°’ì„ ì…ë ¥í•˜ê³  ê³„ì‚° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
      </article>
    </section>

    <section class="card">
      <h2>ì‹ ë¢°êµ¬ê°„ & ì°¸ê³  ì§€í‘œ</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>ì§€í‘œ</th>
              <th>ê°’</th>
              <th>í•´ì„</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const KEY = 'ab-test-calculator:v1';
    const $ = (id) => document.getElementById(id);
    const refs = {
      visA: $('visA'), convA: $('convA'), visB: $('visB'), convB: $('convB'), alpha: $('alpha'), tail: $('tail'),
      calcBtn: $('calcBtn'), sampleBtn: $('sampleBtn'), saveBtn: $('saveBtn'), loadBtn: $('loadBtn'),
      rateA: $('rateA'), rateB: $('rateB'), uplift: $('uplift'), zScore: $('zScore'), pValue: $('pValue'), decision: $('decision'),
      fill: $('fill'), fillText: $('fillText'), explain: $('explain'), rows: $('rows')
    };

    function save() {
      const payload = {
        visA: refs.visA.value, convA: refs.convA.value, visB: refs.visB.value, convB: refs.convB.value, alpha: refs.alpha.value, tail: refs.tail.value
      };
      localStorage.setItem(KEY, JSON.stringify(payload));
    }

    function load() {
      try {
        const d = JSON.parse(localStorage.getItem(KEY));
        if (!d) return false;
        Object.keys(d).forEach(k => refs[k] && (refs[k].value = d[k]));
        return true;
      } catch {
        return false;
      }
    }

    function normalCdf(x) {
      return 0.5 * (1 + erf(x / Math.SQRT2));
    }

    // Numerical approximation of erf (Abramowitz & Stegun 7.1.26)
    function erf(x) {
      const sign = x < 0 ? -1 : 1;
      x = Math.abs(x);
      const a1 = 0.254829592;
      const a2 = -0.284496736;
      const a3 = 1.421413741;
      const a4 = -1.453152027;
      const a5 = 1.061405429;
      const p = 0.3275911;
      const t = 1 / (1 + p * x);
      const y = 1 - (((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x));
      return sign * y;
    }

    function zCritical(alpha, tail) {
      const target = tail === 'two' ? 1 - alpha / 2 : 1 - alpha;
      let lo = -8, hi = 8;
      for (let i = 0; i < 80; i++) {
        const mid = (lo + hi) / 2;
        if (normalCdf(mid) < target) lo = mid; else hi = mid;
      }
      return (lo + hi) / 2;
    }

    function pct(v) { return `${(v * 100).toFixed(2)}%`; }

    function run() {
      const nA = Math.max(1, Number(refs.visA.value) || 0);
      const xA = Math.max(0, Number(refs.convA.value) || 0);
      const nB = Math.max(1, Number(refs.visB.value) || 0);
      const xB = Math.max(0, Number(refs.convB.value) || 0);

      if (xA > nA || xB > nB) {
        refs.explain.textContent = 'ì „í™˜ ìˆ˜ëŠ” ë°©ë¬¸ì ìˆ˜ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        refs.explain.style.borderColor = '#8b2e3d';
        refs.explain.style.color = '#ffd9df';
        return;
      }

      const alpha = Number(refs.alpha.value);
      const tail = refs.tail.value;
      const pA = xA / nA;
      const pB = xB / nB;
      const uplift = pA === 0 ? 0 : (pB - pA) / pA;

      const pooled = (xA + xB) / (nA + nB);
      const se = Math.sqrt(Math.max(1e-15, pooled * (1 - pooled) * (1 / nA + 1 / nB)));
      const z = (pB - pA) / se;

      let p;
      if (tail === 'two') {
        p = 2 * (1 - normalCdf(Math.abs(z)));
      } else {
        p = 1 - normalCdf(z);
      }

      const zCrit = zCritical(alpha, tail);
      const seDiff = Math.sqrt(Math.max(1e-15, pA * (1 - pA) / nA + pB * (1 - pB) / nB));
      const diff = pB - pA;
      const ciLow = diff - zCrit * seDiff;
      const ciHigh = diff + zCrit * seDiff;

      const significant = p < alpha;
      const winner = pB > pA ? 'B' : (pB < pA ? 'A' : 'ë™ë¥ ');

      refs.rateA.textContent = pct(pA);
      refs.rateB.textContent = pct(pB);
      refs.uplift.textContent = `${uplift >= 0 ? '+' : ''}${(uplift * 100).toFixed(2)}%`;
      refs.zScore.textContent = z.toFixed(3);
      refs.pValue.textContent = p.toFixed(6);
      refs.decision.textContent = significant ? `ìœ ì˜í•¨ (${winner} ìš°ì„¸)` : 'ìœ ì˜í•˜ì§€ ì•ŠìŒ';
      refs.decision.className = `v ${significant ? '' : 'warn'} ${significant && winner==='A' ? 'danger' : ''}`;

      const maxRate = Math.max(pA, pB, 0.0001);
      const width = Math.max(8, Math.min(100, (pB / maxRate) * 100));
      refs.fill.style.width = `${width}%`;
      refs.fillText.textContent = `A ${pct(pA)} vs B ${pct(pB)} (ìƒëŒ€ë¹„ ${(Math.abs((pB-pA)*100)).toFixed(2)}%p)`;

      const confidence = Math.round((1 - alpha) * 100);
      let summary;
      if (significant) {
        if (winner === 'B') {
          summary = `âœ… Bì•ˆì´ Aì•ˆë³´ë‹¤ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ê²Œ ë†’ìŠµë‹ˆë‹¤ (p=${p.toFixed(5)} < Î±=${alpha}). ${confidence}% ì‹ ë¢°ìˆ˜ì¤€ì—ì„œ ë¡¤ì•„ì›ƒ í›„ë³´ì…ë‹ˆë‹¤.`;
        } else if (winner === 'A') {
          summary = `âš ï¸ Bì•ˆì´ ì˜¤íˆë ¤ ë‚®ìŠµë‹ˆë‹¤. Aì•ˆ ìœ ì§€ ê¶Œì¥ (p=${p.toFixed(5)} < Î±=${alpha}).`;
        } else {
          summary = `í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œ ì°¨ì´ê°€ ê´€ì¸¡ë˜ì—ˆìœ¼ë‚˜ ì‹¤ì œ ì°¨ì´ëŠ” ë§¤ìš° ì‘ìŠµë‹ˆë‹¤.`;
        }
      } else {
        summary = `ë³´ë¥˜ ê¶Œì¥: í˜„ì¬ í‘œë³¸ì—ì„œ ìœ ì˜í•œ ì°¨ì´ë¥¼ í™•ì¸í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ (p=${p.toFixed(5)}). í‘œë³¸ í™•ëŒ€ ë˜ëŠ” ë” í° ë³€í™” í•„ìš”.`;
      }
      refs.explain.textContent = summary;
      refs.explain.style.borderColor = significant ? '#2f4d79' : '#5b4a2c';
      refs.explain.style.color = '#e8efff';

      const rows = [
        ['ì „í™˜ìœ¨ ì°¨ì´ (B-A)', `${(diff*100).toFixed(3)}%p`, 'ì ˆëŒ€ ì „í™˜ìœ¨ ì°¨ì´'],
        [`${confidence}% ì‹ ë¢°êµ¬ê°„`, `${(ciLow*100).toFixed(3)}%p ~ ${(ciHigh*100).toFixed(3)}%p`, '0ì„ í¬í•¨í•˜ë©´ ìœ ì˜í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„± í¼'],
        ['í‘œì¤€ì˜¤ì°¨(SE, pooled)', se.toFixed(6), 'ì‘ì„ìˆ˜ë¡ ì°¨ì´ ê²€ì¶œì— ìœ ë¦¬'],
        ['ê²€ì • ìœ í˜•', tail === 'two' ? 'ì–‘ì¸¡ê²€ì •' : 'ë‹¨ì¸¡ê²€ì •(B>A)', 'ì‚¬ì „ ê°€ì„¤ê³¼ ì¼ì¹˜ì‹œì¼œ ì‚¬ìš©'],
        ['ê¶Œì¥ í•´ì„', significant ? `${winner} ìš°ì„¸ ì‹œë‚˜ë¦¬ì˜¤` : 'ì¶”ê°€ ë°ì´í„° í•„ìš”', significant ? 'ì¶œì‹œ ì „ í’ˆì§ˆ/ì„¸ê·¸ë¨¼íŠ¸ ì¬ê²€ì¦' : 'ì‹¤í—˜ ì—°ì¥ ë˜ëŠ” ì•„ì´ë””ì–´ ì¬ì„¤ê³„']
      ];

      refs.rows.innerHTML = rows.map(r => `
        <tr>
          <td>${r[0]}</td>
          <td>${r[1]}</td>
          <td style="text-align:left; color:#b9c6ea;">${r[2]}</td>
        </tr>
      `).join('');

      save();
    }

    function bind() {
      refs.calcBtn.addEventListener('click', run);
      refs.sampleBtn.addEventListener('click', () => {
        refs.visA.value = 13200; refs.convA.value = 845;
        refs.visB.value = 13140; refs.convB.value = 962;
        refs.alpha.value = '0.05'; refs.tail.value = 'two';
        run();
      });
      refs.saveBtn.addEventListener('click', () => { save(); alert('ì…ë ¥ê°’ ì €ì¥ ì™„ë£Œ'); });
      refs.loadBtn.addEventListener('click', () => {
        if (!load()) return alert('ì €ì¥ëœ ê°’ì´ ì—†ìŠµë‹ˆë‹¤.');
        run();
      });

      [refs.visA, refs.convA, refs.visB, refs.convB, refs.alpha, refs.tail].forEach(node => node.addEventListener('change', run));
    }

    function init() {
      load();
      bind();
      run();
    }

    init();
  </script>
</body>
</html>
