<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Prompt Builder - AI í”„ë¡¬í”„íŠ¸ ë¹Œë” | EastSea Tools</title>
<meta name="description" content="ChatGPT, Claude, Midjourney, Stable Diffusionìš© êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ì‰½ê²Œ ìƒì„±í•˜ì„¸ìš”. í…œí”Œë¦¿ í”„ë¦¬ì…‹, í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬, ì›í´ë¦­ ë³µì‚¬.">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f0f2f5;--surface:#fff;--surface2:#f7f8fa;--text:#1a1a2e;--text2:#555;--text3:#888;
  --primary:#8b5cf6;--primary-light:#a78bfa;--primary-bg:rgba(139,92,246,.08);
  --accent:#ec4899;--accent-bg:rgba(236,72,153,.08);
  --success:#22c55e;--warning:#f59e0b;
  --border:#e2e8f0;--shadow:0 1px 3px rgba(0,0,0,.08);--shadow-lg:0 8px 24px rgba(0,0,0,.12);
  --radius:12px;--radius-sm:8px;
}
[data-theme="dark"]{
  --bg:#0f172a;--surface:#1e293b;--surface2:#334155;--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
  --border:#334155;--shadow:0 1px 3px rgba(0,0,0,.3);--shadow-lg:0 8px 24px rgba(0,0,0,.4);
  --primary-bg:rgba(139,92,246,.15);--accent-bg:rgba(236,72,153,.15);
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:background .3s,color .3s}
header{background:var(--surface);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;position:sticky;top:0;z-index:100;box-shadow:var(--shadow)}
header h1{font-size:1.3rem;display:flex;align-items:center;gap:8px}
.btn{cursor:pointer;border:none;font:inherit;border-radius:var(--radius-sm);padding:8px 16px;font-size:.875rem;font-weight:600;transition:all .2s}
.btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:var(--primary-light)}
.btn-ghost{background:transparent;color:var(--text2)}.btn-ghost:hover{background:var(--primary-bg);color:var(--primary)}
.btn-accent{background:var(--accent);color:#fff}.btn-accent:hover{opacity:.9}
.btn-icon{width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;background:var(--surface2);border:1px solid var(--border);cursor:pointer;border-radius:var(--radius-sm)}
.btn-icon:hover{background:var(--primary-bg);border-color:var(--primary)}
.container{max-width:1200px;margin:0 auto;padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:768px){.container{grid-template-columns:1fr}}
.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.panel-header{padding:14px 18px;border-bottom:1px solid var(--border);font-weight:700;font-size:.95rem;display:flex;align-items:center;justify-content:space-between;gap:8px}
.panel-body{padding:18px}
.tabs{display:flex;gap:4px;padding:12px 18px;border-bottom:1px solid var(--border);overflow-x:auto;flex-wrap:nowrap}
.tab{padding:8px 16px;border-radius:var(--radius-sm);font-size:.85rem;font-weight:600;cursor:pointer;white-space:nowrap;border:none;background:transparent;color:var(--text2);transition:all .2s}
.tab.active{background:var(--primary);color:#fff}
.tab:hover:not(.active){background:var(--primary-bg);color:var(--primary)}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.8rem;font-weight:600;color:var(--text2);margin-bottom:6px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--surface2);color:var(--text);font:inherit;font-size:.9rem;transition:border-color .2s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{outline:none;border-color:var(--primary)}
.form-group textarea{resize:vertical;min-height:80px}
.chip-group{display:flex;flex-wrap:wrap;gap:6px}
.chip{padding:6px 12px;border-radius:20px;font-size:.8rem;cursor:pointer;border:1px solid var(--border);background:var(--surface2);color:var(--text2);transition:all .2s}
.chip:hover,.chip.active{background:var(--primary-bg);border-color:var(--primary);color:var(--primary)}
.output-area{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;min-height:200px;white-space:pre-wrap;word-break:break-word;font-size:.9rem;line-height:1.6;font-family:'SF Mono',Monaco,Consolas,monospace;max-height:400px;overflow-y:auto}
.output-actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(60px);background:var(--primary);color:#fff;padding:10px 24px;border-radius:var(--radius-sm);font-size:.9rem;font-weight:600;z-index:300;transition:transform .3s;box-shadow:var(--shadow-lg)}
.toast.show{transform:translateX(-50%) translateY(0)}
.history-list{max-height:300px;overflow-y:auto}
.history-item{padding:10px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .2s;display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
.history-item:hover{background:var(--primary-bg)}
.history-item:last-child{border-bottom:none}
.history-text{flex:1;font-size:.8rem;color:var(--text2);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.history-meta{font-size:.7rem;color:var(--text3);white-space:nowrap}
.history-del{font-size:.7rem;cursor:pointer;padding:2px 6px;border:none;background:transparent;color:var(--text3);border-radius:4px}
.history-del:hover{color:#ef4444;background:rgba(239,68,68,.1)}
.preset-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-bottom:14px}
.preset-card{padding:10px;border:1px solid var(--border);border-radius:var(--radius-sm);cursor:pointer;text-align:center;transition:all .2s;background:var(--surface2)}
.preset-card:hover{border-color:var(--primary);background:var(--primary-bg)}
.preset-card .preset-icon{font-size:1.3rem;margin-bottom:4px}
.preset-card .preset-name{font-size:.75rem;font-weight:600}
.mj-params{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:480px){.mj-params{grid-template-columns:1fr}}
.section-label{font-size:.75rem;font-weight:700;color:var(--primary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;margin-top:4px}
</style>
</head>
<body>
<header>
  <h1><span>ğŸ¤–</span> AI Prompt Builder</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <button class="btn-icon" onclick="toggleHistory()" title="íˆìŠ¤í† ë¦¬">ğŸ“œ</button>
    <button class="btn-icon" id="themeToggle" onclick="toggleTheme()" title="í…Œë§ˆ ì „í™˜">ğŸŒ™</button>
  </div>
</header>

<div class="container">
  <div>
    <div class="panel">
      <div class="tabs" id="modeTabs">
        <button class="tab active" data-mode="text">ğŸ’¬ Text AI</button>
        <button class="tab" data-mode="midjourney">ğŸ¨ Midjourney</button>
        <button class="tab" data-mode="stablediff">ğŸ–¼ï¸ Stable Diffusion</button>
      </div>

      <div class="panel-body" id="textForm">
        <div class="section-label">ğŸ“Œ í”„ë¦¬ì…‹ í…œí”Œë¦¿</div>
        <div class="preset-grid" id="presetGrid"></div>

        <div class="form-group">
          <label>ğŸ­ ì—­í•  (Role)</label>
          <input type="text" id="role" placeholder="ì˜ˆ: ì‹œë‹ˆì–´ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì, ë§ˆì¼€íŒ… ì „ë¬¸ê°€">
        </div>
        <div class="form-group">
          <label>ğŸ“‹ ì»¨í…ìŠ¤íŠ¸</label>
          <textarea id="context" placeholder="ë°°ê²½ ì •ë³´, ìƒí™© ì„¤ëª…"></textarea>
        </div>
        <div class="form-group">
          <label>ğŸ¯ íƒœìŠ¤í¬</label>
          <textarea id="task" placeholder="ìˆ˜í–‰í•´ì•¼ í•  êµ¬ì²´ì ì¸ ì‘ì—…"></textarea>
        </div>
        <div class="form-group">
          <label>ğŸ“ ì¶œë ¥ í¬ë§·</label>
          <div class="chip-group" id="formatChips"></div>
        </div>
        <div class="form-group">
          <label>ğŸ—£ï¸ í†¤</label>
          <div class="chip-group" id="toneChips"></div>
        </div>
        <div class="form-group">
          <label>ğŸŒ ì–¸ì–´</label>
          <select id="lang">
            <option value="">ì§€ì • ì•ˆí•¨</option>
            <option value="í•œêµ­ì–´" selected>í•œêµ­ì–´</option>
            <option value="English">English</option>
            <option value="æ—¥æœ¬èª">æ—¥æœ¬èª</option>
            <option value="ä¸­æ–‡">ä¸­æ–‡</option>
          </select>
        </div>
      </div>

      <div class="panel-body" id="mjForm" style="display:none">
        <div class="form-group">
          <label>ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„¤ëª…</label>
          <textarea id="mjPrompt" placeholder="A futuristic city at sunset, cyberpunk style..."></textarea>
        </div>
        <div class="mj-params">
          <div class="form-group">
            <label>ìŠ¤íƒ€ì¼</label>
            <select id="mjStyle">
              <option value="">ì„ íƒ ì•ˆí•¨</option>
              <option value="photorealistic">Photorealistic</option>
              <option value="anime">Anime</option>
              <option value="oil painting">Oil Painting</option>
              <option value="watercolor">Watercolor</option>
              <option value="digital art">Digital Art</option>
              <option value="3d render">3D Render</option>
              <option value="pixel art">Pixel Art</option>
              <option value="pencil sketch">Pencil Sketch</option>
              <option value="comic book">Comic Book</option>
              <option value="cinematic">Cinematic</option>
            </select>
          </div>
          <div class="form-group">
            <label>ë¹„ìœ¨ (--ar)</label>
            <select id="mjAr">
              <option value="">ê¸°ë³¸</option>
              <option value="1:1">1:1 (ì •ì‚¬ê°)</option>
              <option value="16:9">16:9 (ì™€ì´ë“œ)</option>
              <option value="9:16">9:16 (ì„¸ë¡œ)</option>
              <option value="4:3">4:3</option>
              <option value="3:2">3:2</option>
              <option value="2:3">2:3</option>
            </select>
          </div>
          <div class="form-group">
            <label>ë²„ì „ (--v)</label>
            <select id="mjVersion">
              <option value="6.1">v6.1</option>
              <option value="6">v6</option>
              <option value="5.2">v5.2</option>
              <option value="niji 6">Niji 6</option>
            </select>
          </div>
          <div class="form-group">
            <label>ìŠ¤íƒ€ì¼ë¼ì´ì¦ˆ (--s)</label>
            <input type="number" id="mjStylize" placeholder="0-1000" min="0" max="1000">
          </div>
          <div class="form-group">
            <label>í˜¼ëˆë„ (--chaos)</label>
            <input type="number" id="mjChaos" placeholder="0-100" min="0" max="100">
          </div>
          <div class="form-group">
            <label>í’ˆì§ˆ (--q)</label>
            <select id="mjQuality">
              <option value="1">Standard (1)</option>
              <option value="0.5">Draft (0.5)</option>
              <option value="2">High (2)</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>ë„¤ê±°í‹°ë¸Œ (--no)</label>
          <input type="text" id="mjNo" placeholder="ì˜ˆ: text, watermark, blurry">
        </div>
      </div>

      <div class="panel-body" id="sdForm" style="display:none">
        <div class="form-group">
          <label>ğŸ–¼ï¸ í”„ë¡¬í”„íŠ¸</label>
          <textarea id="sdPrompt" placeholder="masterpiece, best quality, 1girl, white dress..."></textarea>
        </div>
        <div class="form-group">
          <label>ğŸ“ í’ˆì§ˆ íƒœê·¸</label>
          <div class="chip-group" id="sdQualityChips"></div>
        </div>
        <div class="form-group">
          <label>ğŸ¨ ìŠ¤íƒ€ì¼ íƒœê·¸</label>
          <div class="chip-group" id="sdStyleChips"></div>
        </div>
        <div class="form-group">
          <label>ğŸš« ë„¤ê±°í‹°ë¸Œ í”„ë¡¬í”„íŠ¸</label>
          <textarea id="sdNeg" placeholder="lowres, bad anatomy, worst quality..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <div>
    <div class="panel">
      <div class="panel-header">
        <span>ğŸ“ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</span>
        <button class="btn btn-primary" onclick="generate()" style="padding:6px 14px;font-size:.8rem">ìƒì„± âš¡</button>
      </div>
      <div class="panel-body">
        <div class="output-area" id="output">í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        <div class="output-actions">
          <button class="btn btn-primary" onclick="copyPrompt()">ğŸ“‹ ë³µì‚¬</button>
          <button class="btn btn-ghost" onclick="saveToHistory()">ğŸ’¾ ì €ì¥</button>
          <button class="btn btn-ghost" onclick="clearForm()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <div class="panel" id="historyPanel" style="margin-top:16px;display:none">
      <div class="panel-header">
        <span>ğŸ“œ í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬</span>
        <button class="btn btn-ghost" onclick="clearHistory()" style="padding:4px 10px;font-size:.75rem">ì „ì²´ ì‚­ì œ</button>
      </div>
      <div class="history-list" id="historyList"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const LS_HIST='prompt-history-v1';
const LS_THEME='prompt-theme';

let currentMode='text';
let selectedFormats=[];
let selectedTones=[];
let sdQualityTags=[];
let sdStyleTags=[];

const formats=['ë§ˆí¬ë‹¤ìš´','JSON','ëª©ë¡','í‘œ','ì½”ë“œ','ë‹¨ê³„ë³„','ìš”ì•½','ì—ì„¸ì´'];
const tones=['ì „ë¬¸ì ','ì¹œê·¼í•œ','ê²©ì‹ì²´','ìœ ë¨¸ëŸ¬ìŠ¤','ê°„ê²°í•œ','êµìœ¡ì ','ì„¤ë“ì ','ì°½ì˜ì '];
const sdQualities=['masterpiece','best quality','ultra-detailed','high resolution','8k','absurdres'];
const sdStyles=['anime','photorealistic','digital painting','concept art','illustration','oil painting','watercolor','cyberpunk','fantasy'];

const presets=[
  {icon:'ğŸ’»',name:'ì½”ë“œ ë¦¬ë·°',role:'ì‹œë‹ˆì–´ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´',context:'ì½”ë“œ ë¦¬ë·°ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.',task:'ì£¼ì–´ì§„ ì½”ë“œë¥¼ ë¶„ì„í•˜ê³  ê°œì„ ì , ë²„ê·¸, ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆì„ ì œì‹œí•´ì£¼ì„¸ìš”.',format:'ëª©ë¡',tone:'ì „ë¬¸ì '},
  {icon:'ğŸ“',name:'ë¸”ë¡œê·¸ ì‘ì„±',role:'ì „ë¬¸ ë¸”ë¡œê±° ê²¸ ì½˜í…ì¸  ì‘ê°€',context:'SEO ìµœì í™”ëœ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.',task:'ì£¼ì–´ì§„ ì£¼ì œë¡œ 2000ì ì´ìƒì˜ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”. ì„œë¡ , ë³¸ë¡ , ê²°ë¡  êµ¬ì¡°ë¡œ.',format:'ë§ˆí¬ë‹¤ìš´',tone:'ì¹œê·¼í•œ'},
  {icon:'ğŸ“Š',name:'ë°ì´í„° ë¶„ì„',role:'ë°ì´í„° ë¶„ì„ê°€',context:'ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.',task:'ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  í•µì‹¬ ì¸ì‚¬ì´íŠ¸ì™€ ì•¡ì…˜ ì•„ì´í…œì„ ì œì‹œí•´ì£¼ì„¸ìš”.',format:'í‘œ',tone:'ì „ë¬¸ì '},
  {icon:'ğŸ“',name:'í•™ìŠµ ê°€ì´ë“œ',role:'êµìœ¡ ì „ë¬¸ê°€',context:'íš¨ê³¼ì ì¸ í•™ìŠµ ê°€ì´ë“œë¥¼ ì œì‘í•©ë‹ˆë‹¤.',task:'ì£¼ì–´ì§„ ì£¼ì œì— ëŒ€í•´ ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ë‹¨ê³„ë³„ í•™ìŠµ ê°€ì´ë“œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.',format:'ë‹¨ê³„ë³„',tone:'êµìœ¡ì '},
  {icon:'âœ‰ï¸',name:'ì´ë©”ì¼ ì‘ì„±',role:'ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì „ë¬¸ê°€',context:'ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë©”ì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.',task:'ì£¼ì–´ì§„ ìƒí™©ì— ë§ëŠ” ì „ë¬¸ì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë©”ì¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.',format:'ë§ˆí¬ë‹¤ìš´',tone:'ê²©ì‹ì²´'},
  {icon:'ğŸ§ª',name:'API ë¬¸ì„œ',role:'í…Œí¬ë‹ˆì»¬ ë¼ì´í„°',context:'REST API ë¬¸ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.',task:'API ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ëª…ì„¸ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œ í¬í•¨.',format:'ë§ˆí¬ë‹¤ìš´',tone:'ì „ë¬¸ì '},
  {icon:'ğŸ¯',name:'ë§ˆì¼€íŒ… ì¹´í”¼',role:'ì¹´í”¼ë¼ì´í„°',context:'ì œí’ˆ/ì„œë¹„ìŠ¤ ë§ˆì¼€íŒ… ì¹´í”¼ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.',task:'íƒ€ê²Ÿ ê³ ê°ì˜ ê´€ì‹¬ì„ ëŒ ìˆ˜ ìˆëŠ” ë§¤ë ¥ì ì¸ ë§ˆì¼€íŒ… ì¹´í”¼ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.',format:'ëª©ë¡',tone:'ì„¤ë“ì '},
  {icon:'ğŸ”',name:'ë²ˆì—­ + êµì •',role:'ì „ë¬¸ ë²ˆì—­ê°€ ê²¸ ì—ë””í„°',context:'ë¬¸ì„œ ë²ˆì—­ ë° êµì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.',task:'ìì—°ìŠ¤ëŸ½ê³  ì •í™•í•œ ë²ˆì—­ì„ ì œê³µí•˜ê³ , ë¬¸ë§¥ì— ë§ê²Œ êµì •í•´ì£¼ì„¸ìš”.',format:'ë§ˆí¬ë‹¤ìš´',tone:'ì „ë¬¸ì '},
];

function init(){
  initTheme();
  renderChips('formatChips',formats,selectedFormats);
  renderChips('toneChips',tones,selectedTones);
  renderChips('sdQualityChips',sdQualities,sdQualityTags);
  renderChips('sdStyleChips',sdStyles,sdStyleTags);
  renderPresets();
  setupTabs();
}

function renderChips(containerId,items,selectedArr){
  const el=document.getElementById(containerId);
  el.innerHTML=items.map(item=>`<button class="chip ${selectedArr.includes(item)?'active':''}" onclick="toggleChip('${containerId}','${item}')">${item}</button>`).join('');
}

function toggleChip(containerId,item){
  let arr;
  if(containerId==='formatChips')arr=selectedFormats;
  else if(containerId==='toneChips')arr=selectedTones;
  else if(containerId==='sdQualityChips')arr=sdQualityTags;
  else arr=sdStyleTags;
  const idx=arr.indexOf(item);
  if(idx>=0)arr.splice(idx,1);else arr.push(item);
  renderChips(containerId,containerId==='formatChips'?formats:containerId==='toneChips'?tones:containerId==='sdQualityChips'?sdQualities:sdStyles,arr);
}

function renderPresets(){
  document.getElementById('presetGrid').innerHTML=presets.map((p,i)=>`
    <div class="preset-card" onclick="applyPreset(${i})">
      <div class="preset-icon">${p.icon}</div>
      <div class="preset-name">${p.name}</div>
    </div>
  `).join('');
}

function applyPreset(i){
  const p=presets[i];
  document.getElementById('role').value=p.role;
  document.getElementById('context').value=p.context;
  document.getElementById('task').value=p.task;
  selectedFormats=p.format?[p.format]:[];
  selectedTones=p.tone?[p.tone]:[];
  renderChips('formatChips',formats,selectedFormats);
  renderChips('toneChips',tones,selectedTones);
  generate();
  showToast('âœ… í”„ë¦¬ì…‹ ì ìš©ë¨');
}

function setupTabs(){
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      currentMode=tab.dataset.mode;
      document.getElementById('textForm').style.display=currentMode==='text'?'':'none';
      document.getElementById('mjForm').style.display=currentMode==='midjourney'?'':'none';
      document.getElementById('sdForm').style.display=currentMode==='stablediff'?'':'none';
      generate();
    });
  });
}

function generate(){
  let prompt='';
  if(currentMode==='text'){
    prompt=generateTextPrompt();
  }else if(currentMode==='midjourney'){
    prompt=generateMjPrompt();
  }else{
    prompt=generateSdPrompt();
  }
  document.getElementById('output').textContent=prompt||'í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
  return prompt;
}

function generateTextPrompt(){
  const role=document.getElementById('role').value.trim();
  const context=document.getElementById('context').value.trim();
  const task=document.getElementById('task').value.trim();
  const lang=document.getElementById('lang').value;
  if(!role&&!context&&!task)return '';
  let parts=[];
  if(role)parts.push(`ë‹¹ì‹ ì€ ${role}ì…ë‹ˆë‹¤.`);
  if(context)parts.push(`\n## ì»¨í…ìŠ¤íŠ¸\n${context}`);
  if(task)parts.push(`\n## íƒœìŠ¤í¬\n${task}`);
  if(selectedFormats.length)parts.push(`\n## ì¶œë ¥ í¬ë§·\n${selectedFormats.join(', ')} í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”.`);
  if(selectedTones.length)parts.push(`\n## í†¤\n${selectedTones.join(', ')} í†¤ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.`);
  if(lang)parts.push(`\n## ì–¸ì–´\n${lang}ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”.`);
  return parts.join('\n');
}

function generateMjPrompt(){
  const prompt=document.getElementById('mjPrompt').value.trim();
  if(!prompt)return '';
  let parts=[prompt];
  const style=document.getElementById('mjStyle').value;
  if(style)parts[0]+=`, ${style}`;
  let params=[];
  const ar=document.getElementById('mjAr').value;if(ar)params.push(`--ar ${ar}`);
  const v=document.getElementById('mjVersion').value;if(v)params.push(v.startsWith('niji')?`--${v}`:`--v ${v}`);
  const s=document.getElementById('mjStylize').value;if(s)params.push(`--s ${s}`);
  const c=document.getElementById('mjChaos').value;if(c)params.push(`--chaos ${c}`);
  const q=document.getElementById('mjQuality').value;if(q&&q!=='1')params.push(`--q ${q}`);
  const no=document.getElementById('mjNo').value.trim();if(no)params.push(`--no ${no}`);
  return `/imagine prompt: ${parts[0]} ${params.join(' ')}`.trim();
}

function generateSdPrompt(){
  const prompt=document.getElementById('sdPrompt').value.trim();
  if(!prompt&&!sdQualityTags.length&&!sdStyleTags.length)return '';
  let positive=[...sdQualityTags,...sdStyleTags];
  if(prompt)positive.push(prompt);
  const neg=document.getElementById('sdNeg').value.trim();
  let result=`Positive:\n${positive.join(', ')}`;
  if(neg)result+=`\n\nNegative:\n${neg}`;
  return result;
}

function copyPrompt(){
  const text=document.getElementById('output').textContent;
  if(!text||text==='í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...')return showToast('âš ï¸ í”„ë¡¬í”„íŠ¸ë¥¼ ë¨¼ì € ìƒì„±í•˜ì„¸ìš”');
  navigator.clipboard.writeText(text).then(()=>showToast('âœ… ë³µì‚¬ë¨!')).catch(()=>{
    const ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();showToast('âœ… ë³µì‚¬ë¨!');
  });
}

function saveToHistory(){
  const text=document.getElementById('output').textContent;
  if(!text||text==='í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...')return showToast('âš ï¸ í”„ë¡¬í”„íŠ¸ë¥¼ ë¨¼ì € ìƒì„±í•˜ì„¸ìš”');
  const history=JSON.parse(localStorage.getItem(LS_HIST)||'[]');
  history.unshift({text,mode:currentMode,date:new Date().toISOString()});
  if(history.length>50)history.length=50;
  localStorage.setItem(LS_HIST,JSON.stringify(history));
  showToast('ğŸ’¾ íˆìŠ¤í† ë¦¬ì— ì €ì¥ë¨');
  renderHistory();
}

function toggleHistory(){
  const panel=document.getElementById('historyPanel');
  panel.style.display=panel.style.display==='none'?'':'none';
  if(panel.style.display!=='none')renderHistory();
}

function renderHistory(){
  const history=JSON.parse(localStorage.getItem(LS_HIST)||'[]');
  const el=document.getElementById('historyList');
  if(!history.length){el.innerHTML='<div style="padding:20px;text-align:center;color:var(--text3);font-size:.85rem">íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';return}
  el.innerHTML=history.map((h,i)=>`
    <div class="history-item" onclick="loadHistory(${i})">
      <div>
        <div style="font-size:.7rem;color:var(--primary);font-weight:600;margin-bottom:2px">${h.mode==='text'?'ğŸ’¬ Text':h.mode==='midjourney'?'ğŸ¨ MJ':'ğŸ–¼ï¸ SD'}</div>
        <div class="history-text">${esc(h.text)}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <div class="history-meta">${new Date(h.date).toLocaleDateString('ko')}</div>
        <button class="history-del" onclick="event.stopPropagation();deleteHistory(${i})">âœ•</button>
      </div>
    </div>
  `).join('');
}

function loadHistory(i){
  const history=JSON.parse(localStorage.getItem(LS_HIST)||'[]');
  if(history[i]){
    document.getElementById('output').textContent=history[i].text;
    showToast('ğŸ“œ íˆìŠ¤í† ë¦¬ ë¡œë“œë¨');
  }
}

function deleteHistory(i){
  const history=JSON.parse(localStorage.getItem(LS_HIST)||'[]');
  history.splice(i,1);
  localStorage.setItem(LS_HIST,JSON.stringify(history));
  renderHistory();
}

function clearHistory(){
  if(!confirm('ëª¨ë“  íˆìŠ¤í† ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  localStorage.removeItem(LS_HIST);
  renderHistory();
}

function clearForm(){
  if(currentMode==='text'){
    ['role','context','task'].forEach(id=>document.getElementById(id).value='');
    selectedFormats=[];selectedTones=[];
    renderChips('formatChips',formats,selectedFormats);
    renderChips('toneChips',tones,selectedTones);
  }else if(currentMode==='midjourney'){
    ['mjPrompt','mjNo','mjStylize','mjChaos'].forEach(id=>document.getElementById(id).value='');
    ['mjStyle','mjAr'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('mjVersion').value='6.1';
    document.getElementById('mjQuality').value='1';
  }else{
    ['sdPrompt','sdNeg'].forEach(id=>document.getElementById(id).value='');
    sdQualityTags=[];sdStyleTags=[];
    renderChips('sdQualityChips',sdQualities,sdQualityTags);
    renderChips('sdStyleChips',sdStyles,sdStyleTags);
  }
  document.getElementById('output').textContent='í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
}

function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2000);
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}

function toggleTheme(){
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  document.documentElement.setAttribute('data-theme',isDark?'light':'dark');
  document.getElementById('themeToggle').textContent=isDark?'ğŸŒ™':'â˜€ï¸';
  localStorage.setItem(LS_THEME,isDark?'light':'dark');
}

function initTheme(){
  const t=localStorage.getItem(LS_THEME)||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');
  document.documentElement.setAttribute('data-theme',t);
  document.getElementById('themeToggle').textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™';
}

init();
</script>
</body>
</html>