<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ðŸŽµ BPM Tap Detector | Music Tempo Analyzer</title>
    <meta name="description" content="Tap to detect BPM in real-time. Find the tempo of any music by tapping along with the beat.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            color: white;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .tap-area {
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 0 auto 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .tap-area:hover {
            transform: scale(1.02);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .tap-area:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.2);
        }

        .tap-area.pulse {
            animation: pulse 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
                background: rgba(255, 255, 255, 0.25);
            }
        }

        .bpm-display {
            font-size: 5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.4);
        }

        .bpm-label {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .tempo-category {
            font-size: 1.2rem;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .tap-instruction {
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .chart-container {
            width: 100%;
            max-width: 500px;
            height: 150px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: inherit;
        }

        .btn-reset {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-reset:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn-metronome {
            background: rgba(255, 200, 100, 0.9);
            color: #333;
        }

        .btn-metronome:hover {
            background: rgba(255, 200, 100, 1);
            transform: translateY(-2px);
        }

        .btn-metronome.active {
            background: #4CAF50;
            color: white;
        }

        .info-text {
            margin-top: 20px;
            font-size: 0.95rem;
            opacity: 0.8;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }

            .tap-area {
                height: 350px;
            }

            .bpm-display {
                font-size: 4rem;
            }

            .bpm-label {
                font-size: 1.2rem;
            }

            .chart-container {
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ BPM Tap Detector</h1>
        <p class="subtitle">Tap along with the music to detect BPM</p>

        <div class="tap-area" id="tapArea">
            <div class="bpm-display" id="bpmDisplay">---</div>
            <div class="bpm-label">BPM</div>
            <div class="tempo-category" id="tempoCategory">Tap to start</div>
            <div class="tap-instruction">ðŸ‘† Tap here or press Space</div>
        </div>

        <div class="chart-container">
            <canvas id="bpmChart"></canvas>
        </div>

        <div class="controls">
            <button class="btn btn-reset" id="resetBtn">ðŸ”„ Reset</button>
            <button class="btn btn-metronome" id="metronomeBtn">ðŸŽ¼ Metronome Off</button>
        </div>

        <p class="info-text">
            ðŸ’¡ Tip: Tap at least 4 times for accurate BPM detection
        </p>
    </div>

    <script>
        const tapArea = document.getElementById('tapArea');
        const bpmDisplay = document.getElementById('bpmDisplay');
        const tempoCategory = document.getElementById('tempoCategory');
        const resetBtn = document.getElementById('resetBtn');
        const metronomeBtn = document.getElementById('metronomeBtn');
        const canvas = document.getElementById('bpmChart');
        const ctx = canvas.getContext('2d');

        let taps = [];
        let bpmHistory = [];
        let currentBPM = 0;
        let metronomeActive = false;
        let metronomeInterval = null;
        let audioContext = null;

        // Tempo categories
        const tempoCategories = [
            { min: 0, max: 40, name: 'Larghissimo' },
            { min: 40, max: 60, name: 'Largo' },
            { min: 60, max: 66, name: 'Adagio' },
            { min: 66, max: 76, name: 'Andante' },
            { min: 76, max: 108, name: 'Moderato' },
            { min: 108, max: 120, name: 'Allegro' },
            { min: 120, max: 156, name: 'Vivace' },
            { min: 156, max: 176, name: 'Presto' },
            { min: 176, max: 300, name: 'Prestissimo' }
        ];

        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Play metronome click
        function playClick() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 1000;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Handle tap
        function handleTap() {
            const now = Date.now();
            taps.push(now);

            // Keep only last 10 taps
            if (taps.length > 10) {
                taps.shift();
            }

            // Calculate BPM
            if (taps.length >= 2) {
                const intervals = [];
                for (let i = 1; i < taps.length; i++) {
                    intervals.push(taps[i] - taps[i - 1]);
                }

                const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                currentBPM = Math.round(60000 / avgInterval);

                // Clamp BPM to reasonable range
                if (currentBPM > 0 && currentBPM < 300) {
                    bpmDisplay.textContent = currentBPM;
                    bpmHistory.push(currentBPM);

                    if (bpmHistory.length > 20) {
                        bpmHistory.shift();
                    }

                    updateTempoCategory(currentBPM);
                    drawChart();

                    // Update metronome if active
                    if (metronomeActive) {
                        startMetronome();
                    }
                }
            }

            // Visual feedback
            tapArea.classList.remove('pulse');
            void tapArea.offsetWidth; // Force reflow
            tapArea.classList.add('pulse');

            // Play click sound
            initAudio();
            playClick();
        }

        // Update tempo category
        function updateTempoCategory(bpm) {
            const category = tempoCategories.find(cat => bpm >= cat.min && bpm < cat.max);
            if (category) {
                tempoCategory.textContent = category.name;
            }
        }

        // Draw BPM history chart
        function drawChart() {
            canvas.width = canvas.offsetWidth * 2;
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);

            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            if (bpmHistory.length < 2) return;

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = (height / 4) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Draw line
            const maxBPM = Math.max(...bpmHistory, currentBPM + 20);
            const minBPM = Math.max(0, Math.min(...bpmHistory) - 20);
            const range = maxBPM - minBPM;

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 3;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';

            ctx.beginPath();
            bpmHistory.forEach((bpm, i) => {
                const x = (width / (bpmHistory.length - 1)) * i;
                const y = height - ((bpm - minBPM) / range) * height;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Draw points
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            bpmHistory.forEach((bpm, i) => {
                const x = (width / (bpmHistory.length - 1)) * i;
                const y = height - ((bpm - minBPM) / range) * height;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Reset
        function reset() {
            taps = [];
            bpmHistory = [];
            currentBPM = 0;
            bpmDisplay.textContent = '---';
            tempoCategory.textContent = 'Tap to start';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stopMetronome();
        }

        // Metronome
        function startMetronome() {
            if (!currentBPM || currentBPM < 30 || currentBPM > 300) return;

            stopMetronome();
            initAudio();

            const interval = 60000 / currentBPM;
            metronomeInterval = setInterval(() => {
                playClick();
            }, interval);
        }

        function stopMetronome() {
            if (metronomeInterval) {
                clearInterval(metronomeInterval);
                metronomeInterval = null;
            }
        }

        function toggleMetronome() {
            metronomeActive = !metronomeActive;

            if (metronomeActive) {
                metronomeBtn.textContent = 'ðŸŽ¼ Metronome On';
                metronomeBtn.classList.add('active');
                if (currentBPM) {
                    startMetronome();
                }
            } else {
                metronomeBtn.textContent = 'ðŸŽ¼ Metronome Off';
                metronomeBtn.classList.remove('active');
                stopMetronome();
            }
        }

        // Event listeners
        tapArea.addEventListener('click', handleTap);
        tapArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleTap();
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                handleTap();
            }
        });

        resetBtn.addEventListener('click', reset);
        metronomeBtn.addEventListener('click', toggleMetronome);

        // Initial draw
        drawChart();
    </script>
</body>
</html>
