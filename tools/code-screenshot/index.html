<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code Screenshot - ì½”ë“œ ìŠ¤í¬ë¦°ìƒ· ìƒì„±ê¸°</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f0f2f5;--bg2:#fff;--text:#212529;--text2:#6c757d;--accent:#667eea;--accent2:#764ba2;--border:#dee2e6;--shadow:rgba(0,0,0,.08)}
[data-theme="dark"]{--bg:#0f0f0f;--bg2:#1a1a2e;--text:#e8e8e8;--text2:#adb5bd;--accent:#7c8cf8;--accent2:#9b6dff;--border:#2d2d44;--shadow:rgba(0,0,0,.3)}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:all .3s}
.container{max-width:1100px;margin:0 auto;padding:20px}
header{text-align:center;padding:30px 0 20px}
h1{font-size:2rem;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
.subtitle{color:var(--text2);font-size:.95rem}
.theme-btn{position:fixed;top:16px;right:16px;width:44px;height:44px;border-radius:50%;border:2px solid var(--border);background:var(--bg2);cursor:pointer;font-size:1.3rem;display:flex;align-items:center;justify-content:center;z-index:99}
.layout{display:grid;grid-template-columns:300px 1fr;gap:20px;margin-top:20px}
.sidebar{display:flex;flex-direction:column;gap:14px}
.panel{background:var(--bg2);border-radius:14px;padding:18px;box-shadow:0 4px 15px var(--shadow)}
.panel h3{font-size:.9rem;color:var(--accent);margin-bottom:12px}
.form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
.form-row label{font-size:.8rem;color:var(--text2);font-weight:500}
.form-row select,.form-row input{padding:8px 10px;border:1.5px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:.85rem}
.color-row{display:flex;gap:8px;align-items:center}
.color-row input[type="color"]{width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0}
.preset-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.preset{width:100%;aspect-ratio:1;border-radius:8px;border:2px solid transparent;cursor:pointer;transition:all .2s}
.preset:hover,.preset.active{border-color:var(--accent);transform:scale(1.1)}
.preview-area{display:flex;align-items:flex-start;justify-content:center;min-height:400px}
.canvas-wrap{display:inline-block}
#codeCanvas{border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.btn-row{display:flex;gap:8px;margin-top:12px;justify-content:center;flex-wrap:wrap}
.btn{padding:10px 20px;border:none;border-radius:10px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(102,126,234,.4)}
.btn-secondary{background:var(--bg2);color:var(--text);border:1.5px solid var(--border)}
textarea{width:100%;height:200px;font-family:'Fira Code','SF Mono','Cascadia Code',Consolas,monospace;font-size:.85rem;padding:14px;border:1.5px solid var(--border);border-radius:10px;background:var(--bg);color:var(--text);resize:vertical;line-height:1.6;tab-size:2}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.toggle{width:40px;height:22px;background:var(--border);border-radius:11px;position:relative;cursor:pointer;transition:background .2s}
.toggle.on{background:var(--accent)}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;top:2px;left:2px;transition:left .2s}
.toggle.on::after{left:20px}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:#333;color:#fff;padding:12px 24px;border-radius:10px;font-size:.9rem;transition:transform .3s;z-index:999}
.toast.show{transform:translateX(-50%) translateY(0)}
@media(max-width:768px){.layout{grid-template-columns:1fr}textarea{height:150px}}
</style>
</head>
<body>
<button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
<div class="container">
<header>
<h1>ğŸ“¸ Code Screenshot</h1>
<p class="subtitle">ì½”ë“œë¥¼ ì•„ë¦„ë‹¤ìš´ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì„¸ìš”</p>
</header>

<div class="layout">
<div class="sidebar">
<div class="panel">
<h3>ğŸ“ ì½”ë“œ ì…ë ¥</h3>
<textarea id="codeInput" placeholder="ì—¬ê¸°ì— ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..." spellcheck="false">function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

// ì²˜ìŒ 10ê°œ í”¼ë³´ë‚˜ì¹˜ ìˆ˜
const result = Array.from(
  { length: 10 },
  (_, i) => fibonacci(i)
);
console.log(result);</textarea>
</div>
<div class="panel">
<h3>ğŸ¨ ë°°ê²½ í…Œë§ˆ</h3>
<div class="preset-grid" id="presetGrid"></div>
<div class="form-row" style="margin-top:12px">
<label>ì»¤ìŠ¤í…€ ë°°ê²½</label>
<div class="color-row">
<input type="color" id="bgColor1" value="#667eea">
<input type="color" id="bgColor2" value="#764ba2">
<span style="font-size:.8rem;color:var(--text2)">ê·¸ë¼ë””ì–¸íŠ¸</span>
</div>
</div>
</div>
<div class="panel">
<h3>âš™ï¸ ì„¤ì •</h3>
<div class="form-row">
<label>ì–¸ì–´/íŒŒì¼ëª…</label>
<input type="text" id="fileName" value="fibonacci.js" placeholder="main.py">
</div>
<div class="form-row">
<label>í°íŠ¸ í¬ê¸°</label>
<select id="fontSize">
<option value="12">12px</option>
<option value="14" selected>14px</option>
<option value="16">16px</option>
<option value="18">18px</option>
<option value="20">20px</option>
</select>
</div>
<div class="form-row">
<label>ì½”ë“œ í…Œë§ˆ</label>
<select id="codeTheme">
<option value="monokai">Monokai</option>
<option value="dracula">Dracula</option>
<option value="nord">Nord</option>
<option value="github-dark">GitHub Dark</option>
<option value="solarized">Solarized Dark</option>
</select>
</div>
<div class="form-row">
<label>íŒ¨ë”©</label>
<select id="padding">
<option value="32">ì‘ê²Œ</option>
<option value="48" selected>ë³´í†µ</option>
<option value="64">í¬ê²Œ</option>
<option value="80">ì•„ì£¼ í¬ê²Œ</option>
</select>
</div>
<div class="toggle-row">
<label style="font-size:.85rem">ë¼ì¸ ë²ˆí˜¸</label>
<div class="toggle on" id="toggleLines" onclick="this.classList.toggle('on');render()"></div>
</div>
<div class="toggle-row">
<label style="font-size:.85rem">ìœˆë„ìš° ë²„íŠ¼</label>
<div class="toggle on" id="toggleDots" onclick="this.classList.toggle('on');render()"></div>
</div>
<div class="toggle-row">
<label style="font-size:.85rem">ê·¸ë¦¼ì</label>
<div class="toggle on" id="toggleShadow" onclick="this.classList.toggle('on');render()"></div>
</div>
</div>
</div>

<div>
<div class="preview-area">
<div class="canvas-wrap">
<canvas id="codeCanvas"></canvas>
</div>
</div>
<div class="btn-row">
<button class="btn btn-primary" onclick="downloadPNG()">ğŸ“¥ PNG ë‹¤ìš´ë¡œë“œ</button>
<button class="btn btn-secondary" onclick="copyToClipboard()">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
</div>
</div>
</div>
</div>
<div class="toast" id="toast"></div>

<script>
const PRESETS=[
{name:'Hyper',c1:'#fc466b',c2:'#3f5efb'},{name:'Sunset',c1:'#f093fb',c2:'#f5576c'},
{name:'Ocean',c1:'#667eea',c2:'#764ba2'},{name:'Forest',c1:'#11998e',c2:'#38ef7d'},
{name:'Night',c1:'#0f0c29',c2:'#302b63'},{name:'Peach',c1:'#ffecd2',c2:'#fcb69f'},
{name:'Cool',c1:'#a8c0ff',c2:'#3f2b96'},{name:'Ember',c1:'#ff512f',c2:'#f09819'},
{name:'Aurora',c1:'#00c6ff',c2:'#0072ff'},{name:'Rose',c1:'#eecda3',c2:'#ef629f'},
{name:'Mint',c1:'#d4fc79',c2:'#96e6a1'},{name:'Steel',c1:'#2c3e50',c2:'#3498db'}
];

const THEMES={
  monokai:{bg:'#272822',text:'#f8f8f2',keyword:'#f92672',string:'#e6db74',comment:'#75715e',number:'#ae81ff',func:'#a6e22e',type:'#66d9ef'},
  dracula:{bg:'#282a36',text:'#f8f8f2',keyword:'#ff79c6',string:'#f1fa8c',comment:'#6272a4',number:'#bd93f9',func:'#50fa7b',type:'#8be9fd'},
  nord:{bg:'#2e3440',text:'#d8dee9',keyword:'#81a1c1',string:'#a3be8c',comment:'#616e88',number:'#b48ead',func:'#88c0d0',type:'#8fbcbb'},
  'github-dark':{bg:'#0d1117',text:'#c9d1d9',keyword:'#ff7b72',string:'#a5d6ff',comment:'#8b949e',number:'#79c0ff',func:'#d2a8ff',type:'#7ee787'},
  solarized:{bg:'#002b36',text:'#839496',keyword:'#859900',string:'#2aa198',comment:'#586e75',number:'#d33682',func:'#268bd2',type:'#b58900'}
};

let activePreset=2;

function initPresets(){
  const g=document.getElementById('presetGrid');
  g.innerHTML=PRESETS.map((p,i)=>`<div class="preset${i===activePreset?' active':''}" style="background:linear-gradient(135deg,${p.c1},${p.c2})" onclick="selectPreset(${i})" title="${p.name}"></div>`).join('');
}

function selectPreset(i){
  activePreset=i;
  document.getElementById('bgColor1').value=PRESETS[i].c1;
  document.getElementById('bgColor2').value=PRESETS[i].c2;
  document.querySelectorAll('.preset').forEach((p,j)=>p.classList.toggle('active',j===i));
  render();
}

function tokenize(code){
  const tokens=[];
  const patterns=[
    {type:'comment',re:/\/\/.*|\/\*[\s\S]*?\*\/|#.*/g},
    {type:'string',re:/(["'`])(?:(?!\1|\\).|\\.)*\1/g},
    {type:'keyword',re:/\b(function|const|let|var|return|if|else|for|while|do|switch|case|break|continue|class|import|export|from|default|new|this|typeof|instanceof|async|await|try|catch|finally|throw|yield|of|in|def|print|self|True|False|None|lambda)\b/g},
    {type:'number',re:/\b\d+\.?\d*\b/g},
    {type:'func',re:/\b([a-zA-Z_]\w*)\s*(?=\()/g},
    {type:'type',re:/\b(Array|String|Number|Boolean|Object|Promise|Map|Set|console|Math|document|window)\b/g}
  ];
  let remaining=code;
  const chars=Array(code.length).fill('text');
  for(const p of patterns){
    let m;p.re.lastIndex=0;
    while((m=p.re.exec(code))!==null){
      let allText=true;
      for(let i=m.index;i<m.index+m[0].length;i++){if(chars[i]!=='text'){allText=false;break}}
      if(allText)for(let i=m.index;i<m.index+m[0].length;i++)chars[i]=p.type;
    }
  }
  let cur={type:chars[0],text:code[0]};
  for(let i=1;i<code.length;i++){
    if(chars[i]===cur.type)cur.text+=code[i];
    else{tokens.push(cur);cur={type:chars[i],text:code[i]}}
  }
  if(cur.text)tokens.push(cur);
  return tokens;
}

function render(){
  const canvas=document.getElementById('codeCanvas');
  const ctx=canvas.getContext('2d');
  const code=document.getElementById('codeInput').value||'// ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”';
  const fontSize=parseInt(document.getElementById('fontSize').value);
  const themeName=document.getElementById('codeTheme').value;
  const theme=THEMES[themeName];
  const pad=parseInt(document.getElementById('padding').value);
  const showLines=document.getElementById('toggleLines').classList.contains('on');
  const showDots=document.getElementById('toggleDots').classList.contains('on');
  const showShadow=document.getElementById('toggleShadow').classList.contains('on');
  const c1=document.getElementById('bgColor1').value;
  const c2=document.getElementById('bgColor2').value;
  const fileName=document.getElementById('fileName').value;

  const font=`${fontSize}px 'Fira Code','SF Mono','Cascadia Code',Consolas,monospace`;
  ctx.font=font;
  const lineHeight=fontSize*1.65;
  const lines=code.split('\n');
  const lineNumW=showLines?(String(lines.length).length*fontSize*0.65+20):0;

  let maxLineW=0;
  for(const l of lines){const w=ctx.measureText(l).width;if(w>maxLineW)maxLineW=w}

  const headerH=showDots?40:10;
  const codeW=lineNumW+maxLineW+40;
  const codeH=lines.length*lineHeight+20;
  const cardW=codeW+32;
  const cardH=codeH+headerH+16;
  const totalW=cardW+pad*2;
  const totalH=cardH+pad*2;

  const dpr=Math.min(window.devicePixelRatio||1,2);
  canvas.width=totalW*dpr;canvas.height=totalH*dpr;
  canvas.style.width=Math.min(totalW,800)+'px';
  canvas.style.height=Math.min(totalW,800)/totalW*totalH+'px';
  ctx.scale(dpr,dpr);

  // Background gradient
  const grad=ctx.createLinearGradient(0,0,totalW,totalH);
  grad.addColorStop(0,c1);grad.addColorStop(1,c2);
  ctx.fillStyle=grad;
  ctx.fillRect(0,0,totalW,totalH);

  // Card shadow
  if(showShadow){
    ctx.shadowColor='rgba(0,0,0,0.4)';ctx.shadowBlur=40;ctx.shadowOffsetY=15;
  }

  // Card
  const cx=pad,cy=pad;
  ctx.fillStyle=theme.bg;
  roundRect(ctx,cx,cy,cardW,cardH,12);
  ctx.fill();
  ctx.shadowColor='transparent';ctx.shadowBlur=0;ctx.shadowOffsetY=0;

  // Header
  if(showDots){
    const dotY=cy+20;
    const colors=['#ff5f56','#ffbd2e','#27c93f'];
    colors.forEach((c,i)=>{ctx.fillStyle=c;ctx.beginPath();ctx.arc(cx+20+i*22,dotY,7,0,Math.PI*2);ctx.fill()});
    if(fileName){
      ctx.fillStyle=theme.comment;ctx.font=`${fontSize-2}px -apple-system,sans-serif`;
      ctx.textAlign='center';ctx.fillText(fileName,cx+cardW/2,dotY+4);ctx.textAlign='left';
    }
  }

  // Code
  ctx.font=font;
  const startX=cx+16+lineNumW;
  const startY=cy+headerH+fontSize+6;
  lines.forEach((line,i)=>{
    const y=startY+i*lineHeight;
    if(showLines){
      ctx.fillStyle=theme.comment;ctx.textAlign='right';
      ctx.fillText(String(i+1),cx+lineNumW,y);ctx.textAlign='left';
    }
    const tokens=tokenize(line);
    let x=startX;
    for(const t of tokens){
      ctx.fillStyle=theme[t.type]||theme.text;
      ctx.fillText(t.text,x,y);
      x+=ctx.measureText(t.text).width;
    }
  });
}

function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();
}

function downloadPNG(){
  const c=document.getElementById('codeCanvas');
  const a=document.createElement('a');a.download='code-screenshot.png';a.href=c.toDataURL('image/png');a.click();
  toast('PNG ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
}

function copyToClipboard(){
  const c=document.getElementById('codeCanvas');
  c.toBlob(blob=>{
    navigator.clipboard.write([new ClipboardItem({'image/png':blob})]).then(()=>toast('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')).catch(()=>toast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'));
  });
}

function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function toggleTheme(){const d=document.documentElement;const c=d.getAttribute('data-theme')==='dark'?'light':'dark';d.setAttribute('data-theme',c);localStorage.setItem('theme',c)}
document.documentElement.setAttribute('data-theme',localStorage.getItem('theme')||'light');

initPresets();
document.getElementById('codeInput').addEventListener('input',render);
['fontSize','codeTheme','padding','fileName','bgColor1','bgColor2'].forEach(id=>document.getElementById(id).addEventListener('input',()=>{activePreset=-1;document.querySelectorAll('.preset').forEach(p=>p.classList.remove('active'));render()}));
render();
</script>
</body>
</html>