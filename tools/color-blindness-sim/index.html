<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒ‰ë§¹ ì‹œë®¬ë ˆì´í„° | ì›¹ ë„êµ¬ ëª¨ìŒ</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --card-bg: #ffffff;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #121212;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --border: #444;
            --shadow: rgba(0, 0, 0, 0.3);
            --card-bg: #2d2d2d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container { max-width: 900px; margin: 0 auto; }
        
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            transition: color 0.2s;
        }
        .back-btn:hover { color: var(--text-primary); }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            background: var(--accent);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-secondary);
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: var(--bg-primary);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        input[type="file"] {
            display: none;
        }

        .filter-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #667eea;
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: transparent;
        }

        .canvas-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 20px var(--shadow);
        }

        .info-box {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.8;
        }

        .info-box h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        @media (max-width: 600px) {
            .filter-buttons { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="../" class="back-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
        </header>

        <div class="card">
            <h1>ğŸ‘ï¸ ìƒ‰ë§¹ ì‹œë®¬ë ˆì´í„°</h1>
            
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ğŸ“¸</div>
                <div><strong>ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</strong></div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                    í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸ ì•¤ ë“œë¡­
                </div>
            </div>
            <input type="file" id="fileInput" accept="image/*" onchange="handleImageUpload(event)">

            <div class="filter-buttons">
                <button class="filter-btn active" onclick="applyFilter('normal')">ğŸŸ¢ ì •ìƒ</button>
                <button class="filter-btn" onclick="applyFilter('protanopia')">ğŸ”´ ì ìƒ‰ë§¹</button>
                <button class="filter-btn" onclick="applyFilter('deuteranopia')">ğŸŸ¢ ë…¹ìƒ‰ë§¹</button>
                <button class="filter-btn" onclick="applyFilter('tritanopia')">ğŸ”µ ì²­ìƒ‰ë§¹</button>
                <button class="filter-btn" onclick="applyFilter('achromatopsia')">âš« ì „ìƒ‰ë§¹</button>
            </div>

            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="info-box">
                <h3>ğŸ“– ìƒ‰ë§¹ ìœ í˜• ì„¤ëª…</h3>
                <p><strong>ì ìƒ‰ë§¹ (Protanopia):</strong> ë¹¨ê°„ìƒ‰ì„ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ìƒ‰ê° ì´ìƒ</p>
                <p><strong>ë…¹ìƒ‰ë§¹ (Deuteranopia):</strong> ì´ˆë¡ìƒ‰ì„ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ìƒ‰ê° ì´ìƒ</p>
                <p><strong>ì²­ìƒ‰ë§¹ (Tritanopia):</strong> íŒŒë€ìƒ‰ì„ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ìƒ‰ê° ì´ìƒ (ë“œë¬¾)</p>
                <p><strong>ì „ìƒ‰ë§¹ (Achromatopsia):</strong> ëª¨ë“  ìƒ‰ì„ ì¸ì‹í•˜ì§€ ëª»í•˜ê³  í‘ë°±ìœ¼ë¡œë§Œ ë³´ì„</p>
            </div>
        </div>
    </div>

    <script>
        let originalImageData = null;
        let currentFilter = 'normal';
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) loadImage(file);
        }

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    applyFilter(currentFilter);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function applyFilter(filter) {
            if (!originalImageData) return;
            
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const imageData = new ImageData(
                new Uint8ClampedArray(originalImageData.data),
                originalImageData.width,
                originalImageData.height
            );

            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                if (filter === 'protanopia') {
                    // Red-blind
                    data[i] = 0.56667 * r + 0.43333 * g;
                    data[i + 1] = 0.55833 * r + 0.44167 * g;
                    data[i + 2] = 0.24167 * g + 0.75833 * b;
                } else if (filter === 'deuteranopia') {
                    // Green-blind
                    data[i] = 0.625 * r + 0.375 * g;
                    data[i + 1] = 0.7 * r + 0.3 * g;
                    data[i + 2] = 0.3 * g + 0.7 * b;
                } else if (filter === 'tritanopia') {
                    // Blue-blind
                    data[i] = 0.95 * r + 0.05 * g;
                    data[i + 1] = 0.433 * g + 0.567 * b;
                    data[i + 2] = 0.475 * g + 0.525 * b;
                } else if (filter === 'achromatopsia') {
                    // Total color blindness (grayscale)
                    const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                    data[i] = gray;
                    data[i + 1] = gray;
                    data[i + 2] = gray;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</body>
</html>
