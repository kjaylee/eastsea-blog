<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë”ì¹˜í˜ì´ ê³„ì‚°ê¸° - Expense Splitter | EastSea Tools</title>
<meta name="description" content="ëª¨ì„ ë¹„ìš©ì„ ê°„í¸í•˜ê²Œ ì •ì‚°í•˜ì„¸ìš”. ë©¤ë²„ë³„ ì§€ì¶œ ì…ë ¥, ìë™ ì •ì‚° ê³„ì‚°, ìµœì†Œ ì†¡ê¸ˆ ìµœì í™”.">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f0f2f5;--card:#fff;--text:#1a1a2e;--text2:#666;--primary:#6c5ce7;--primary2:#a29bfe;--success:#00b894;--danger:#e17055;--warning:#fdcb6e;--border:#e0e0e0;--shadow:0 4px 20px rgba(0,0,0,0.08);--input-bg:#f8f9fa}
[data-theme="dark"]{--bg:#1a1a2e;--card:#16213e;--text:#e0e0e0;--text2:#aaa;--border:#2a2a4a;--shadow:0 4px 20px rgba(0,0,0,0.3);--input-bg:#0f3460}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:all .3s}
.container{max-width:800px;margin:0 auto;padding:20px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px}
h1{font-size:1.6rem;background:linear-gradient(135deg,var(--primary),var(--primary2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header-right{display:flex;gap:8px;align-items:center}
.theme-btn{background:var(--card);border:1px solid var(--border);border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center;transition:all .3s;box-shadow:var(--shadow)}
.theme-btn:hover{transform:scale(1.1)}
.card{background:var(--card);border-radius:16px;padding:24px;box-shadow:var(--shadow);margin-bottom:20px}
.card h2{font-size:1.1rem;margin-bottom:16px;display:flex;align-items:center;gap:8px}
input,select{padding:10px 14px;border:1px solid var(--border);border-radius:10px;background:var(--input-bg);color:var(--text);font-size:.95rem;font-family:inherit;transition:border .3s}
input:focus,select:focus{outline:none;border-color:var(--primary)}
.btn{padding:10px 20px;border:none;border-radius:10px;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .3s}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary2));color:#fff}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(108,92,231,.3)}
.btn-secondary{background:var(--input-bg);color:var(--text);border:1px solid var(--border)}
.btn-danger{background:rgba(225,112,85,.1);color:var(--danger);border:1px solid var(--danger)}
.btn-sm{padding:8px 14px;font-size:.8rem}
.btn-icon{background:none;border:none;cursor:pointer;font-size:1rem;opacity:.5;padding:4px;transition:opacity .3s}
.btn-icon:hover{opacity:1}
.members-section{margin-bottom:16px}
.member-input-row{display:flex;gap:8px;margin-bottom:12px;align-items:center}
.member-input-row input{flex:1}
.member-tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.member-tag{display:flex;align-items:center;gap:6px;background:var(--input-bg);border-radius:20px;padding:6px 12px;font-size:.85rem;font-weight:600;border:2px solid var(--border);transition:all .3s}
.member-tag .color-dot{width:10px;height:10px;border-radius:50%}
.member-tag button{background:none;border:none;cursor:pointer;opacity:.5;font-size:.8rem}
.member-tag button:hover{opacity:1}
.expense-form{display:grid;gap:12px;margin-bottom:16px}
.expense-row{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:8px;align-items:center}
@media(max-width:600px){.expense-row{grid-template-columns:1fr 1fr;}.expense-row>*:first-child{grid-column:1/-1}}
.split-options{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.split-chip{padding:6px 12px;border:1px solid var(--border);border-radius:20px;font-size:.8rem;cursor:pointer;transition:all .3s;background:transparent;color:var(--text)}
.split-chip.active{border-color:var(--primary);background:rgba(108,92,231,.1);color:var(--primary)}
.expense-list{max-height:300px;overflow-y:auto}
.expense-item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border);gap:8px}
.expense-item:last-child{border:none}
.expense-item .desc{font-weight:600;font-size:.9rem}
.expense-item .meta{font-size:.75rem;color:var(--text2)}
.expense-item .amount{font-weight:700;font-size:.95rem;color:var(--primary);white-space:nowrap}
.result-card{background:linear-gradient(135deg,rgba(108,92,231,.05),rgba(162,155,254,.05));border:1px solid rgba(108,92,231,.2);border-radius:16px;padding:20px;margin-bottom:16px}
.result-total{text-align:center;margin-bottom:20px}
.result-total .big{font-size:2rem;font-weight:700;color:var(--primary)}
.result-total .sub{font-size:.85rem;color:var(--text2)}
.balance-list{display:grid;gap:8px;margin-bottom:20px}
.balance-item{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--card);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.balance-item .name{font-weight:600;display:flex;align-items:center;gap:6px}
.balance-item .paid{font-size:.8rem;color:var(--text2)}
.balance-item .owes{font-weight:700}
.balance-item .owes.positive{color:var(--success)}
.balance-item .owes.negative{color:var(--danger)}
.settlement-list{display:grid;gap:10px}
.settlement-item{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);font-size:.9rem}
.settlement-arrow{color:var(--primary);font-weight:700;font-size:1.2rem}
.settlement-amount{margin-left:auto;font-weight:700;color:var(--danger);white-space:nowrap}
.empty{text-align:center;padding:30px;color:var(--text2)}
.empty .icon{font-size:2.5rem;margin-bottom:8px}
.back-link{display:inline-flex;align-items:center;gap:6px;color:var(--text2);text-decoration:none;font-size:.85rem;margin-bottom:16px;transition:color .3s}
.back-link:hover{color:var(--primary)}
.share-btn{margin-top:12px}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px}
.summary-stat{text-align:center;padding:16px;background:var(--input-bg);border-radius:12px}
.summary-stat .num{font-size:1.3rem;font-weight:700}
.summary-stat .label{font-size:.75rem;color:var(--text2);margin-top:4px}
</style>
</head>
<body>
<div class="container">
<a href="/tools/" class="back-link">â† ë„êµ¬ ëª©ë¡</a>
<header>
<h1>ğŸ’¸ ë”ì¹˜í˜ì´ ê³„ì‚°ê¸°</h1>
<div class="header-right">
<button class="btn btn-secondary btn-sm" onclick="resetAll()">ğŸ”„ ìƒˆ ëª¨ì„</button>
<button class="theme-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
</div>
</header>

<div class="card">
<h2>ğŸ‘¥ ë©¤ë²„</h2>
<div class="member-input-row">
<input type="text" id="memberName" placeholder="ì´ë¦„ ì…ë ¥ í›„ Enter" onkeydown="if(event.key==='Enter')addMember()">
<button class="btn btn-primary btn-sm" onclick="addMember()">ì¶”ê°€</button>
</div>
<div class="member-tags" id="memberTags"></div>
</div>

<div class="card">
<h2>ğŸ’³ ì§€ì¶œ ì¶”ê°€</h2>
<div class="expense-form">
<div class="expense-row">
<input type="text" id="expDesc" placeholder="ì„¤ëª… (ì˜ˆ: ì €ë… ì‹ì‚¬)">
<input type="number" id="expAmount" placeholder="ê¸ˆì•¡" min="0">
<select id="expPayer"></select>
<button class="btn btn-primary btn-sm" onclick="addExpense()">ì¶”ê°€</button>
</div>
<div>
<span style="font-size:.8rem;color:var(--text2)">ë¶„ë°° ë°©ì‹:</span>
<div class="split-options" id="splitOptions">
<button class="split-chip active" data-split="equal" onclick="setSplit('equal')">ê· ë“± ë¶„ë°°</button>
<button class="split-chip" data-split="custom" onclick="setSplit('custom')">ì§ì ‘ ì§€ì •</button>
</div>
<div id="customSplit" style="display:none;margin-top:12px"></div>
</div>
</div>
</div>

<div class="card">
<h2>ğŸ“‹ ì§€ì¶œ ë‚´ì—­</h2>
<div class="expense-list" id="expenseList">
<div class="empty"><div class="icon">ğŸ§¾</div><p>ì§€ì¶œì„ ì¶”ê°€í•˜ì„¸ìš”</p></div>
</div>
</div>

<div id="resultSection" style="display:none">
<div class="result-card">
<div class="result-total">
<div class="big" id="grandTotal">â‚©0</div>
<div class="sub">ì´ ì§€ì¶œ</div>
</div>
<div class="summary-grid" id="summaryGrid"></div>
</div>

<div class="card">
<h2>âš–ï¸ ì”ì•¡</h2>
<div class="balance-list" id="balanceList"></div>
</div>

<div class="card">
<h2>ğŸ’° ì •ì‚° ì•ˆë‚´</h2>
<div class="settlement-list" id="settlementList"></div>
<button class="btn btn-secondary share-btn" onclick="copySettlement()">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
</div>
</div>
</div>

<script>
const MEMBER_COLORS=['#6c5ce7','#00b894','#e17055','#0984e3','#e84393','#fdcb6e','#00cec9','#ff7675','#a29bfe','#55efc4'];
let state=JSON.parse(localStorage.getItem('es_data')||'null')||{members:[],expenses:[],splitMode:'equal'};
let theme=localStorage.getItem('es_theme')||'light';

function init(){
  if(theme==='dark')document.documentElement.setAttribute('data-theme','dark');
  updateThemeBtn();
  render();
}

function save(){localStorage.setItem('es_data',JSON.stringify(state))}
function toggleTheme(){
  theme=theme==='dark'?'light':'dark';
  document.documentElement.toggleAttribute('data-theme',theme==='dark');
  localStorage.setItem('es_theme',theme);
  updateThemeBtn();
}
function updateThemeBtn(){document.getElementById('themeBtn').textContent=theme==='dark'?'â˜€ï¸':'ğŸŒ™'}

function addMember(){
  const input=document.getElementById('memberName');
  const name=input.value.trim();
  if(!name)return;
  if(state.members.find(m=>m.name===name)){alert('ì´ë¯¸ ìˆëŠ” ì´ë¦„ì…ë‹ˆë‹¤');return}
  state.members.push({name,color:MEMBER_COLORS[state.members.length%MEMBER_COLORS.length]});
  input.value='';
  save();render();
}

function removeMember(name){
  state.members=state.members.filter(m=>m.name!==name);
  state.expenses=state.expenses.filter(e=>{
    if(e.payer===name)return false;
    e.participants=e.participants.filter(p=>p!==name);
    return e.participants.length>0;
  });
  save();render();
}

function addExpense(){
  const desc=document.getElementById('expDesc').value.trim();
  const amount=parseFloat(document.getElementById('expAmount').value);
  const payer=document.getElementById('expPayer').value;
  if(!desc){alert('ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”');return}
  if(!amount||amount<=0){alert('ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”');return}
  if(!payer){alert('ê²°ì œìë¥¼ ì„ íƒí•˜ì„¸ìš”');return}

  let participants;
  if(state.splitMode==='custom'){
    const checks=document.querySelectorAll('.custom-check:checked');
    participants=[...checks].map(c=>c.value);
    if(!participants.length){alert('ë¶„ë°° ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”');return}
  }else{
    participants=state.members.map(m=>m.name);
  }

  state.expenses.push({id:Date.now(),desc,amount,payer,participants,date:new Date().toISOString()});
  save();render();
  document.getElementById('expDesc').value='';
  document.getElementById('expAmount').value='';
}

function removeExpense(id){
  state.expenses=state.expenses.filter(e=>e.id!==id);
  save();render();
}

function setSplit(mode){
  state.splitMode=mode;
  document.querySelectorAll('.split-chip').forEach(c=>c.classList.toggle('active',c.dataset.split===mode));
  renderCustomSplit();
  save();
}

function renderCustomSplit(){
  const el=document.getElementById('customSplit');
  if(state.splitMode==='custom'){
    el.style.display='flex';
    el.style.gap='8px';
    el.style.flexWrap='wrap';
    el.innerHTML=state.members.map(m=>`<label style="display:flex;align-items:center;gap:4px;font-size:.85rem;cursor:pointer"><input type="checkbox" class="custom-check" value="${m.name}" checked> ${m.name}</label>`).join('');
  }else{
    el.style.display='none';
  }
}

function render(){
  renderMembers();
  renderExpenses();
  renderResults();
}

function renderMembers(){
  const el=document.getElementById('memberTags');
  el.innerHTML=state.members.map(m=>`<div class="member-tag"><div class="color-dot" style="background:${m.color}"></div>${m.name}<button onclick="removeMember('${m.name}')">âœ•</button></div>`).join('');
  const sel=document.getElementById('expPayer');
  sel.innerHTML=state.members.length?state.members.map(m=>`<option value="${m.name}">${m.name}</option>`).join(''):'<option value="">ë©¤ë²„ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</option>';
  renderCustomSplit();
}

function renderExpenses(){
  const el=document.getElementById('expenseList');
  if(!state.expenses.length){
    el.innerHTML='<div class="empty"><div class="icon">ğŸ§¾</div><p>ì§€ì¶œì„ ì¶”ê°€í•˜ì„¸ìš”</p></div>';
    return;
  }
  el.innerHTML=state.expenses.map(e=>`
    <div class="expense-item">
      <div>
        <div class="desc">${escHtml(e.desc)}</div>
        <div class="meta">${e.payer} ê²°ì œ Â· ${e.participants.length}ëª… ë¶„ë°°</div>
      </div>
      <div class="amount">${formatMoney(e.amount)}</div>
      <button class="btn-icon" onclick="removeExpense(${e.id})">âœ•</button>
    </div>`).join('');
}

function renderResults(){
  if(!state.expenses.length||!state.members.length){
    document.getElementById('resultSection').style.display='none';
    return;
  }
  document.getElementById('resultSection').style.display='block';

  const total=state.expenses.reduce((s,e)=>s+e.amount,0);
  document.getElementById('grandTotal').textContent=formatMoney(total);

  // Calculate balances
  const balances={};
  state.members.forEach(m=>balances[m.name]=0);

  state.expenses.forEach(e=>{
    const share=e.amount/e.participants.length;
    if(balances[e.payer]!==undefined)balances[e.payer]+=e.amount;
    e.participants.forEach(p=>{
      if(balances[p]!==undefined)balances[p]-=share;
    });
  });

  // Summary grid
  const paid={};
  state.members.forEach(m=>paid[m.name]=0);
  state.expenses.forEach(e=>{if(paid[e.payer]!==undefined)paid[e.payer]+=e.amount});

  document.getElementById('summaryGrid').innerHTML=state.members.map(m=>{
    const member=state.members.find(x=>x.name===m.name);
    return `<div class="summary-stat"><div class="num" style="color:${member.color}">${formatMoney(paid[m.name])}</div><div class="label">${m.name} ê²°ì œ</div></div>`;
  }).join('');

  // Balance list
  document.getElementById('balanceList').innerHTML=state.members.map(m=>{
    const bal=balances[m.name]||0;
    const member=state.members.find(x=>x.name===m.name);
    return `<div class="balance-item">
      <div><div class="name"><div class="color-dot" style="background:${member.color};width:8px;height:8px;border-radius:50%;display:inline-block"></div>${m.name}</div><div class="paid">ê²°ì œ: ${formatMoney(paid[m.name])}</div></div>
      <div class="owes ${bal>=0?'positive':'negative'}">${bal>=0?'+':''}${formatMoney(Math.round(bal))}</div>
    </div>`;
  }).join('');

  // Calculate settlements (greedy algorithm)
  const debtors=[];
  const creditors=[];
  state.members.forEach(m=>{
    const b=Math.round(balances[m.name]||0);
    if(b<0)debtors.push({name:m.name,amount:-b});
    else if(b>0)creditors.push({name:m.name,amount:b});
  });
  debtors.sort((a,b)=>b.amount-a.amount);
  creditors.sort((a,b)=>b.amount-a.amount);

  const settlements=[];
  let di=0,ci=0;
  while(di<debtors.length&&ci<creditors.length){
    const transfer=Math.min(debtors[di].amount,creditors[ci].amount);
    if(transfer>0)settlements.push({from:debtors[di].name,to:creditors[ci].name,amount:transfer});
    debtors[di].amount-=transfer;
    creditors[ci].amount-=transfer;
    if(debtors[di].amount<=0)di++;
    if(creditors[ci].amount<=0)ci++;
  }

  const sEl=document.getElementById('settlementList');
  if(!settlements.length){
    sEl.innerHTML='<div class="empty"><div class="icon">âœ…</div><p>ì •ì‚°í•  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
  }else{
    sEl.innerHTML=settlements.map(s=>`
      <div class="settlement-item">
        <strong>${s.from}</strong>
        <span class="settlement-arrow">â†’</span>
        <strong>${s.to}</strong>
        <span class="settlement-amount">${formatMoney(s.amount)}</span>
      </div>`).join('');
  }
}

function copySettlement(){
  const total=state.expenses.reduce((s,e)=>s+e.amount,0);
  let text=`ğŸ’¸ ë”ì¹˜í˜ì´ ì •ì‚°\nì´ ì§€ì¶œ: ${formatMoney(total)}\n\n`;

  const balances={};
  state.members.forEach(m=>balances[m.name]=0);
  state.expenses.forEach(e=>{
    if(balances[e.payer]!==undefined)balances[e.payer]+=e.amount;
    const share=e.amount/e.participants.length;
    e.participants.forEach(p=>{if(balances[p]!==undefined)balances[p]-=share});
  });

  const debtors=[],creditors=[];
  state.members.forEach(m=>{
    const b=Math.round(balances[m.name]||0);
    if(b<0)debtors.push({name:m.name,amount:-b});
    else if(b>0)creditors.push({name:m.name,amount:b});
  });
  debtors.sort((a,b)=>b.amount-a.amount);
  creditors.sort((a,b)=>b.amount-a.amount);

  let di=0,ci=0;
  text+='ğŸ’° ì •ì‚° ì•ˆë‚´:\n';
  while(di<debtors.length&&ci<creditors.length){
    const transfer=Math.min(debtors[di].amount,creditors[ci].amount);
    if(transfer>0)text+=`  ${debtors[di].name} â†’ ${creditors[ci].name}: ${formatMoney(transfer)}\n`;
    debtors[di].amount-=transfer;
    creditors[ci].amount-=transfer;
    if(debtors[di].amount<=0)di++;
    if(creditors[ci].amount<=0)ci++;
  }

  navigator.clipboard.writeText(text).then(()=>alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')).catch(()=>{
    const ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
  });
}

function resetAll(){
  if(state.expenses.length&&!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  state={members:[],expenses:[],splitMode:'equal'};
  save();render();
}

function formatMoney(n){return 'â‚©'+Math.abs(n).toLocaleString('ko-KR')}
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

init();
</script>
</body>
</html>