<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Playground | ì›¹ ë„êµ¬ ëª¨ìŒ</title>
    <style>
        :root{--bg-primary:#fff;--bg-secondary:#f8f9fa;--text-primary:#212529;--text-secondary:#6c757d;--accent:linear-gradient(135deg,#667eea 0%,#764ba2 100%);--border:#dee2e6;--shadow:rgba(0,0,0,.1);--card-bg:#fff}
        [data-theme="dark"]{--bg-primary:#1a1a1a;--bg-secondary:#121212;--text-primary:#f8f9fa;--text-secondary:#adb5bd;--border:#444;--shadow:rgba(0,0,0,.3);--card-bg:#2d2d2d}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:var(--bg-secondary);color:var(--text-primary);line-height:1.6;padding:20px;min-height:100vh}
        .container{max-width:1000px;margin:0 auto}
        header{display:flex;align-items:center;justify-content:space-between;margin-bottom:30px}
        .back-btn{text-decoration:none;color:var(--text-secondary);display:flex;align-items:center;gap:5px;font-weight:500}.back-btn:hover{color:var(--text-primary)}
        .theme-toggle{background:none;border:none;cursor:pointer;font-size:1.5rem}
        .card{background:var(--card-bg);border-radius:20px;padding:30px;box-shadow:0 10px 30px var(--shadow);border:1px solid var(--border);margin-bottom:20px}
        h1{font-size:1.8rem;margin-bottom:10px;background:var(--accent);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
        .desc{color:var(--text-secondary);margin-bottom:20px}
        label{display:block;font-weight:600;margin-bottom:6px;font-size:.9rem}
        input,textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:12px;background:var(--bg-primary);color:var(--text-primary);font-size:.9rem;outline:none;font-family:'Courier New',monospace;margin-bottom:16px}
        input:focus,textarea:focus{border-color:#667eea}
        textarea{resize:vertical;height:200px;tab-size:2}
        .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px}
        .btn{padding:10px 20px;border:none;border-radius:12px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .2s}
        .btn-primary{background:var(--accent);color:#fff}
        .btn-secondary{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border)}
        .btn:hover{opacity:.85;transform:translateY(-1px)}
        .split{display:grid;grid-template-columns:1fr 1fr;gap:20px}
        .tab-row{display:flex;gap:4px;margin-bottom:12px}
        .tab{padding:8px 16px;border:1px solid var(--border);border-radius:10px 10px 0 0;cursor:pointer;font-size:.85rem;background:var(--bg-secondary);color:var(--text-secondary)}
        .tab.active{background:var(--card-bg);color:var(--text-primary);border-bottom-color:var(--card-bg);font-weight:600}
        .output-box{background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:16px;font-family:'Courier New',monospace;font-size:.85rem;white-space:pre-wrap;word-break:break-all;min-height:200px;max-height:500px;overflow:auto;position:relative}
        .copy-btn{position:absolute;top:10px;right:10px;padding:6px 12px;background:var(--card-bg);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-size:.8rem;color:var(--text-primary)}
        .gql-keyword{color:#667eea;font-weight:600}
        .gql-type{color:#d97706}
        .gql-field{color:#059669}
        .gql-string{color:#dc2626}
        .schema-section{margin-bottom:16px}
        .schema-type{padding:12px;background:var(--bg-secondary);border-radius:10px;margin-bottom:8px;font-family:'Courier New',monospace;font-size:.85rem}
        .history-item{padding:8px 12px;border:1px solid var(--border);border-radius:8px;margin-bottom:6px;cursor:pointer;font-size:.8rem;font-family:'Courier New',monospace;transition:border-color .2s}
        .history-item:hover{border-color:#667eea}
        @media(max-width:700px){.split{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <header>
        <a href="../" class="back-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
    </header>
    <div class="card">
        <h1>ğŸ”® GraphQL Playground</h1>
        <p class="desc">GraphQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  ìŠ¤í‚¤ë§ˆë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤. ë‚´ì¥ ìƒ˜í”Œ ìŠ¤í‚¤ë§ˆë¡œ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <label for="endpoint">ì—”ë“œí¬ì¸íŠ¸ URL (ì„ íƒ, ë‚´ì¥ ìŠ¤í‚¤ë§ˆ ì‚¬ìš© ì‹œ ë¹„ì›Œë‘ì„¸ìš”)</label>
        <input type="text" id="endpoint" placeholder="https://api.example.com/graphql">
        <div class="btn-row">
            <button class="btn btn-primary" onclick="executeQuery()">â–¶ ì‹¤í–‰</button>
            <button class="btn btn-secondary" onclick="formatQuery()">í¬ë§·</button>
            <button class="btn btn-secondary" onclick="showSchema()">ìŠ¤í‚¤ë§ˆ ë³´ê¸°</button>
            <button class="btn btn-secondary" onclick="loadExample('query')">ì¿¼ë¦¬ ì˜ˆì œ</button>
            <button class="btn btn-secondary" onclick="loadExample('mutation')">ë®¤í…Œì´ì…˜ ì˜ˆì œ</button>
        </div>
    </div>
    <div class="split">
        <div class="card" style="padding:20px">
            <div class="tab-row">
                <div class="tab active" onclick="showTab('query',this)">Query</div>
                <div class="tab" onclick="showTab('variables',this)">Variables</div>
                <div class="tab" onclick="showTab('headers',this)">Headers</div>
            </div>
            <textarea id="queryInput" placeholder="query {
  users {
    id
    name
    email
  }
}"></textarea>
            <textarea id="variablesInput" style="display:none;height:100px" placeholder='{ "id": 1 }'></textarea>
            <textarea id="headersInput" style="display:none;height:100px" placeholder='{ "Authorization": "Bearer ..." }'></textarea>
            <div style="font-size:.8rem;color:var(--text-secondary)">ğŸ“œ íˆìŠ¤í† ë¦¬</div>
            <div id="history"></div>
        </div>
        <div class="card" style="padding:20px">
            <label>ê²°ê³¼</label>
            <div class="output-box" id="output">ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...<button class="copy-btn" onclick="copyOut()">ë³µì‚¬</button></div>
        </div>
    </div>
</div>
<script>
// Built-in mock schema & resolver
const SCHEMA = {
    types: {
        User: {id:'ID!',name:'String!',email:'String!',age:'Int',role:'Role!',posts:'[Post!]!'},
        Post: {id:'ID!',title:'String!',body:'String!',published:'Boolean!',author:'User!',comments:'[Comment!]!',createdAt:'String!'},
        Comment: {id:'ID!',text:'String!',author:'User!',createdAt:'String!'},
        Role: {__enum:['ADMIN','USER','MODERATOR']},
    },
    queries: {
        users: {returns:'[User!]!',args:{}},
        user: {returns:'User',args:{id:'ID!'}},
        posts: {returns:'[Post!]!',args:{published:'Boolean'}},
        post: {returns:'Post',args:{id:'ID!'}},
    },
    mutations: {
        createUser: {returns:'User!',args:{name:'String!',email:'String!',role:'Role'}},
        createPost: {returns:'Post!',args:{title:'String!',body:'String!',authorId:'ID!'}},
        deletePost: {returns:'Boolean!',args:{id:'ID!'}},
    }
};

const MOCK_USERS = [
    {id:'1',name:'ê¹€ì² ìˆ˜',email:'kim@example.com',age:28,role:'ADMIN'},
    {id:'2',name:'ì´ì˜í¬',email:'lee@example.com',age:32,role:'USER'},
    {id:'3',name:'ë°•ì§€ë¯¼',email:'park@example.com',age:25,role:'MODERATOR'},
];
const MOCK_POSTS = [
    {id:'1',title:'GraphQL ì‹œì‘í•˜ê¸°',body:'GraphQLì€ APIë¥¼ ìœ„í•œ ì¿¼ë¦¬ ì–¸ì–´ì…ë‹ˆë‹¤...',published:true,authorId:'1',createdAt:'2026-01-15'},
    {id:'2',title:'REST vs GraphQL',body:'ë‘˜ì˜ ì°¨ì´ì ì„ ë¹„êµí•´ë´…ë‹ˆë‹¤...',published:true,authorId:'2',createdAt:'2026-02-01'},
    {id:'3',title:'Draft Post',body:'ì•„ì§ ì‘ì„±ì¤‘...',published:false,authorId:'1',createdAt:'2026-02-10'},
];
const MOCK_COMMENTS = [
    {id:'1',text:'ì¢‹ì€ ê¸€ì´ë„¤ìš”!',authorId:'2',postId:'1',createdAt:'2026-01-16'},
    {id:'2',text:'ë„ì›€ì´ ëìŠµë‹ˆë‹¤',authorId:'3',postId:'1',createdAt:'2026-01-17'},
];

let queryHistory = JSON.parse(localStorage.getItem('gql-history')||'[]');

function executeQuery(){
    const q = document.getElementById('queryInput').value.trim();
    if(!q){showResult({errors:[{message:'ì¿¼ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}]});return}
    const endpoint = document.getElementById('endpoint').value.trim();
    if(endpoint){
        // Real endpoint
        let vars = {};
        try{ vars = JSON.parse(document.getElementById('variablesInput').value||'{}') }catch{}
        let hdrs = {'Content-Type':'application/json'};
        try{ Object.assign(hdrs, JSON.parse(document.getElementById('headersInput').value||'{}')) }catch{}
        fetch(endpoint,{method:'POST',headers:hdrs,body:JSON.stringify({query:q,variables:vars})})
            .then(r=>r.json()).then(d=>showResult(d)).catch(e=>showResult({errors:[{message:e.message}]}));
    } else {
        // Mock resolver
        const result = mockResolve(q);
        showResult(result);
    }
    addHistory(q);
}

function mockResolve(q){
    try{
        // Simple parser: extract operation and root fields
        const cleaned = q.replace(/#.*/g,'').replace(/\s+/g,' ').trim();
        // Check for users query
        if(/\busers\b/.test(cleaned)){
            const users = MOCK_USERS.map(u=>resolveFields(u,'User',cleaned));
            return {data:{users}};
        }
        if(/\buser\b/.test(cleaned)){
            const idMatch = cleaned.match(/id\s*:\s*["']?(\d+)["']?/);
            const u = MOCK_USERS.find(u=>u.id===(idMatch?idMatch[1]:'1'))||null;
            return {data:{user:u?resolveFields(u,'User',cleaned):null}};
        }
        if(/\bposts\b/.test(cleaned)){
            let posts = MOCK_POSTS;
            if(/published\s*:\s*true/.test(cleaned)) posts=posts.filter(p=>p.published);
            return {data:{posts:posts.map(p=>resolveFields(p,'Post',cleaned))}};
        }
        if(/\bpost\b/.test(cleaned)){
            const idMatch = cleaned.match(/id\s*:\s*["']?(\d+)["']?/);
            const p = MOCK_POSTS.find(p=>p.id===(idMatch?idMatch[1]:'1'))||null;
            return {data:{post:p?resolveFields(p,'Post',cleaned):null}};
        }
        if(/\bcreateUser\b/.test(cleaned)){
            return {data:{createUser:{id:String(MOCK_USERS.length+1),name:'New User',email:'new@example.com',role:'USER'}}};
        }
        if(/\bcreatePost\b/.test(cleaned)){
            return {data:{createPost:{id:String(MOCK_POSTS.length+1),title:'New Post',body:'Content...',published:false,createdAt:'2026-02-14'}}};
        }
        if(/\bdeletePost\b/.test(cleaned)){
            return {data:{deletePost:true}};
        }
        return {errors:[{message:'ì•Œ ìˆ˜ ì—†ëŠ” ì¿¼ë¦¬ì…ë‹ˆë‹¤. ë‚´ì¥ ìŠ¤í‚¤ë§ˆ: users, user, posts, post, createUser, createPost, deletePost'}]};
    }catch(e){return {errors:[{message:e.message}]}}
}

function resolveFields(obj, typeName, query){
    const result = {...obj};
    // Resolve nested
    if(typeName==='User' && /\bposts\b/.test(query)){
        result.posts = MOCK_POSTS.filter(p=>p.authorId===obj.id);
    }
    if(typeName==='Post' && /\bauthor\b/.test(query)){
        result.author = MOCK_USERS.find(u=>u.id===obj.authorId)||null;
    }
    if(typeName==='Post' && /\bcomments\b/.test(query)){
        result.comments = MOCK_COMMENTS.filter(c=>c.postId===obj.id).map(c=>({...c,author:MOCK_USERS.find(u=>u.id===c.authorId)}));
    }
    return result;
}

function showResult(data){
    const json = JSON.stringify(data,null,2);
    document.getElementById('output').innerHTML = highlightJSON(esc(json))+'<button class="copy-btn" onclick="copyOut()">ë³µì‚¬</button>';
}

function highlightJSON(json){
    return json.replace(/"([^"]+)"(?=\s*:)/g,'<span class="gql-keyword">"$1"</span>')
        .replace(/"([^"]+)"(?!\s*:)/g,'<span class="gql-string">"$1"</span>')
        .replace(/\b(\d+)\b/g,'<span class="gql-type">$1</span>')
        .replace(/\b(true|false|null)\b/g,'<span class="gql-field">$1</span>');
}

function formatQuery(){
    let q = document.getElementById('queryInput').value;
    let indent = 0; let formatted = '';
    const tokens = q.replace(/([{}()])/g,' $1 ').split(/\s+/).filter(Boolean);
    tokens.forEach(t=>{
        if(t==='}' || t===')') indent = Math.max(0,indent-1);
        formatted += '  '.repeat(indent)+t+'\n';
        if(t==='{' || t==='(') indent++;
    });
    document.getElementById('queryInput').value = formatted.trim();
}

function showSchema(){
    let html = '<strong>ğŸ“ ë‚´ì¥ ìŠ¤í‚¤ë§ˆ</strong>\n\n';
    html += '<span class="gql-keyword">Types:</span>\n';
    for(const [name,fields] of Object.entries(SCHEMA.types)){
        if(fields.__enum){html+=`  enum ${name} { ${fields.__enum.join(' | ')} }\n`;continue}
        html+=`  type <span class="gql-type">${name}</span> {\n`;
        for(const [f,t] of Object.entries(fields)) html+=`    ${f}: <span class="gql-field">${t}</span>\n`;
        html+='  }\n';
    }
    html+='\n<span class="gql-keyword">Queries:</span>\n';
    for(const [name,q] of Object.entries(SCHEMA.queries)){
        const args=Object.entries(q.args).map(([k,v])=>`${k}: ${v}`).join(', ');
        html+=`  ${name}(${args}): <span class="gql-field">${q.returns}</span>\n`;
    }
    html+='\n<span class="gql-keyword">Mutations:</span>\n';
    for(const [name,m] of Object.entries(SCHEMA.mutations)){
        const args=Object.entries(m.args).map(([k,v])=>`${k}: ${v}`).join(', ');
        html+=`  ${name}(${args}): <span class="gql-field">${m.returns}</span>\n`;
    }
    document.getElementById('output').innerHTML=html+'<button class="copy-btn" onclick="copyOut()">ë³µì‚¬</button>';
}

function loadExample(type){
    if(type==='query'){
        document.getElementById('queryInput').value=`query {
  users {
    id
    name
    email
    role
    posts {
      id
      title
      published
    }
  }
}`;
    } else {
        document.getElementById('queryInput').value=`mutation {
  createUser(name: "í™ê¸¸ë™", email: "hong@example.com", role: ADMIN) {
    id
    name
    email
    role
  }
}`;
    }
}

function addHistory(q){
    queryHistory = [q,...queryHistory.filter(h=>h!==q)].slice(0,10);
    localStorage.setItem('gql-history',JSON.stringify(queryHistory));
    renderHistory();
}
function renderHistory(){
    document.getElementById('history').innerHTML = queryHistory.map((h,i)=>
        `<div class="history-item" onclick="document.getElementById('queryInput').value=queryHistory[${i}]">${esc(h.substring(0,80))}${h.length>80?'...':''}</div>`
    ).join('');
}

function showTab(tab, el){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('queryInput').style.display=tab==='query'?'':'none';
    document.getElementById('variablesInput').style.display=tab==='variables'?'':'none';
    document.getElementById('headersInput').style.display=tab==='headers'?'':'none';
}

function copyOut(){const el=document.getElementById('output');const t=el.textContent.replace('ë³µì‚¬','').replace('ë³µì‚¬ë¨!','').trim();navigator.clipboard.writeText(t).then(()=>{const b=el.querySelector('.copy-btn');b.textContent='ë³µì‚¬ë¨!';setTimeout(()=>b.textContent='ë³µì‚¬',1500)})}
function esc(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function toggleTheme(){const h=document.documentElement;const t=h.getAttribute('data-theme')==='dark'?'light':'dark';h.setAttribute('data-theme',t);localStorage.setItem('theme',t)}
document.documentElement.setAttribute('data-theme',localStorage.getItem('theme')||'light');
renderHistory();
</script>
</body>
</html>
