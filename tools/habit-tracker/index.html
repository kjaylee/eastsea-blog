<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Tracker â€” ìŠµê´€ ì¶”ì ê¸°</title>
<meta name="description" content="ì¼ì¼/ì£¼ê°„ ìŠµê´€ ì²´í¬ë¦¬ìŠ¤íŠ¸, ì—°ì† ë‹¬ì„± ìŠ¤íŠ¸ë¦­, ì›”ê°„ íˆíŠ¸ë§µ, ìŠµê´€ë³„ ìƒ‰ìƒ/ì•„ì´ì½˜ ì»¤ìŠ¤í…€">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f5f5f7;--bg2:#fff;--bg3:#e9ecef;--tx:#212529;--tx2:#6c757d;--bd:#dee2e6;--ac:#667eea;--ac2:#764ba2;--radius:12px;--shadow:0 4px 16px rgba(0,0,0,.08);
--h0:#ebedf0;--h1:#9be9a8;--h2:#40c463;--h3:#30a14e;--h4:#216e39}
[data-theme="dark"]{--bg:#111;--bg2:#1e1e1e;--bg3:#2a2a2a;--tx:#e5e5e5;--tx2:#999;--bd:#333;--shadow:0 4px 16px rgba(0,0,0,.4);
--h0:#1e1e1e;--h1:#0e4429;--h2:#006d32;--h3:#26a641;--h4:#39d353}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;padding:16px;transition:background .3s,color .3s}
.container{max-width:900px;margin:0 auto}
header{text-align:center;padding:24px 0 16px}
h1{font-size:1.8rem;background:linear-gradient(135deg,var(--ac),var(--ac2));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.subtitle{color:var(--tx2);margin-top:4px;font-size:.95rem}
.theme-btn{position:fixed;top:12px;right:12px;width:40px;height:40px;border-radius:50%;border:2px solid var(--bd);background:var(--bg2);cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center;z-index:100;box-shadow:var(--shadow)}
.theme-btn:hover{transform:scale(1.1)}
.card{background:var(--bg2);border-radius:var(--radius);padding:20px;margin-bottom:16px;box-shadow:var(--shadow);border:1px solid var(--bd)}
.card-title{font-weight:700;margin-bottom:12px;font-size:1rem;display:flex;align-items:center;gap:8px;justify-content:space-between}
.btn{padding:8px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.85rem;transition:all .15s}
.btn-primary{background:var(--ac);color:#fff}.btn-primary:hover{opacity:.85}
.btn-outline{background:transparent;border:2px solid var(--bd);color:var(--tx)}.btn-outline:hover{border-color:var(--ac)}
.btn-sm{padding:5px 10px;font-size:.78rem}
.btn-icon{background:none;border:none;cursor:pointer;font-size:1.1rem;padding:4px;opacity:.6}.btn-icon:hover{opacity:1}

/* Habit Add Form */
.add-form{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.add-form input[type="text"]{flex:1;min-width:150px;padding:10px 12px;border:2px solid var(--bd);border-radius:8px;background:var(--bg);color:var(--tx);font-size:.9rem;outline:none}
.add-form input:focus{border-color:var(--ac)}
.icon-picker{position:relative;display:inline-block}
.icon-btn{padding:10px 14px;border:2px solid var(--bd);border-radius:8px;background:var(--bg);cursor:pointer;font-size:1.2rem}
.icon-dropdown{position:absolute;top:100%;left:0;background:var(--bg2);border:1px solid var(--bd);border-radius:8px;padding:8px;display:none;grid-template-columns:repeat(6,1fr);gap:4px;z-index:50;box-shadow:var(--shadow)}
.icon-dropdown.show{display:grid}
.icon-dropdown span{padding:6px;cursor:pointer;border-radius:4px;text-align:center;font-size:1.1rem}
.icon-dropdown span:hover{background:var(--bg3)}
.color-input{width:42px;height:42px;border:2px solid var(--bd);border-radius:8px;cursor:pointer;padding:2px;background:var(--bg)}

/* Nav */
.nav{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.nav-btn{padding:8px 16px;border:2px solid var(--bd);border-radius:20px;background:var(--bg);color:var(--tx);cursor:pointer;font-weight:600;font-size:.85rem;transition:all .15s}
.nav-btn.active{background:var(--ac);color:#fff;border-color:var(--ac)}
.month-nav{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.month-nav .month-label{font-weight:700;min-width:140px;text-align:center}
.month-nav button{background:var(--bg);border:2px solid var(--bd);border-radius:8px;padding:6px 12px;cursor:pointer;color:var(--tx);font-size:1rem}

/* Habit List */
.habit-item{padding:12px;border:1px solid var(--bd);border-radius:10px;margin-bottom:8px;transition:background .15s}
.habit-header{display:flex;align-items:center;gap:10px}
.habit-icon{font-size:1.5rem}
.habit-name{font-weight:700;font-size:.95rem;flex:1}
.streak-badge{padding:3px 10px;border-radius:12px;font-size:.75rem;font-weight:700;color:#fff;display:flex;align-items:center;gap:4px}
.habit-actions{display:flex;gap:2px}

/* Weekly view */
.week-row{display:flex;gap:4px;margin-top:8px}
.day-cell{flex:1;aspect-ratio:1;max-width:48px;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.7rem;cursor:pointer;transition:all .15s;border:2px solid transparent;min-width:32px}
.day-cell .dow{font-weight:600;margin-bottom:2px;font-size:.65rem;color:var(--tx2)}
.day-cell .dnum{font-weight:700}
.day-cell.checked{color:#fff;font-weight:700}
.day-cell.today{border-color:var(--ac)}
.day-cell:hover{transform:scale(1.08)}

/* Heatmap */
.heatmap-container{overflow-x:auto;padding:8px 0}
.heatmap{display:flex;gap:3px}
.heatmap-week{display:flex;flex-direction:column;gap:3px}
.heatmap-cell{width:14px;height:14px;border-radius:3px;background:var(--h0)}
.heatmap-cell.l1{background:var(--h1)}.heatmap-cell.l2{background:var(--h2)}.heatmap-cell.l3{background:var(--h3)}.heatmap-cell.l4{background:var(--h4)}
.heatmap-cell[title]{cursor:pointer}
.heatmap-labels{display:flex;flex-direction:column;gap:3px;margin-right:6px;font-size:.6rem;color:var(--tx2)}
.heatmap-labels span{height:14px;display:flex;align-items:center}
.heatmap-months{display:flex;gap:3px;margin-left:20px;font-size:.65rem;color:var(--tx2);margin-bottom:4px}
.legend{display:flex;align-items:center;gap:4px;margin-top:8px;font-size:.7rem;color:var(--tx2)}
.legend-box{width:12px;height:12px;border-radius:2px}

/* Summary */
.summary-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
.summary-card{background:var(--bg);padding:14px;border-radius:10px;text-align:center}
.summary-val{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--ac),var(--ac2));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.summary-label{font-size:.75rem;color:var(--tx2);margin-top:2px}

.empty-msg{text-align:center;padding:30px;color:var(--tx2)}

@media(max-width:600px){
h1{font-size:1.4rem}
.day-cell{max-width:36px}
.summary-grid{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>
<button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
<div class="container">
<header>
<h1>ğŸ¯ Habit Tracker</h1>
<p class="subtitle">ë§¤ì¼ ìŠµê´€ì„ ê¸°ë¡í•˜ê³  ì—°ì† ë‹¬ì„± ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”</p>
</header>

<!-- Summary -->
<div class="card">
<div class="summary-grid" id="summary"></div>
</div>

<!-- Add Habit -->
<div class="card">
<div class="card-title"><span>â• ìŠµê´€ ì¶”ê°€</span></div>
<div class="add-form" id="addForm">
<div class="icon-picker">
<button class="icon-btn" id="iconBtn" onclick="toggleIconPicker()">ğŸ¯</button>
<div class="icon-dropdown" id="iconDropdown"></div>
</div>
<input type="text" id="habitName" placeholder="ìƒˆ ìŠµê´€ ì´ë¦„..." maxlength="30">
<input type="color" class="color-input" id="habitColor" value="#667eea">
<button class="btn btn-primary" onclick="addHabit()">ì¶”ê°€</button>
</div>
</div>

<!-- View Toggle -->
<div class="nav" id="viewNav">
<button class="nav-btn active" data-view="weekly" onclick="setView('weekly')">ğŸ“… ì£¼ê°„</button>
<button class="nav-btn" data-view="heatmap" onclick="setView('heatmap')">ğŸ—“ï¸ íˆíŠ¸ë§µ</button>
</div>

<!-- Week Navigation -->
<div id="weekNav" class="month-nav">
<button onclick="changeWeek(-1)">â—€</button>
<span class="month-label" id="weekLabel"></span>
<button onclick="changeWeek(0)">ì˜¤ëŠ˜</button>
<button onclick="changeWeek(1)">â–¶</button>
</div>

<!-- Habits List / Weekly -->
<div id="habitsContainer"></div>

<!-- Heatmap View -->
<div id="heatmapContainer" style="display:none"></div>
</div>

<script>
const ICONS=['ğŸ¯','ğŸ’ª','ğŸ“š','ğŸƒ','ğŸ’§','ğŸ§˜','âœï¸','ğŸ¸','ğŸŒ…','ğŸ’¤','ğŸ¥—','ğŸ‹ï¸','ğŸ§¹','ğŸ’°','ğŸ¨','ğŸ“','ğŸš¶','ğŸ','ğŸ˜Š','ğŸ§ ','ğŸµ','ğŸŒ¿','â˜•','â°','ğŸ ','ğŸ•','ğŸ“–','ğŸ’»','ğŸ¤','ğŸ™'];
const STORAGE_KEY='habit-tracker-data-v2';
let habits=[];
let logs={};
let currentView='weekly';
let weekOffset=0;
let selectedIcon='ğŸ¯';

const $=id=>document.getElementById(id);

function loadData(){
try{const d=JSON.parse(localStorage.getItem(STORAGE_KEY));if(d){habits=d.habits||[];logs=d.logs||{}}}catch(e){}
}
function saveData(){localStorage.setItem(STORAGE_KEY,JSON.stringify({habits,logs}))}

function today(){return new Date().toISOString().slice(0,10)}
function dateKey(d){return d.toISOString().slice(0,10)}

function getWeekDays(offset=0){
const now=new Date();
const day=now.getDay();
const mon=new Date(now);
mon.setDate(now.getDate()-((day+6)%7)+offset*7);
const days=[];
for(let i=0;i<7;i++){const d=new Date(mon);d.setDate(mon.getDate()+i);days.push(d)}
return days;
}

function toggleIconPicker(){$('iconDropdown').classList.toggle('show')}
function initIconPicker(){
const c=$('iconDropdown');
ICONS.forEach(ic=>{const s=document.createElement('span');s.textContent=ic;s.onclick=()=>{selectedIcon=ic;$('iconBtn').textContent=ic;c.classList.remove('show')};c.appendChild(s)});
document.addEventListener('click',e=>{if(!e.target.closest('.icon-picker'))c.classList.remove('show')});
}

function addHabit(){
const name=$('habitName').value.trim();
if(!name)return;
const color=$('habitColor').value;
habits.push({id:Date.now().toString(36),name,icon:selectedIcon,color,createdAt:today()});
$('habitName').value='';
saveData();render();
}

function deleteHabit(id){
if(!confirm('ì´ ìŠµê´€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
habits=habits.filter(h=>h.id!==id);
Object.keys(logs).forEach(k=>{if(k.startsWith(id+':'))delete logs[k]});
saveData();render();
}

function toggleLog(habitId,date){
const key=habitId+':'+date;
if(logs[key])delete logs[key];else logs[key]=true;
saveData();render();
}

function isLogged(habitId,date){return !!logs[habitId+':'+date]}

function getStreak(habitId){
let streak=0;const d=new Date();
for(let i=0;i<365;i++){
const dk=dateKey(d);
if(isLogged(habitId,dk))streak++;
else if(i>0)break;
else{/* today not yet done, check from yesterday */}
d.setDate(d.getDate()-1);
}
if(!isLogged(habitId,today())){
streak=0;const d2=new Date();d2.setDate(d2.getDate()-1);
for(let i=0;i<365;i++){
if(isLogged(habitId,dateKey(d2)))streak++;else break;
d2.setDate(d2.getDate()-1);
}
}
return streak;
}

function getLongestStreak(habitId){
const start=new Date(habits.find(h=>h.id===habitId)?.createdAt||today());
const end=new Date();let max=0,cur=0;
for(let d=new Date(start);d<=end;d.setDate(d.getDate()+1)){
if(isLogged(habitId,dateKey(d))){cur++;if(cur>max)max=cur}else cur=0;
}
return max;
}

function getTotalDays(habitId){
return Object.keys(logs).filter(k=>k.startsWith(habitId+':')).length;
}

function setView(v){
currentView=v;
document.querySelectorAll('.nav-btn').forEach(b=>b.classList.toggle('active',b.dataset.view===v));
render();
}

function changeWeek(dir){
if(dir===0)weekOffset=0;else weekOffset+=dir;
render();
}

function renderSummary(){
const c=$('summary');
const totalHabits=habits.length;
const todayStr=today();
const doneToday=habits.filter(h=>isLogged(h.id,todayStr)).length;
const maxStreak=habits.reduce((mx,h)=>Math.max(mx,getStreak(h.id)),0);
const totalChecks=Object.keys(logs).length;
c.innerHTML=`
<div class="summary-card"><div class="summary-val">${totalHabits}</div><div class="summary-label">ì „ì²´ ìŠµê´€</div></div>
<div class="summary-card"><div class="summary-val">${doneToday}/${totalHabits}</div><div class="summary-label">ì˜¤ëŠ˜ ì™„ë£Œ</div></div>
<div class="summary-card"><div class="summary-val">ğŸ”¥ ${maxStreak}</div><div class="summary-label">ìµœì¥ ìŠ¤íŠ¸ë¦­</div></div>
<div class="summary-card"><div class="summary-val">${totalChecks}</div><div class="summary-label">ì´ ì²´í¬</div></div>`;
}

function renderWeekly(){
$('weekNav').style.display='flex';
$('heatmapContainer').style.display='none';
const c=$('habitsContainer');c.style.display='block';
const days=getWeekDays(weekOffset);
const todayStr=today();
const d0=days[0],d6=days[6];
$('weekLabel').textContent=`${d0.getMonth()+1}/${d0.getDate()} ~ ${d6.getMonth()+1}/${d6.getDate()}`;
if(habits.length===0){c.innerHTML='<div class="card"><div class="empty-msg">ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”! â˜ï¸</div></div>';return}
c.innerHTML='';
habits.forEach(h=>{
const streak=getStreak(h.id);
const div=document.createElement('div');div.className='card habit-item';
let weekHtml='<div class="week-row">';
const DOW=['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
days.forEach((d,i)=>{
const dk=dateKey(d);
const checked=isLogged(h.id,dk);
const isToday=dk===todayStr;
weekHtml+=`<div class="day-cell${checked?' checked':''}${isToday?' today':''}" style="${checked?'background:'+h.color:''}" onclick="toggleLog('${h.id}','${dk}')">
<span class="dow">${DOW[i]}</span><span class="dnum">${d.getDate()}</span></div>`;
});
weekHtml+='</div>';
div.innerHTML=`<div class="habit-header">
<span class="habit-icon">${h.icon}</span>
<span class="habit-name">${h.name}</span>
${streak>0?`<span class="streak-badge" style="background:${h.color}">ğŸ”¥ ${streak}ì¼</span>`:''}
<div class="habit-actions"><button class="btn-icon" onclick="deleteHabit('${h.id}')">ğŸ—‘ï¸</button></div>
</div>${weekHtml}`;
c.appendChild(div);
});
}

function renderHeatmap(){
$('weekNav').style.display='none';
$('habitsContainer').style.display='none';
const c=$('heatmapContainer');c.style.display='block';c.innerHTML='';
if(habits.length===0){c.innerHTML='<div class="card"><div class="empty-msg">ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”! â˜ï¸</div></div>';return}
habits.forEach(h=>{
const card=document.createElement('div');card.className='card';
const streak=getStreak(h.id);
const longest=getLongestStreak(h.id);
const total=getTotalDays(h.id);
card.innerHTML=`<div class="card-title"><span>${h.icon} ${h.name}</span><span style="display:flex;gap:8px;font-size:.8rem;font-weight:400;color:var(--tx2)">
ğŸ”¥ ${streak}ì¼ Â· ìµœì¥ ${longest}ì¼ Â· ì´ ${total}ì¼
<button class="btn-icon" onclick="deleteHabit('${h.id}')">ğŸ—‘ï¸</button></span></div>`;

// Build heatmap (last ~52 weeks)
const endDate=new Date();
const startDate=new Date(endDate);
startDate.setDate(startDate.getDate()-364);
// Align to Sunday
while(startDate.getDay()!==0)startDate.setDate(startDate.getDate()-1);

const hmDiv=document.createElement('div');hmDiv.className='heatmap-container';
// Month labels
const monthsDiv=document.createElement('div');monthsDiv.className='heatmap-months';
let lastMonth=-1;
const tempDate=new Date(startDate);
let weekCount=0;
while(tempDate<=endDate){
const m=tempDate.getMonth();
if(m!==lastMonth){
const span=document.createElement('span');
span.textContent=['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'][m];
span.style.marginLeft=(weekCount*17)+'px';
span.style.position='absolute';
monthsDiv.appendChild(span);
lastMonth=m;
}
tempDate.setDate(tempDate.getDate()+7);
weekCount++;
}
monthsDiv.style.position='relative';monthsDiv.style.height='16px';
hmDiv.appendChild(monthsDiv);

const row=document.createElement('div');row.style.display='flex';
// Day labels
const labels=document.createElement('div');labels.className='heatmap-labels';
['','ì›”','','ìˆ˜','','ê¸ˆ',''].forEach(d=>{const s=document.createElement('span');s.textContent=d;labels.appendChild(s)});
row.appendChild(labels);

const heatmap=document.createElement('div');heatmap.className='heatmap';
const cur=new Date(startDate);
while(cur<=endDate){
const weekCol=document.createElement('div');weekCol.className='heatmap-week';
for(let d=0;d<7;d++){
const cellDate=new Date(cur);cellDate.setDate(cur.getDate()+d);
if(cellDate>endDate){const empty=document.createElement('div');empty.className='heatmap-cell';weekCol.appendChild(empty);continue}
const dk=dateKey(cellDate);
const checked=isLogged(h.id,dk);
const cell=document.createElement('div');
cell.className='heatmap-cell';
if(checked){
// Color intensity based on habit color
cell.style.background=h.color;
cell.style.opacity='.85';
cell.classList.add('l3');
cell.style.background=h.color;
}
cell.title=`${dk}${checked?' âœ…':''}`;
cell.onclick=()=>{toggleLog(h.id,dk)};
weekCol.appendChild(cell);
}
heatmap.appendChild(weekCol);
cur.setDate(cur.getDate()+7);
}
row.appendChild(heatmap);
hmDiv.appendChild(row);

// Legend
const legend=document.createElement('div');legend.className='legend';
legend.innerHTML=`<span>ì ìŒ</span><div class="legend-box" style="background:var(--h0)"></div><div class="legend-box" style="background:${h.color};opacity:.3"></div><div class="legend-box" style="background:${h.color};opacity:.6"></div><div class="legend-box" style="background:${h.color};opacity:.85"></div><div class="legend-box" style="background:${h.color}"></div><span>ë§ìŒ</span>`;
hmDiv.appendChild(legend);

card.appendChild(hmDiv);
c.appendChild(card);
});
}

function render(){
renderSummary();
if(currentView==='weekly')renderWeekly();
else renderHeatmap();
}

function toggleTheme(){const t=document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',t);localStorage.setItem('ht-theme',t)}

(function init(){
const saved=localStorage.getItem('ht-theme')||(matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');
document.documentElement.setAttribute('data-theme',saved);
loadData();initIconPicker();
$('habitName').addEventListener('keydown',e=>{if(e.key==='Enter')addHabit()});
render();
})();
</script>
</body>
</html>
