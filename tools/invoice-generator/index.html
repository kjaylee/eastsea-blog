<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ë³´ì´ìŠ¤ ìƒì„±ê¸° - Invoice Generator | EastSea Tools</title>
  <meta name="description" content="í”„ë¦¬ëœì„œ/ì†Œê·œëª¨ ì‚¬ì—…ììš© ì¸ë³´ì´ìŠ¤ ìƒì„±ê¸°. PDF ë‹¤ìš´ë¡œë“œ, ë‹¤êµ­ì–´ í†µí™” ì§€ì›, 3ì¢… í…œí”Œë¦¿.">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --border: #e2e8f0;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white; padding: 24px 20px; text-align: center;
    }
    .header h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
    .header p { opacity: 0.9; font-size: 0.95rem; }
    .back-link { position: absolute; top: 20px; left: 20px; color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.9rem; }
    .back-link:hover { color: white; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    .tabs {
      display: flex; gap: 4px; background: var(--card); border-radius: var(--radius);
      padding: 4px; box-shadow: var(--shadow); margin-bottom: 20px; overflow-x: auto;
    }
    .tab {
      flex: 1; padding: 10px 16px; border: none; background: transparent;
      border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500;
      color: var(--text-light); transition: all 0.2s; white-space: nowrap;
    }
    .tab.active { background: var(--primary); color: white; }
    .tab:hover:not(.active) { background: #f1f5f9; }
    
    .section { display: none; }
    .section.active { display: block; }
    
    .card {
      background: var(--card); border-radius: var(--radius);
      box-shadow: var(--shadow); padding: 24px; margin-bottom: 20px;
    }
    .card h3 { font-size: 1.1rem; margin-bottom: 16px; color: var(--text); display: flex; align-items: center; gap: 8px; }
    
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-group.full { grid-column: 1 / -1; }
    .form-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-light); }
    .form-group input, .form-group select, .form-group textarea {
      padding: 10px 12px; border: 1.5px solid var(--border); border-radius: 8px;
      font-size: 0.95rem; transition: border-color 0.2s; outline: none; font-family: inherit;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: var(--primary);
    }
    
    .items-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .items-table th {
      background: #f8fafc; padding: 10px 12px; text-align: left;
      font-size: 0.8rem; font-weight: 600; color: var(--text-light);
      text-transform: uppercase; border-bottom: 2px solid var(--border);
    }
    .items-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); }
    .items-table input {
      width: 100%; padding: 8px; border: 1.5px solid var(--border);
      border-radius: 6px; font-size: 0.9rem; outline: none;
    }
    .items-table input:focus { border-color: var(--primary); }
    .items-table .num-input { text-align: right; }
    
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 10px 20px; border: none; border-radius: 8px;
      font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }
    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #059669; }
    .btn-danger { background: transparent; color: var(--danger); border: 1.5px solid var(--danger); }
    .btn-danger:hover { background: var(--danger); color: white; }
    .btn-outline { background: transparent; color: var(--primary); border: 1.5px solid var(--primary); }
    .btn-outline:hover { background: var(--primary); color: white; }
    .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
    
    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }
    
    .template-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .template-card {
      border: 2px solid var(--border); border-radius: var(--radius);
      padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s;
    }
    .template-card.selected { border-color: var(--primary); background: #f0f0ff; }
    .template-card:hover { border-color: var(--primary); }
    .template-card .icon { font-size: 2rem; margin-bottom: 8px; }
    .template-card .name { font-weight: 600; margin-bottom: 4px; }
    .template-card .desc { font-size: 0.8rem; color: var(--text-light); }
    
    .summary-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.95rem; }
    .summary-row.total { font-weight: 700; font-size: 1.1rem; border-top: 2px solid var(--text); padding-top: 12px; margin-top: 4px; }
    
    .logo-upload {
      width: 120px; height: 120px; border: 2px dashed var(--border);
      border-radius: var(--radius); display: flex; flex-direction: column;
      align-items: center; justify-content: center; cursor: pointer;
      transition: all 0.2s; overflow: hidden; position: relative;
    }
    .logo-upload:hover { border-color: var(--primary); }
    .logo-upload img { width: 100%; height: 100%; object-fit: contain; }
    .logo-upload .placeholder { text-align: center; color: var(--text-light); font-size: 0.8rem; }
    .logo-upload .placeholder span { font-size: 1.5rem; display: block; margin-bottom: 4px; }
    
    /* Preview Styles */
    .preview-container {
      background: white; border-radius: var(--radius);
      box-shadow: var(--shadow-lg); overflow: hidden;
    }
    
    /* Modern template */
    .inv-modern { padding: 40px; }
    .inv-modern .inv-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; }
    .inv-modern .inv-logo { max-height: 60px; max-width: 150px; }
    .inv-modern .inv-title { font-size: 2rem; font-weight: 800; color: var(--primary); text-align: right; }
    .inv-modern .inv-number { color: var(--text-light); font-size: 0.9rem; text-align: right; }
    .inv-modern .inv-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px; }
    .inv-modern .inv-party-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); font-weight: 600; margin-bottom: 6px; letter-spacing: 1px; }
    .inv-modern .inv-party-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; }
    .inv-modern .inv-party-detail { font-size: 0.85rem; color: var(--text-light); line-height: 1.6; }
    .inv-modern .inv-meta { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px; }
    .inv-modern .inv-meta-item { background: #f8fafc; padding: 12px 16px; border-radius: 8px; }
    .inv-modern .inv-meta-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-light); font-weight: 600; }
    .inv-modern .inv-meta-value { font-size: 0.95rem; font-weight: 600; margin-top: 2px; }
    .inv-modern table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
    .inv-modern thead th { background: var(--primary); color: white; padding: 12px 16px; text-align: left; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .inv-modern thead th:first-child { border-radius: 8px 0 0 0; }
    .inv-modern thead th:last-child { border-radius: 0 8px 0 0; text-align: right; }
    .inv-modern tbody td { padding: 12px 16px; border-bottom: 1px solid #f1f5f9; }
    .inv-modern tbody tr:hover { background: #fafbfc; }
    .inv-modern .text-right { text-align: right; }
    .inv-modern .inv-totals { display: flex; justify-content: flex-end; }
    .inv-modern .inv-totals-box { width: 280px; }
    .inv-modern .inv-total-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.9rem; }
    .inv-modern .inv-total-row.grand { font-size: 1.2rem; font-weight: 800; color: var(--primary); border-top: 2px solid var(--primary); padding-top: 12px; margin-top: 8px; }
    .inv-modern .inv-notes { margin-top: 30px; padding: 16px; background: #f8fafc; border-radius: 8px; border-left: 4px solid var(--primary); }
    .inv-modern .inv-notes-title { font-size: 0.8rem; text-transform: uppercase; color: var(--text-light); font-weight: 600; margin-bottom: 4px; }
    .inv-modern .inv-notes-text { font-size: 0.85rem; color: var(--text-light); }

    /* Classic template */
    .inv-classic { padding: 40px; border: 3px double #333; }
    .inv-classic .inv-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #333; }
    .inv-classic .inv-title { font-size: 2.2rem; font-weight: 700; letter-spacing: 4px; text-transform: uppercase; }
    .inv-classic .inv-logo { max-height: 60px; margin-bottom: 12px; }
    .inv-classic .inv-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px; }
    .inv-classic .inv-party-label { font-weight: 700; margin-bottom: 6px; text-transform: uppercase; font-size: 0.85rem; border-bottom: 1px solid #ccc; padding-bottom: 4px; }
    .inv-classic .inv-party-name { font-weight: 700; }
    .inv-classic .inv-party-detail { font-size: 0.85rem; color: #555; line-height: 1.6; }
    .inv-classic .inv-meta { display: flex; gap: 24px; margin-bottom: 24px; padding: 12px; background: #f5f5f5; }
    .inv-classic .inv-meta-item { }
    .inv-classic .inv-meta-label { font-size: 0.8rem; font-weight: 700; }
    .inv-classic .inv-meta-value { font-size: 0.9rem; }
    .inv-classic table { width: 100%; border-collapse: collapse; margin-bottom: 24px; border: 1px solid #333; }
    .inv-classic thead th { background: #333; color: white; padding: 10px 12px; text-align: left; font-size: 0.85rem; }
    .inv-classic thead th:last-child { text-align: right; }
    .inv-classic tbody td { padding: 10px 12px; border-bottom: 1px solid #ddd; }
    .inv-classic .text-right { text-align: right; }
    .inv-classic .inv-totals { display: flex; justify-content: flex-end; }
    .inv-classic .inv-totals-box { width: 280px; border: 1px solid #333; padding: 12px; }
    .inv-classic .inv-total-row { display: flex; justify-content: space-between; padding: 4px 0; }
    .inv-classic .inv-total-row.grand { font-weight: 700; font-size: 1.1rem; border-top: 2px solid #333; padding-top: 8px; margin-top: 4px; }
    .inv-classic .inv-notes { margin-top: 30px; padding-top: 16px; border-top: 1px solid #ccc; }
    .inv-classic .inv-notes-title { font-weight: 700; font-size: 0.85rem; margin-bottom: 4px; }
    .inv-classic .inv-notes-text { font-size: 0.85rem; color: #555; }

    /* Minimal template */
    .inv-minimal { padding: 40px; }
    .inv-minimal .inv-header { margin-bottom: 40px; }
    .inv-minimal .inv-logo { max-height: 40px; margin-bottom: 16px; }
    .inv-minimal .inv-title { font-size: 1rem; font-weight: 400; letter-spacing: 6px; text-transform: uppercase; color: #999; }
    .inv-minimal .inv-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px; }
    .inv-minimal .inv-party-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: #bbb; margin-bottom: 8px; }
    .inv-minimal .inv-party-name { font-weight: 600; font-size: 1rem; }
    .inv-minimal .inv-party-detail { font-size: 0.85rem; color: #888; line-height: 1.8; }
    .inv-minimal .inv-meta { display: flex; gap: 40px; margin-bottom: 30px; }
    .inv-minimal .inv-meta-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: #bbb; }
    .inv-minimal .inv-meta-value { font-size: 0.9rem; font-weight: 500; margin-top: 2px; }
    .inv-minimal table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
    .inv-minimal thead th { padding: 12px 0; text-align: left; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: #bbb; border-bottom: 1px solid #eee; }
    .inv-minimal thead th:last-child { text-align: right; }
    .inv-minimal tbody td { padding: 14px 0; border-bottom: 1px solid #f5f5f5; font-size: 0.9rem; }
    .inv-minimal .text-right { text-align: right; }
    .inv-minimal .inv-totals { display: flex; justify-content: flex-end; }
    .inv-minimal .inv-totals-box { width: 240px; }
    .inv-minimal .inv-total-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.9rem; color: #666; }
    .inv-minimal .inv-total-row.grand { color: #000; font-weight: 700; font-size: 1.15rem; border-top: 1px solid #333; padding-top: 12px; margin-top: 8px; }
    .inv-minimal .inv-notes { margin-top: 40px; }
    .inv-minimal .inv-notes-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: #bbb; margin-bottom: 6px; }
    .inv-minimal .inv-notes-text { font-size: 0.85rem; color: #888; }

    .inv-number { margin-top: 4px; }

    .currency-selector { display: flex; gap: 8px; flex-wrap: wrap; }
    .currency-btn {
      padding: 8px 16px; border: 1.5px solid var(--border); border-radius: 8px;
      background: white; cursor: pointer; font-size: 0.85rem; font-weight: 500;
      transition: all 0.2s;
    }
    .currency-btn.selected { border-color: var(--primary); background: #f0f0ff; color: var(--primary); }
    
    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      .template-cards { grid-template-columns: 1fr; }
      .inv-modern .inv-parties, .inv-classic .inv-parties, .inv-minimal .inv-parties { grid-template-columns: 1fr; }
      .inv-modern .inv-meta { grid-template-columns: 1fr; }
      .inv-classic .inv-meta, .inv-minimal .inv-meta { flex-direction: column; }
      .container { padding: 12px; }
      .card { padding: 16px; }
    }
    @media print {
      .header, .tabs, .section:not(#preview-section) { display: none !important; }
      #preview-section { display: block !important; }
      .card { box-shadow: none; padding: 0; }
      .btn-group { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="header" style="position:relative;">
    <a href="/tools/" class="back-link">â† ë„êµ¬ ëª©ë¡</a>
    <h1>ğŸ“„ ì¸ë³´ì´ìŠ¤ ìƒì„±ê¸°</h1>
    <p>Invoice Generator â€” ì „ë¬¸ì ì¸ ì¸ë³´ì´ìŠ¤ë¥¼ ì‰½ê²Œ ë§Œë“¤ê³  PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”</p>
  </div>

  <div class="container">
    <div class="tabs">
      <button class="tab active" onclick="showSection('sender')">ğŸ‘¤ ë°œì‹ ì</button>
      <button class="tab" onclick="showSection('receiver')">ğŸ¢ ìˆ˜ì‹ ì</button>
      <button class="tab" onclick="showSection('items')">ğŸ“‹ í•­ëª©</button>
      <button class="tab" onclick="showSection('settings')">âš™ï¸ ì„¤ì •</button>
      <button class="tab" onclick="showSection('preview')">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
    </div>

    <!-- Sender Section -->
    <div id="sender-section" class="section active">
      <div class="card">
        <h3>ğŸ‘¤ ë°œì‹ ì ì •ë³´ (From)</h3>
        <div style="display:flex;gap:24px;flex-wrap:wrap;">
          <div>
            <label style="font-size:0.85rem;font-weight:600;color:var(--text-light);display:block;margin-bottom:6px;">ë¡œê³ </label>
            <div class="logo-upload" onclick="document.getElementById('logoInput').click()">
              <div class="placeholder" id="logoPlaceholder"><span>ğŸ“·</span>ë¡œê³  ì—…ë¡œë“œ</div>
              <img id="logoPreview" style="display:none;">
            </div>
            <input type="file" id="logoInput" accept="image/*" style="display:none;" onchange="handleLogo(event)">
          </div>
          <div style="flex:1;min-width:250px;">
            <div class="form-grid">
              <div class="form-group full">
                <label>íšŒì‚¬ëª… / ì´ë¦„ *</label>
                <input type="text" id="senderName" placeholder="EastSea Corp" oninput="saveSender()">
              </div>
              <div class="form-group full">
                <label>ì£¼ì†Œ</label>
                <textarea id="senderAddress" rows="2" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬..." oninput="saveSender()"></textarea>
              </div>
              <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="senderEmail" placeholder="hello@example.com" oninput="saveSender()">
              </div>
              <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="senderPhone" placeholder="010-1234-5678" oninput="saveSender()">
              </div>
              <div class="form-group">
                <label>ì‚¬ì—…ìë²ˆí˜¸</label>
                <input type="text" id="senderBizNum" placeholder="123-45-67890" oninput="saveSender()">
              </div>
              <div class="form-group">
                <label>ì›¹ì‚¬ì´íŠ¸</label>
                <input type="text" id="senderWebsite" placeholder="https://example.com" oninput="saveSender()">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-group" style="justify-content:flex-end;">
        <button class="btn btn-primary" onclick="showSection('receiver')">ë‹¤ìŒ: ìˆ˜ì‹ ì â†’</button>
      </div>
    </div>

    <!-- Receiver Section -->
    <div id="receiver-section" class="section">
      <div class="card">
        <h3>ğŸ¢ ìˆ˜ì‹ ì ì •ë³´ (Bill To)</h3>
        <div class="form-grid">
          <div class="form-group full">
            <label>íšŒì‚¬ëª… / ì´ë¦„ *</label>
            <input type="text" id="receiverName" placeholder="Client Company Inc.">
          </div>
          <div class="form-group full">
            <label>ì£¼ì†Œ</label>
            <textarea id="receiverAddress" rows="2" placeholder="ìˆ˜ì‹ ì ì£¼ì†Œ..."></textarea>
          </div>
          <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="receiverEmail" placeholder="client@example.com">
          </div>
          <div class="form-group">
            <label>ì „í™”ë²ˆí˜¸</label>
            <input type="tel" id="receiverPhone" placeholder="02-1234-5678">
          </div>
        </div>
      </div>
      <div class="btn-group" style="justify-content:space-between;">
        <button class="btn btn-outline" onclick="showSection('sender')">â† ì´ì „</button>
        <button class="btn btn-primary" onclick="showSection('items')">ë‹¤ìŒ: í•­ëª© â†’</button>
      </div>
    </div>

    <!-- Items Section -->
    <div id="items-section" class="section">
      <div class="card">
        <h3>ğŸ“‹ ì¸ë³´ì´ìŠ¤ í•­ëª©</h3>
        <div style="overflow-x:auto;">
          <table class="items-table">
            <thead>
              <tr>
                <th style="width:40%;">í•­ëª© ì„¤ëª…</th>
                <th style="width:15%;">ìˆ˜ëŸ‰</th>
                <th style="width:20%;">ë‹¨ê°€</th>
                <th style="width:20%;">ê¸ˆì•¡</th>
                <th style="width:5%;"></th>
              </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
          </table>
        </div>
        <div class="btn-group">
          <button class="btn btn-outline btn-sm" onclick="addItem()">+ í•­ëª© ì¶”ê°€</button>
        </div>
        
        <div style="margin-top:24px;display:flex;justify-content:flex-end;">
          <div style="width:300px;">
            <div class="summary-row"><span>ì†Œê³„</span><span id="subtotalDisplay">0</span></div>
            <div class="summary-row">
              <span>ì„¸ê¸ˆ (<input type="number" id="taxRate" value="10" min="0" max="100" style="width:50px;padding:2px 6px;border:1px solid var(--border);border-radius:4px;text-align:center;" oninput="updateTotals()">%)</span>
              <span id="taxDisplay">0</span>
            </div>
            <div class="summary-row">
              <span>í• ì¸ (<input type="number" id="discountRate" value="0" min="0" max="100" style="width:50px;padding:2px 6px;border:1px solid var(--border);border-radius:4px;text-align:center;" oninput="updateTotals()">%)</span>
              <span id="discountDisplay">0</span>
            </div>
            <div class="summary-row total"><span>í•©ê³„</span><span id="totalDisplay">0</span></div>
          </div>
        </div>
      </div>
      <div class="btn-group" style="justify-content:space-between;">
        <button class="btn btn-outline" onclick="showSection('receiver')">â† ì´ì „</button>
        <button class="btn btn-primary" onclick="showSection('settings')">ë‹¤ìŒ: ì„¤ì • â†’</button>
      </div>
    </div>

    <!-- Settings Section -->
    <div id="settings-section" class="section">
      <div class="card">
        <h3>âš™ï¸ ì¸ë³´ì´ìŠ¤ ì„¤ì •</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>ì¸ë³´ì´ìŠ¤ ë²ˆí˜¸</label>
            <input type="text" id="invoiceNumber" placeholder="INV-001">
          </div>
          <div class="form-group">
            <label>ë°œí–‰ì¼</label>
            <input type="date" id="invoiceDate">
          </div>
          <div class="form-group">
            <label>ê²°ì œ ê¸°í•œ</label>
            <input type="date" id="dueDate">
          </div>
          <div class="form-group">
            <label>ê²°ì œ ë°©ë²•</label>
            <select id="paymentMethod">
              <option value="bank">ì€í–‰ ì´ì²´</option>
              <option value="card">ì¹´ë“œ ê²°ì œ</option>
              <option value="paypal">PayPal</option>
              <option value="crypto">ì•”í˜¸í™”í</option>
              <option value="other">ê¸°íƒ€</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ’° í†µí™”</h3>
        <div class="currency-selector">
          <button class="currency-btn selected" onclick="selectCurrency(this, 'KRW', 'â‚©')">ğŸ‡°ğŸ‡· KRW (â‚©)</button>
          <button class="currency-btn" onclick="selectCurrency(this, 'USD', '$')">ğŸ‡ºğŸ‡¸ USD ($)</button>
          <button class="currency-btn" onclick="selectCurrency(this, 'EUR', 'â‚¬')">ğŸ‡ªğŸ‡º EUR (â‚¬)</button>
          <button class="currency-btn" onclick="selectCurrency(this, 'JPY', 'Â¥')">ğŸ‡¯ğŸ‡µ JPY (Â¥)</button>
          <button class="currency-btn" onclick="selectCurrency(this, 'GBP', 'Â£')">ğŸ‡¬ğŸ‡§ GBP (Â£)</button>
          <button class="currency-btn" onclick="selectCurrency(this, 'CNY', 'Â¥')">ğŸ‡¨ğŸ‡³ CNY (Â¥)</button>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ¨ í…œí”Œë¦¿</h3>
        <div class="template-cards">
          <div class="template-card selected" onclick="selectTemplate('modern')">
            <div class="icon">âœ¨</div>
            <div class="name">ëª¨ë˜</div>
            <div class="desc">ê¹”ë”í•˜ê³  ì„¸ë ¨ëœ ë””ìì¸</div>
          </div>
          <div class="template-card" onclick="selectTemplate('classic')">
            <div class="icon">ğŸ“œ</div>
            <div class="name">í´ë˜ì‹</div>
            <div class="desc">ì „í†µì ì´ê³  ê²©ì‹ ìˆëŠ” ë””ìì¸</div>
          </div>
          <div class="template-card" onclick="selectTemplate('minimal')">
            <div class="icon">ğŸª¶</div>
            <div class="name">ë¯¸ë‹ˆë©€</div>
            <div class="desc">ì‹¬í”Œí•˜ê³  ì—¬ë°±ì´ ë„‰ë„‰í•œ ë””ìì¸</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>ğŸ“ ë©”ëª¨ / ë¹„ê³ </h3>
        <textarea id="invoiceNotes" rows="3" style="width:100%;padding:10px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:0.9rem;font-family:inherit;resize:vertical;" placeholder="ê²°ì œ ì•ˆë‚´, ê°ì‚¬ ì¸ì‚¬ ë“±..."></textarea>
      </div>

      <div class="btn-group" style="justify-content:space-between;">
        <button class="btn btn-outline" onclick="showSection('items')">â† ì´ì „</button>
        <button class="btn btn-primary" onclick="generatePreview()">ë¯¸ë¦¬ë³´ê¸° ìƒì„± â†’</button>
      </div>
    </div>

    <!-- Preview Section -->
    <div id="preview-section" class="section">
      <div class="btn-group" style="margin-bottom:16px;justify-content:space-between;">
        <button class="btn btn-outline" onclick="showSection('settings')">â† ìˆ˜ì •í•˜ê¸°</button>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-primary" onclick="downloadPDF()">ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn btn-success" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
        </div>
      </div>
      <div class="preview-container" id="invoicePreview"></div>
    </div>
  </div>

  <script>
    let state = {
      currency: 'KRW',
      symbol: 'â‚©',
      template: 'modern',
      logo: null,
      items: [{ desc: '', qty: 1, price: 0 }]
    };

    // Init
    function init() {
      loadSender();
      const today = new Date();
      document.getElementById('invoiceDate').value = today.toISOString().split('T')[0];
      const due = new Date(today);
      due.setDate(due.getDate() + 30);
      document.getElementById('dueDate').value = due.toISOString().split('T')[0];
      document.getElementById('invoiceNumber').value = 'INV-' + String(Math.floor(Math.random() * 9000) + 1000);
      renderItems();
    }

    function showSection(name) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(name + '-section').classList.add('active');
      const tabs = ['sender','receiver','items','settings','preview'];
      const idx = tabs.indexOf(name);
      if (idx >= 0) document.querySelectorAll('.tab')[idx].classList.add('active');
      if (name === 'preview') generatePreview();
    }

    // Logo
    function handleLogo(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        state.logo = ev.target.result;
        document.getElementById('logoPreview').src = ev.target.result;
        document.getElementById('logoPreview').style.display = 'block';
        document.getElementById('logoPlaceholder').style.display = 'none';
      };
      reader.readAsDataURL(file);
    }

    // Sender save/load
    function saveSender() {
      const data = {
        name: document.getElementById('senderName').value,
        address: document.getElementById('senderAddress').value,
        email: document.getElementById('senderEmail').value,
        phone: document.getElementById('senderPhone').value,
        bizNum: document.getElementById('senderBizNum').value,
        website: document.getElementById('senderWebsite').value,
      };
      localStorage.setItem('invoice_sender', JSON.stringify(data));
    }
    function loadSender() {
      const data = JSON.parse(localStorage.getItem('invoice_sender') || 'null');
      if (!data) return;
      document.getElementById('senderName').value = data.name || '';
      document.getElementById('senderAddress').value = data.address || '';
      document.getElementById('senderEmail').value = data.email || '';
      document.getElementById('senderPhone').value = data.phone || '';
      document.getElementById('senderBizNum').value = data.bizNum || '';
      document.getElementById('senderWebsite').value = data.website || '';
    }

    // Currency
    function selectCurrency(btn, code, symbol) {
      document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      state.currency = code;
      state.symbol = symbol;
      updateTotals();
    }

    // Template
    function selectTemplate(tpl) {
      state.template = tpl;
      document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
    }

    // Items
    function addItem() {
      state.items.push({ desc: '', qty: 1, price: 0 });
      renderItems();
    }
    function removeItem(i) {
      if (state.items.length <= 1) return;
      state.items.splice(i, 1);
      renderItems();
    }
    function renderItems() {
      const body = document.getElementById('itemsBody');
      body.innerHTML = state.items.map((item, i) => `
        <tr>
          <td><input type="text" value="${escHtml(item.desc)}" placeholder="ì„œë¹„ìŠ¤/ì œí’ˆëª…" oninput="state.items[${i}].desc=this.value"></td>
          <td><input type="number" class="num-input" value="${item.qty}" min="1" oninput="state.items[${i}].qty=+this.value;updateTotals()"></td>
          <td><input type="number" class="num-input" value="${item.price}" min="0" oninput="state.items[${i}].price=+this.value;updateTotals()"></td>
          <td style="text-align:right;font-weight:600;">${formatMoney(item.qty * item.price)}</td>
          <td><button class="btn btn-danger btn-sm" onclick="removeItem(${i})" style="padding:4px 8px;">&times;</button></td>
        </tr>
      `).join('');
      updateTotals();
    }
    function updateTotals() {
      const subtotal = state.items.reduce((s, it) => s + it.qty * it.price, 0);
      const taxRate = +document.getElementById('taxRate').value || 0;
      const discountRate = +document.getElementById('discountRate').value || 0;
      const tax = subtotal * taxRate / 100;
      const discount = subtotal * discountRate / 100;
      const total = subtotal + tax - discount;
      document.getElementById('subtotalDisplay').textContent = formatMoney(subtotal);
      document.getElementById('taxDisplay').textContent = formatMoney(tax);
      document.getElementById('discountDisplay').textContent = '-' + formatMoney(discount);
      document.getElementById('totalDisplay').textContent = formatMoney(total);
    }
    function formatMoney(n) {
      const opts = { minimumFractionDigits: state.currency === 'KRW' || state.currency === 'JPY' ? 0 : 2, maximumFractionDigits: state.currency === 'KRW' || state.currency === 'JPY' ? 0 : 2 };
      return state.symbol + n.toLocaleString(undefined, opts);
    }
    function escHtml(s) { return (s||'').replace(/"/g, '&quot;').replace(/</g, '&lt;'); }

    // Preview
    function generatePreview() {
      const d = getData();
      const tpl = state.template;
      const cls = `inv-${tpl}`;
      let logoHtml = d.logo ? `<img class="inv-logo" src="${d.logo}" alt="Logo">` : '';
      
      let html = `<div class="${cls}">`;
      
      if (tpl === 'modern') {
        html += `
          <div class="inv-header">
            <div>${logoHtml}<div class="inv-party-name" style="font-size:1.2rem;margin-top:8px;">${esc(d.sender.name)}</div></div>
            <div><div class="inv-title">INVOICE</div><div class="inv-number">#${esc(d.number)}</div></div>
          </div>
          <div class="inv-meta">
            <div class="inv-meta-item"><div class="inv-meta-label">ë°œí–‰ì¼</div><div class="inv-meta-value">${d.date}</div></div>
            <div class="inv-meta-item"><div class="inv-meta-label">ê²°ì œ ê¸°í•œ</div><div class="inv-meta-value">${d.dueDate}</div></div>
            <div class="inv-meta-item"><div class="inv-meta-label">ê²°ì œ ë°©ë²•</div><div class="inv-meta-value">${d.paymentLabel}</div></div>
          </div>`;
      } else if (tpl === 'classic') {
        html += `
          <div class="inv-header">${logoHtml}<div class="inv-title">INVOICE</div><div style="color:#666;margin-top:4px;">#${esc(d.number)}</div></div>
          <div class="inv-meta">
            <div class="inv-meta-item"><span class="inv-meta-label">ë°œí–‰ì¼:</span> <span class="inv-meta-value">${d.date}</span></div>
            <div class="inv-meta-item"><span class="inv-meta-label">ê¸°í•œ:</span> <span class="inv-meta-value">${d.dueDate}</span></div>
            <div class="inv-meta-item"><span class="inv-meta-label">ê²°ì œ:</span> <span class="inv-meta-value">${d.paymentLabel}</span></div>
          </div>`;
      } else {
        html += `
          <div class="inv-header">${logoHtml}<div class="inv-title">INVOICE</div></div>
          <div class="inv-meta">
            <div><div class="inv-meta-label">ë²ˆí˜¸</div><div class="inv-meta-value">${esc(d.number)}</div></div>
            <div><div class="inv-meta-label">ë°œí–‰ì¼</div><div class="inv-meta-value">${d.date}</div></div>
            <div><div class="inv-meta-label">ê¸°í•œ</div><div class="inv-meta-value">${d.dueDate}</div></div>
          </div>`;
      }

      html += `
        <div class="inv-parties">
          <div>
            <div class="inv-party-label">From</div>
            <div class="inv-party-name">${esc(d.sender.name)}</div>
            <div class="inv-party-detail">${esc(d.sender.address).replace(/\n/g,'<br>')}${d.sender.email ? '<br>'+esc(d.sender.email) : ''}${d.sender.phone ? '<br>'+esc(d.sender.phone) : ''}${d.sender.bizNum ? '<br>ì‚¬ì—…ìë²ˆí˜¸: '+esc(d.sender.bizNum) : ''}</div>
          </div>
          <div>
            <div class="inv-party-label">Bill To</div>
            <div class="inv-party-name">${esc(d.receiver.name)}</div>
            <div class="inv-party-detail">${esc(d.receiver.address).replace(/\n/g,'<br>')}${d.receiver.email ? '<br>'+esc(d.receiver.email) : ''}${d.receiver.phone ? '<br>'+esc(d.receiver.phone) : ''}</div>
          </div>
        </div>
        <table>
          <thead><tr><th>í•­ëª©</th><th>ìˆ˜ëŸ‰</th><th>ë‹¨ê°€</th><th style="text-align:right;">ê¸ˆì•¡</th></tr></thead>
          <tbody>
            ${d.items.map(it => `<tr><td>${esc(it.desc) || '-'}</td><td>${it.qty}</td><td>${formatMoney(it.price)}</td><td class="text-right">${formatMoney(it.qty*it.price)}</td></tr>`).join('')}
          </tbody>
        </table>
        <div class="inv-totals"><div class="inv-totals-box">
          <div class="inv-total-row"><span>ì†Œê³„</span><span>${formatMoney(d.subtotal)}</span></div>
          ${d.taxRate > 0 ? `<div class="inv-total-row"><span>ì„¸ê¸ˆ (${d.taxRate}%)</span><span>${formatMoney(d.tax)}</span></div>` : ''}
          ${d.discountRate > 0 ? `<div class="inv-total-row"><span>í• ì¸ (${d.discountRate}%)</span><span>-${formatMoney(d.discount)}</span></div>` : ''}
          <div class="inv-total-row grand"><span>í•©ê³„</span><span>${formatMoney(d.total)}</span></div>
        </div></div>
        ${d.notes ? `<div class="inv-notes"><div class="inv-notes-title">ë¹„ê³ </div><div class="inv-notes-text">${esc(d.notes).replace(/\n/g,'<br>')}</div></div>` : ''}
      </div>`;

      document.getElementById('invoicePreview').innerHTML = html;
    }

    function getData() {
      const subtotal = state.items.reduce((s, it) => s + it.qty * it.price, 0);
      const taxRate = +document.getElementById('taxRate').value || 0;
      const discountRate = +document.getElementById('discountRate').value || 0;
      const payMethods = { bank: 'ì€í–‰ ì´ì²´', card: 'ì¹´ë“œ ê²°ì œ', paypal: 'PayPal', crypto: 'ì•”í˜¸í™”í', other: 'ê¸°íƒ€' };
      return {
        sender: {
          name: document.getElementById('senderName').value || 'Your Company',
          address: document.getElementById('senderAddress').value,
          email: document.getElementById('senderEmail').value,
          phone: document.getElementById('senderPhone').value,
          bizNum: document.getElementById('senderBizNum').value,
        },
        receiver: {
          name: document.getElementById('receiverName').value || 'Client',
          address: document.getElementById('receiverAddress').value,
          email: document.getElementById('receiverEmail').value,
          phone: document.getElementById('receiverPhone').value,
        },
        items: state.items,
        number: document.getElementById('invoiceNumber').value,
        date: document.getElementById('invoiceDate').value,
        dueDate: document.getElementById('dueDate').value,
        paymentLabel: payMethods[document.getElementById('paymentMethod').value],
        notes: document.getElementById('invoiceNotes').value,
        logo: state.logo,
        subtotal, taxRate, discountRate,
        tax: subtotal * taxRate / 100,
        discount: subtotal * discountRate / 100,
        total: subtotal + subtotal * taxRate / 100 - subtotal * discountRate / 100,
      };
    }
    function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // PDF Generation
    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const d = getData();
      const pw = 210, ph = 297, m = 20;
      let y = m;

      // Colors based on template
      const colors = {
        modern: { primary: [99,102,241], accent: [139,92,246] },
        classic: { primary: [51,51,51], accent: [51,51,51] },
        minimal: { primary: [100,100,100], accent: [180,180,180] }
      }[state.template];

      // Logo
      if (d.logo) {
        try { doc.addImage(d.logo, 'PNG', m, y, 30, 30); } catch(e) {}
      }

      // Title
      doc.setFontSize(24);
      doc.setTextColor(...colors.primary);
      doc.text('INVOICE', pw - m, y + 10, { align: 'right' });
      doc.setFontSize(10);
      doc.setTextColor(150,150,150);
      doc.text('#' + d.number, pw - m, y + 18, { align: 'right' });
      
      y += 35;

      // Sender name
      doc.setFontSize(12);
      doc.setTextColor(30,30,30);
      doc.text(d.sender.name, m, y);
      y += 10;

      // Meta
      doc.setFillColor(248,250,252);
      doc.roundedRect(m, y, pw - 2*m, 12, 2, 2, 'F');
      doc.setFontSize(8);
      doc.setTextColor(100,116,139);
      const metaY = y + 5;
      doc.text('ë°œí–‰ì¼: ' + d.date, m + 5, metaY);
      doc.text('ê¸°í•œ: ' + d.dueDate, m + 60, metaY);
      doc.text('ê²°ì œ: ' + d.paymentLabel, m + 115, metaY);
      y += 20;

      // Parties
      doc.setFontSize(7);
      doc.setTextColor(...colors.primary);
      doc.text('FROM', m, y);
      doc.text('BILL TO', m + 90, y);
      y += 5;
      doc.setFontSize(11);
      doc.setTextColor(30,30,30);
      doc.text(d.sender.name, m, y);
      doc.text(d.receiver.name, m + 90, y);
      y += 5;
      doc.setFontSize(8);
      doc.setTextColor(100,116,139);
      const sLines = [d.sender.address, d.sender.email, d.sender.phone, d.sender.bizNum ? 'ì‚¬ì—…ìë²ˆí˜¸: '+d.sender.bizNum : ''].filter(Boolean);
      const rLines = [d.receiver.address, d.receiver.email, d.receiver.phone].filter(Boolean);
      sLines.forEach((l,i) => doc.text(l, m, y + i*4.5));
      rLines.forEach((l,i) => doc.text(l, m + 90, y + i*4.5));
      y += Math.max(sLines.length, rLines.length) * 4.5 + 10;

      // Table header
      doc.setFillColor(...colors.primary);
      doc.roundedRect(m, y, pw - 2*m, 8, 1, 1, 'F');
      doc.setFontSize(7);
      doc.setTextColor(255,255,255);
      doc.text('í•­ëª©', m + 3, y + 5.5);
      doc.text('ìˆ˜ëŸ‰', m + 95, y + 5.5);
      doc.text('ë‹¨ê°€', m + 120, y + 5.5);
      doc.text('ê¸ˆì•¡', pw - m - 3, y + 5.5, { align: 'right' });
      y += 10;

      // Table rows
      doc.setTextColor(30,30,30);
      doc.setFontSize(9);
      d.items.forEach((it) => {
        if (y > ph - 60) { doc.addPage(); y = m; }
        doc.text(it.desc || '-', m + 3, y + 4);
        doc.text(String(it.qty), m + 95, y + 4);
        doc.text(formatMoney(it.price), m + 120, y + 4);
        doc.text(formatMoney(it.qty * it.price), pw - m - 3, y + 4, { align: 'right' });
        doc.setDrawColor(241,245,249);
        doc.line(m, y + 7, pw - m, y + 7);
        y += 9;
      });

      y += 5;

      // Totals
      const tx = pw - m - 60;
      doc.setFontSize(9);
      doc.setTextColor(100,116,139);
      doc.text('ì†Œê³„', tx, y); doc.text(formatMoney(d.subtotal), pw - m, y, { align: 'right' }); y += 6;
      if (d.taxRate > 0) { doc.text(`ì„¸ê¸ˆ (${d.taxRate}%)`, tx, y); doc.text(formatMoney(d.tax), pw - m, y, { align: 'right' }); y += 6; }
      if (d.discountRate > 0) { doc.text(`í• ì¸ (${d.discountRate}%)`, tx, y); doc.text('-' + formatMoney(d.discount), pw - m, y, { align: 'right' }); y += 6; }
      
      doc.setDrawColor(...colors.primary);
      doc.setLineWidth(0.5);
      doc.line(tx, y, pw - m, y);
      y += 6;
      doc.setFontSize(13);
      doc.setTextColor(...colors.primary);
      doc.text('í•©ê³„', tx, y);
      doc.text(formatMoney(d.total), pw - m, y, { align: 'right' });
      y += 12;

      // Notes
      if (d.notes) {
        if (y > ph - 40) { doc.addPage(); y = m; }
        doc.setFillColor(248,250,252);
        const noteLines = doc.splitTextToSize(d.notes, pw - 2*m - 14);
        const noteH = noteLines.length * 4.5 + 14;
        doc.roundedRect(m, y, pw - 2*m, noteH, 2, 2, 'F');
        doc.setDrawColor(...colors.primary);
        doc.setLineWidth(1);
        doc.line(m, y, m, y + noteH);
        doc.setFontSize(7);
        doc.setTextColor(100,116,139);
        doc.text('ë¹„ê³ ', m + 6, y + 6);
        doc.setFontSize(8);
        doc.text(noteLines, m + 6, y + 12);
      }

      doc.save(`${d.number || 'invoice'}.pdf`);
    }

    init();
  </script>
</body>
</html>