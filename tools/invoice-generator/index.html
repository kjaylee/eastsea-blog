<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ë³´ì´ìŠ¤ ìƒì„±ê¸° - Invoice Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #ffffff;
      --surface: #f5f5f5;
      --text: #1a1a1a;
      --text-muted: #666666;
      --primary: #3b82f6;
      --border: #e0e0e0;
      --shadow: rgba(0, 0, 0, 0.1);
      --danger: #ef4444;
    }

    [data-theme="dark"] {
      --bg: #1a1a1a;
      --surface: #2a2a2a;
      --text: #e0e0e0;
      --text-muted: #a0a0a0;
      --primary: #3b82f6;
      --border: #3a3a3a;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      transition: all 0.3s;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
    }

    button.secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    button.danger {
      background: var(--danger);
    }

    .theme-toggle {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
    }

    .invoice-container {
      background: var(--surface);
      padding: 40px;
      border-radius: 12px;
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }

    .invoice-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .invoice-title {
      font-size: 36px;
      font-weight: 700;
      color: var(--primary);
    }

    .invoice-number {
      text-align: right;
    }

    .invoice-number label {
      display: block;
      color: var(--text-muted);
      font-size: 14px;
      margin-bottom: 5px;
    }

    .invoice-number input {
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
      width: 200px;
    }

    .parties {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .party {
      padding: 20px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .party h3 {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .party input,
    .party textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface);
      color: var(--text);
      margin-bottom: 10px;
      font-family: inherit;
      font-size: 14px;
    }

    .party textarea {
      resize: vertical;
      min-height: 80px;
    }

    .items-section {
      margin-bottom: 30px;
    }

    .items-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .items-header h3 {
      font-size: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    thead {
      background: var(--bg);
    }

    th {
      text-align: left;
      padding: 12px;
      font-weight: 600;
      color: var(--text-muted);
      font-size: 14px;
      border-bottom: 2px solid var(--border);
    }

    th:last-child,
    td:last-child {
      text-align: right;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
    }

    td input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--border);
      border-radius: 4px;
      background: var(--surface);
      color: var(--text);
      font-size: 14px;
    }

    td input[type="number"] {
      text-align: right;
    }

    .delete-btn {
      background: transparent;
      color: var(--danger);
      padding: 4px 8px;
      font-size: 18px;
    }

    .totals {
      display: flex;
      justify-content: flex-end;
      margin-top: 30px;
    }

    .totals-table {
      width: 300px;
    }

    .totals-table tr {
      border: none;
    }

    .totals-table td {
      padding: 8px 12px;
      border: none;
    }

    .totals-table .total-row {
      font-size: 20px;
      font-weight: 700;
      border-top: 2px solid var(--border);
    }

    .currency-select {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .currency-select select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
      font-size: 14px;
    }

    .saved-invoices {
      margin-top: 40px;
    }

    .saved-invoice-item {
      background: var(--surface);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .saved-invoice-info {
      flex: 1;
    }

    .saved-invoice-number {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .saved-invoice-date {
      color: var(--text-muted);
      font-size: 12px;
    }

    .saved-invoice-actions {
      display: flex;
      gap: 8px;
    }

    .saved-invoice-actions button {
      padding: 6px 12px;
      font-size: 12px;
    }

    @media print {
      body {
        background: white;
        padding: 0;
      }

      .container {
        max-width: 100%;
      }

      header,
      .header-actions,
      .saved-invoices,
      button {
        display: none !important;
      }

      .invoice-container {
        box-shadow: none;
        border: none;
        padding: 20px;
      }

      input,
      textarea,
      select {
        border: none !important;
        background: transparent !important;
        padding: 0 !important;
      }
    }

    @media (max-width: 768px) {
      .parties {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 12px;
      }

      th,
      td {
        padding: 8px 4px;
      }

      .totals-table {
        width: 100%;
      }

      .invoice-header {
        flex-direction: column;
      }

      .invoice-number {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“„ ì¸ë³´ì´ìŠ¤ ìƒì„±ê¸°</h1>
      <div class="header-actions">
        <button onclick="saveInvoice()">ğŸ’¾ ì €ì¥</button>
        <button onclick="loadInvoices()" class="secondary">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button onclick="resetInvoice()" class="secondary">ğŸ”„ ìƒˆë¡œ ë§Œë“¤ê¸°</button>
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
      </div>
    </header>

    <div class="invoice-container">
      <div class="invoice-header">
        <div class="invoice-title">INVOICE</div>
        <div class="invoice-number">
          <label>Invoice Number</label>
          <input type="text" id="invoiceNumber" value="">
        </div>
      </div>

      <div class="currency-select">
        <label>í†µí™”:</label>
        <select id="currency" onchange="updateTotals()">
          <option value="USD">USD ($)</option>
          <option value="EUR">EUR (â‚¬)</option>
          <option value="KRW" selected>KRW (â‚©)</option>
          <option value="JPY">JPY (Â¥)</option>
        </select>
      </div>

      <div class="parties">
        <div class="party">
          <h3>ë°œí–‰ì (From)</h3>
          <input type="text" id="fromName" placeholder="íšŒì‚¬ëª…/ì´ë¦„">
          <textarea id="fromAddress" placeholder="ì£¼ì†Œ&#10;ì´ë©”ì¼&#10;ì „í™”ë²ˆí˜¸"></textarea>
        </div>
        <div class="party">
          <h3>ìˆ˜ì‹ ì (To)</h3>
          <input type="text" id="toName" placeholder="íšŒì‚¬ëª…/ì´ë¦„">
          <textarea id="toAddress" placeholder="ì£¼ì†Œ&#10;ì´ë©”ì¼&#10;ì „í™”ë²ˆí˜¸"></textarea>
        </div>
      </div>

      <div class="items-section">
        <div class="items-header">
          <h3>í•­ëª©</h3>
          <button onclick="addItem()">â• í•­ëª© ì¶”ê°€</button>
        </div>
        
        <table id="itemsTable">
          <thead>
            <tr>
              <th style="width: 40%">í’ˆëª…</th>
              <th style="width: 15%">ìˆ˜ëŸ‰</th>
              <th style="width: 20%">ë‹¨ê°€</th>
              <th style="width: 20%">ê¸ˆì•¡</th>
              <th style="width: 5%"></th>
            </tr>
          </thead>
          <tbody id="itemsBody">
          </tbody>
        </table>
      </div>

      <div class="totals">
        <table class="totals-table">
          <tr>
            <td>ì†Œê³„</td>
            <td id="subtotal">0</td>
          </tr>
          <tr>
            <td>ì„¸ê¸ˆ (10%)</td>
            <td id="tax">0</td>
          </tr>
          <tr class="total-row">
            <td>í•©ê³„</td>
            <td id="total">0</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="saved-invoices" id="savedInvoices" style="display: none;">
      <h2>ì €ì¥ëœ ì¸ë³´ì´ìŠ¤</h2>
      <div id="savedInvoicesList"></div>
    </div>
  </div>

  <script>
    const CURRENCIES = {
      USD: { symbol: '$', format: (n) => '$' + n.toFixed(2) },
      EUR: { symbol: 'â‚¬', format: (n) => 'â‚¬' + n.toFixed(2) },
      KRW: { symbol: 'â‚©', format: (n) => 'â‚©' + n.toLocaleString('ko-KR') },
      JPY: { symbol: 'Â¥', format: (n) => 'Â¥' + Math.round(n).toLocaleString('ja-JP') }
    };

    function init() {
      loadTheme();
      generateInvoiceNumber();
      addItem();
      addItem();
    }

    function loadTheme() {
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
      updateThemeIcon();
    }

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeIcon();
    }

    function updateThemeIcon() {
      const theme = document.documentElement.getAttribute('data-theme');
      document.querySelector('.theme-toggle').textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
    }

    function generateInvoiceNumber() {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      document.getElementById('invoiceNumber').value = `INV-${year}${month}-${random}`;
    }

    function addItem() {
      const tbody = document.getElementById('itemsBody');
      const row = tbody.insertRow();
      row.innerHTML = `
        <td><input type="text" placeholder="í’ˆëª…" oninput="updateTotals()"></td>
        <td><input type="number" value="1" min="0" oninput="updateTotals()"></td>
        <td><input type="number" value="0" min="0" step="0.01" oninput="updateTotals()"></td>
        <td class="item-total">0</td>
        <td><button class="delete-btn" onclick="deleteItem(this)">Ã—</button></td>
      `;
      updateTotals();
    }

    function deleteItem(btn) {
      btn.closest('tr').remove();
      updateTotals();
    }

    function updateTotals() {
      const rows = document.querySelectorAll('#itemsBody tr');
      const currency = document.getElementById('currency').value;
      const formatter = CURRENCIES[currency].format;
      
      let subtotal = 0;
      
      rows.forEach(row => {
        const qty = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const price = parseFloat(row.cells[2].querySelector('input').value) || 0;
        const total = qty * price;
        row.cells[3].textContent = formatter(total);
        subtotal += total;
      });

      const tax = subtotal * 0.1;
      const total = subtotal + tax;

      document.getElementById('subtotal').textContent = formatter(subtotal);
      document.getElementById('tax').textContent = formatter(tax);
      document.getElementById('total').textContent = formatter(total);
    }

    function saveInvoice() {
      const invoice = {
        number: document.getElementById('invoiceNumber').value,
        currency: document.getElementById('currency').value,
        from: {
          name: document.getElementById('fromName').value,
          address: document.getElementById('fromAddress').value
        },
        to: {
          name: document.getElementById('toName').value,
          address: document.getElementById('toAddress').value
        },
        items: [],
        date: new Date().toISOString()
      };

      document.querySelectorAll('#itemsBody tr').forEach(row => {
        invoice.items.push({
          description: row.cells[0].querySelector('input').value,
          quantity: row.cells[1].querySelector('input').value,
          price: row.cells[2].querySelector('input').value
        });
      });

      const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
      invoices.unshift(invoice);
      localStorage.setItem('invoices', JSON.stringify(invoices.slice(0, 50)));

      alert('ì¸ë³´ì´ìŠ¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function loadInvoices() {
      const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
      
      if (invoices.length === 0) {
        alert('ì €ì¥ëœ ì¸ë³´ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const container = document.getElementById('savedInvoices');
      const list = document.getElementById('savedInvoicesList');
      
      list.innerHTML = invoices.map((inv, idx) => `
        <div class="saved-invoice-item">
          <div class="saved-invoice-info">
            <div class="saved-invoice-number">${inv.number}</div>
            <div class="saved-invoice-date">${new Date(inv.date).toLocaleString('ko-KR')}</div>
            <div class="saved-invoice-date">${inv.from.name} â†’ ${inv.to.name}</div>
          </div>
          <div class="saved-invoice-actions">
            <button onclick="loadInvoice(${idx})" class="secondary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button onclick="deleteInvoice(${idx})" class="danger">ì‚­ì œ</button>
          </div>
        </div>
      `).join('');

      container.style.display = 'block';
    }

    function loadInvoice(idx) {
      const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
      const invoice = invoices[idx];

      document.getElementById('invoiceNumber').value = invoice.number;
      document.getElementById('currency').value = invoice.currency;
      document.getElementById('fromName').value = invoice.from.name;
      document.getElementById('fromAddress').value = invoice.from.address;
      document.getElementById('toName').value = invoice.to.name;
      document.getElementById('toAddress').value = invoice.to.address;

      document.getElementById('itemsBody').innerHTML = '';
      invoice.items.forEach(item => {
        const tbody = document.getElementById('itemsBody');
        const row = tbody.insertRow();
        row.innerHTML = `
          <td><input type="text" value="${item.description}" oninput="updateTotals()"></td>
          <td><input type="number" value="${item.quantity}" min="0" oninput="updateTotals()"></td>
          <td><input type="number" value="${item.price}" min="0" step="0.01" oninput="updateTotals()"></td>
          <td class="item-total">0</td>
          <td><button class="delete-btn" onclick="deleteItem(this)">Ã—</button></td>
        `;
      });

      updateTotals();
      document.getElementById('savedInvoices').style.display = 'none';
      window.scrollTo(0, 0);
    }

    function deleteInvoice(idx) {
      if (!confirm('ì´ ì¸ë³´ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
      invoices.splice(idx, 1);
      localStorage.setItem('invoices', JSON.stringify(invoices));
      loadInvoices();
    }

    function resetInvoice() {
      if (!confirm('ìƒˆ ì¸ë³´ì´ìŠ¤ë¥¼ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) return;
      
      generateInvoiceNumber();
      document.getElementById('currency').value = 'KRW';
      document.getElementById('fromName').value = '';
      document.getElementById('fromAddress').value = '';
      document.getElementById('toName').value = '';
      document.getElementById('toAddress').value = '';
      document.getElementById('itemsBody').innerHTML = '';
      addItem();
      addItem();
      document.getElementById('savedInvoices').style.display = 'none';
    }

    init();
  </script>
</body>
</html>
