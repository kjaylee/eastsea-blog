<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Formatter & Validator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
            --string: #8b5cf6;
            --number: #3b82f6;
            --boolean: #ec4899;
            --null: #64748b;
            --key: #10b981;
        }

        [data-theme="dark"] {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --border: #27272a;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        button {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        button.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
        }

        .tab.active {
            background: var(--bg-tertiary);
            color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .drop-zone.dragover {
            border-color: var(--accent);
            background: var(--bg-primary);
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            display: none;
        }

        .status.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
            display: block;
        }

        .status.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
            display: block;
        }

        .path-display {
            background: var(--bg-tertiary);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--warning);
            border: 1px solid var(--border);
        }

        .tree-view {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }

        .tree-node {
            cursor: pointer;
            user-select: none;
        }

        .tree-node:hover {
            color: var(--accent-hover);
        }

        .tree-toggle {
            display: inline-block;
            width: 16px;
            color: var(--text-secondary);
        }

        .tree-key {
            color: var(--key);
            font-weight: 600;
        }

        .tree-string {
            color: var(--string);
        }

        .tree-number {
            color: var(--number);
        }

        .tree-boolean {
            color: var(--boolean);
        }

        .tree-null {
            color: var(--null);
        }

        .tree-children {
            margin-left: 20px;
            display: block;
        }

        .tree-children.collapsed {
            display: none;
        }

        .indent-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .indent-selector label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .indent-selector select {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            textarea {
                min-height: 300px;
                font-size: 12px;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">ğŸŒ™</button>

    <div class="container">
        <header>
            <h1>ğŸ“‹ JSON Formatter & Validator</h1>
            <p class="subtitle">JSON ê²€ì¦, í¬ë§·íŒ…, íŠ¸ë¦¬ êµ¬ì¡° ì‹œê°í™” ë° ê²½ë¡œ íƒìƒ‰</p>
        </header>

        <div class="card">
            <div class="status" id="status"></div>
            <div class="path-display" id="path-display" style="display: none;">ê²½ë¡œ: <span id="json-path">-</span></div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('editor')">ğŸ“ ì—ë””í„°</button>
                <button class="tab" onclick="switchTab('tree')">ğŸŒ³ íŠ¸ë¦¬ë·°</button>
            </div>

            <div class="tab-content active" id="editor-tab">
                <div class="drop-zone" id="drop-zone">
                    ğŸ“ JSON íŒŒì¼ì„ ë“œë˜ê·¸ & ë“œë¡­í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ
                    <input type="file" id="file-input" accept=".json" style="display: none;">
                </div>

                <div class="indent-selector">
                    <label for="indent">ë“¤ì—¬ì“°ê¸°:</label>
                    <select id="indent">
                        <option value="2" selected>2 spaces</option>
                        <option value="4">4 spaces</option>
                        <option value="tab">Tab</option>
                    </select>
                </div>

                <div class="controls">
                    <button onclick="formatJSON()">âœ¨ í¬ë§·í•˜ê¸°</button>
                    <button onclick="minifyJSON()" class="secondary">ğŸ—œï¸ ì••ì¶•í•˜ê¸°</button>
                    <button onclick="validateJSON()" class="secondary">âœ“ ê²€ì¦í•˜ê¸°</button>
                    <button onclick="copyJSON()" class="secondary">ğŸ“‹ ë³µì‚¬</button>
                    <button onclick="clearJSON()" class="secondary">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
                </div>

                <textarea id="json-input" placeholder='{"name": "í™ê¸¸ë™", "age": 30, "skills": ["JavaScript", "Python"], "active": true}'></textarea>
            </div>

            <div class="tab-content" id="tree-tab">
                <div class="controls">
                    <button onclick="expandAll()">ğŸ”½ ì „ì²´ í¼ì¹˜ê¸°</button>
                    <button onclick="collapseAll()" class="secondary">â–¶ï¸ ì „ì²´ ì ‘ê¸°</button>
                    <button onclick="copyPath()" class="secondary">ğŸ“‹ ê²½ë¡œ ë³µì‚¬</button>
                </div>
                <div class="tree-view" id="tree-view">íŠ¸ë¦¬ë¥¼ ìƒì„±í•˜ë ¤ë©´ ë¨¼ì € JSONì„ ì…ë ¥í•˜ê³  í¬ë§·í•˜ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <script>
        let currentJSON = null;
        let currentPath = '';

        // Theme management
        function initTheme() {
            const saved = localStorage.getItem('json-formatter-theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            updateThemeIcon();
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'light';
            const next = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('json-formatter-theme', next);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            document.getElementById('theme-btn').textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'tree' && currentJSON) {
                renderTree();
            }
        }

        // Status message
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
            setTimeout(() => status.className = 'status', 3000);
        }

        // File drop & upload
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        function handleFile(file) {
            if (!file || !file.name.endsWith('.json')) {
                showStatus('JSON íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', true);
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('json-input').value = e.target.result;
                formatJSON();
            };
            reader.readAsText(file);
        }

        // Indent helper
        function getIndent() {
            const indent = document.getElementById('indent').value;
            return indent === 'tab' ? '\t' : parseInt(indent);
        }

        // JSON operations
        function formatJSON() {
            const input = document.getElementById('json-input');
            const text = input.value.trim();

            if (!text) {
                showStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                currentJSON = JSON.parse(text);
                const formatted = JSON.stringify(currentJSON, null, getIndent());
                input.value = formatted;
                showStatus('âœ“ JSONì´ ìœ íš¨í•˜ê³  í¬ë§·ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (e) {
                showStatus(`âœ— JSON ì˜¤ë¥˜ (line ${getErrorLine(text, e)}): ${e.message}`, true);
            }
        }

        function minifyJSON() {
            const input = document.getElementById('json-input');
            const text = input.value.trim();

            if (!text) {
                showStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                currentJSON = JSON.parse(text);
                input.value = JSON.stringify(currentJSON);
                showStatus('âœ“ JSONì´ ì••ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (e) {
                showStatus(`âœ— JSON ì˜¤ë¥˜: ${e.message}`, true);
            }
        }

        function validateJSON() {
            const text = document.getElementById('json-input').value.trim();
            if (!text) {
                showStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }
            try {
                currentJSON = JSON.parse(text);
                showStatus(`âœ“ ìœ íš¨í•œ JSONì…ë‹ˆë‹¤! (${getJSONStats(currentJSON)})`);
            } catch (e) {
                showStatus(`âœ— JSON ì˜¤ë¥˜ (line ${getErrorLine(text, e)}): ${e.message}`, true);
            }
        }

        function copyJSON() {
            const input = document.getElementById('json-input');
            if (!input.value.trim()) {
                showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', true);
                return;
            }
            navigator.clipboard.writeText(input.value);
            showStatus('âœ“ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function clearJSON() {
            document.getElementById('json-input').value = '';
            currentJSON = null;
            currentPath = '';
            document.getElementById('tree-view').innerHTML = 'íŠ¸ë¦¬ë¥¼ ìƒì„±í•˜ë ¤ë©´ ë¨¼ì € JSONì„ ì…ë ¥í•˜ê³  í¬ë§·í•˜ì„¸ìš”.';
            document.getElementById('path-display').style.display = 'none';
            showStatus('âœ“ ë‚´ìš©ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤!');
        }

        // Tree view rendering
        function renderTree() {
            if (!currentJSON) {
                showStatus('ë¨¼ì € JSONì„ í¬ë§·í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const treeView = document.getElementById('tree-view');
            treeView.innerHTML = '';
            buildTree(currentJSON, treeView, '');
        }

        function buildTree(obj, container, path) {
            if (obj === null) {
                container.innerHTML = '<span class="tree-null">null</span>';
                return;
            }

            const type = Array.isArray(obj) ? 'array' : typeof obj;

            if (type === 'object' || type === 'array') {
                const isArray = type === 'array';
                const entries = isArray ? obj.map((v, i) => [i, v]) : Object.entries(obj);

                entries.forEach(([key, value], idx) => {
                    const itemPath = path ? `${path}.${key}` : key;
                    const div = document.createElement('div');
                    div.className = 'tree-node';

                    const toggle = document.createElement('span');
                    toggle.className = 'tree-toggle';
                    toggle.textContent = 'â–¼';

                    const keySpan = document.createElement('span');
                    keySpan.className = 'tree-key';
                    keySpan.textContent = isArray ? `[${key}]` : `"${key}"`;
                    keySpan.onclick = () => setPath(itemPath);

                    const colon = document.createTextNode(': ');

                    if (typeof value === 'object' && value !== null) {
                        const childContainer = document.createElement('div');
                        childContainer.className = 'tree-children';

                        toggle.onclick = (e) => {
                            e.stopPropagation();
                            childContainer.classList.toggle('collapsed');
                            toggle.textContent = childContainer.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
                        };

                        div.appendChild(toggle);
                        div.appendChild(keySpan);
                        div.appendChild(colon);
                        div.appendChild(document.createTextNode(Array.isArray(value) ? '[' : '{'));
                        container.appendChild(div);
                        buildTree(value, childContainer, itemPath);
                        container.appendChild(childContainer);
                        
                        const closeBracket = document.createElement('div');
                        closeBracket.textContent = Array.isArray(value) ? ']' + (idx < entries.length - 1 ? ',' : '') : '}' + (idx < entries.length - 1 ? ',' : '');
                        container.appendChild(closeBracket);
                    } else {
                        div.appendChild(document.createTextNode('  '));
                        div.appendChild(keySpan);
                        div.appendChild(colon);
                        div.appendChild(formatValue(value));
                        div.appendChild(document.createTextNode(idx < entries.length - 1 ? ',' : ''));
                        div.onclick = () => setPath(itemPath);
                        container.appendChild(div);
                    }
                });
            } else {
                container.appendChild(formatValue(obj));
            }
        }

        function formatValue(value) {
            const span = document.createElement('span');
            const type = typeof value;
            
            if (type === 'string') {
                span.className = 'tree-string';
                span.textContent = `"${value}"`;
            } else if (type === 'number') {
                span.className = 'tree-number';
                span.textContent = value;
            } else if (type === 'boolean') {
                span.className = 'tree-boolean';
                span.textContent = value;
            } else if (value === null) {
                span.className = 'tree-null';
                span.textContent = 'null';
            }
            
            return span;
        }

        function setPath(path) {
            currentPath = path;
            document.getElementById('json-path').textContent = path;
            document.getElementById('path-display').style.display = 'block';
        }

        function copyPath() {
            if (!currentPath) {
                showStatus('ê²½ë¡œë¥¼ ì„ íƒí•˜ì„¸ìš”.', true);
                return;
            }
            navigator.clipboard.writeText(currentPath);
            showStatus('âœ“ ê²½ë¡œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function expandAll() {
            document.querySelectorAll('.tree-children').forEach(el => {
                el.classList.remove('collapsed');
            });
            document.querySelectorAll('.tree-toggle').forEach(el => {
                el.textContent = 'â–¼';
            });
            showStatus('âœ“ ëª¨ë“  ë…¸ë“œê°€ í¼ì³ì¡ŒìŠµë‹ˆë‹¤!');
        }

        function collapseAll() {
            document.querySelectorAll('.tree-children').forEach(el => {
                el.classList.add('collapsed');
            });
            document.querySelectorAll('.tree-toggle').forEach(el => {
                el.textContent = 'â–¶';
            });
            showStatus('âœ“ ëª¨ë“  ë…¸ë“œê°€ ì ‘í˜”ìŠµë‹ˆë‹¤!');
        }

        // Utility functions
        function getErrorLine(text, error) {
            const match = error.message.match(/position (\d+)/);
            if (!match) return '?';
            const pos = parseInt(match[1]);
            return text.substring(0, pos).split('\n').length;
        }

        function getJSONStats(obj) {
            let keys = 0;
            let values = 0;
            
            function count(o) {
                if (typeof o === 'object' && o !== null) {
                    keys += Object.keys(o).length;
                    Object.values(o).forEach(count);
                } else {
                    values++;
                }
            }
            count(obj);
            return `${keys} keys, ${values} values`;
        }

        // Keyboard shortcuts
        document.getElementById('json-input').addEventListener('keydown', function(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                e.preventDefault();
                formatJSON();
            }
        });

        // Initialize
        initTheme();
    </script>
</body>
</html>
