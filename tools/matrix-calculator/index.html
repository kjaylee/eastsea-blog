<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í–‰ë ¬ ê³„ì‚°ê¸° | ì›¹ ë„êµ¬ ëª¨ìŒ</title>
    <style>
        :root {
            --bg-primary: #ffffff; --bg-secondary: #f8f9fa;
            --text-primary: #212529; --text-secondary: #6c757d;
            --accent: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border: #dee2e6; --shadow: rgba(0,0,0,0.1); --card-bg: #ffffff;
        }
        [data-theme="dark"] {
            --bg-primary: #1a1a1a; --bg-secondary: #121212;
            --text-primary: #f8f9fa; --text-secondary: #adb5bd;
            --border: #444; --shadow: rgba(0,0,0,0.3); --card-bg: #2d2d2d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: var(--bg-secondary); color: var(--text-primary);
            line-height: 1.6; padding: 20px; min-height: 100vh;
        }
        .container { max-width: 900px; margin: 0 auto; }
        header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
        .back-btn { text-decoration: none; color: var(--text-secondary); display: flex; align-items: center; gap: 5px; font-weight: 500; }
        .back-btn:hover { color: var(--text-primary); }
        .theme-toggle { background: none; border: none; cursor: pointer; font-size: 1.5rem; }
        .card {
            background: var(--card-bg); border-radius: 20px; padding: 30px;
            box-shadow: 0 10px 30px var(--shadow); border: 1px solid var(--border); margin-bottom: 20px;
        }
        h1 { font-size: 1.8rem; margin-bottom: 10px; background: var(--accent); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 1.1rem; margin-bottom: 12px; }
        .desc { color: var(--text-secondary); margin-bottom: 20px; }
        .size-controls { display: flex; gap: 16px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
        .size-controls label { font-weight: 500; font-size: 0.9rem; margin: 0; }
        .size-controls select {
            padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px;
            background: var(--bg-primary); color: var(--text-primary); font-size: 0.9rem; outline: none;
        }
        .matrix-grid { display: inline-grid; gap: 6px; margin-bottom: 16px; }
        .matrix-grid input {
            width: 64px; height: 40px; text-align: center; border: 2px solid var(--border);
            border-radius: 8px; background: var(--bg-primary); color: var(--text-primary);
            font-size: 0.95rem; font-family: 'Courier New', monospace; outline: none;
        }
        .matrix-grid input:focus { border-color: #667eea; }
        .matrix-section { display: flex; flex-wrap: wrap; gap: 24px; align-items: flex-start; margin-bottom: 20px; }
        .matrix-box { text-align: center; }
        .matrix-label { font-weight: 700; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px; }
        .op-btns { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .op-btn {
            padding: 10px 18px; border: 2px solid var(--border); border-radius: 10px;
            background: var(--bg-primary); cursor: pointer; font-size: 0.9rem;
            color: var(--text-primary); transition: all 0.2s; font-weight: 600;
        }
        .op-btn:hover { border-color: #667eea; background: rgba(102,126,234,0.1); }
        .result-area {
            background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px;
            padding: 20px; min-height: 60px;
        }
        .result-matrix { display: inline-grid; gap: 4px; }
        .result-cell {
            width: 72px; height: 40px; display: flex; align-items: center; justify-content: center;
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 6px;
            font-family: 'Courier New', monospace; font-size: 0.95rem; font-weight: 600;
        }
        .scalar-result { font-family: 'Courier New', monospace; font-size: 1.4rem; font-weight: 700; text-align: center; }
        .quick-btns { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        .quick-btn {
            padding: 6px 12px; border: 1px solid var(--border); border-radius: 8px;
            background: var(--bg-primary); cursor: pointer; font-size: 0.8rem; color: var(--text-primary);
        }
        .quick-btn:hover { border-color: #667eea; }
        @media (max-width: 600px) { .matrix-grid input { width: 52px; height: 36px; font-size: 0.85rem; } .result-cell { width: 60px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="../" class="back-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“</button>
        </header>

        <div class="card">
            <h1>ğŸ§® í–‰ë ¬ ê³„ì‚°ê¸°</h1>
            <p class="desc">í–‰ë ¬ì˜ ë§ì…ˆ, ëº„ì…ˆ, ê³±ì…ˆ, ì „ì¹˜, í–‰ë ¬ì‹, ì—­í–‰ë ¬ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

            <div class="size-controls">
                <label>í–‰ë ¬ A í¬ê¸°:</label>
                <select id="rowsA" onchange="buildMatrices()">
                    <option value="2" selected>2í–‰</option><option value="3">3í–‰</option><option value="4">4í–‰</option>
                </select>
                <span>Ã—</span>
                <select id="colsA" onchange="buildMatrices()">
                    <option value="2" selected>2ì—´</option><option value="3">3ì—´</option><option value="4">4ì—´</option>
                </select>
                <label style="margin-left:16px;">í–‰ë ¬ B í¬ê¸°:</label>
                <select id="rowsB" onchange="buildMatrices()">
                    <option value="2" selected>2í–‰</option><option value="3">3í–‰</option><option value="4">4í–‰</option>
                </select>
                <span>Ã—</span>
                <select id="colsB" onchange="buildMatrices()">
                    <option value="2" selected>2ì—´</option><option value="3">3ì—´</option><option value="4">4ì—´</option>
                </select>
            </div>

            <div class="quick-btns">
                <button class="quick-btn" onclick="fillIdentity('A')">A = ë‹¨ìœ„í–‰ë ¬</button>
                <button class="quick-btn" onclick="fillIdentity('B')">B = ë‹¨ìœ„í–‰ë ¬</button>
                <button class="quick-btn" onclick="fillRandom('A')">A = ëœë¤</button>
                <button class="quick-btn" onclick="fillRandom('B')">B = ëœë¤</button>
                <button class="quick-btn" onclick="fillZero('A')">A = 0</button>
                <button class="quick-btn" onclick="fillZero('B')">B = 0</button>
            </div>

            <div class="matrix-section">
                <div class="matrix-box">
                    <div class="matrix-label">í–‰ë ¬ A</div>
                    <div class="matrix-grid" id="matA"></div>
                </div>
                <div class="matrix-box">
                    <div class="matrix-label">í–‰ë ¬ B</div>
                    <div class="matrix-grid" id="matB"></div>
                </div>
            </div>

            <div class="op-btns">
                <button class="op-btn" onclick="doOp('add')">A + B</button>
                <button class="op-btn" onclick="doOp('sub')">A âˆ’ B</button>
                <button class="op-btn" onclick="doOp('mul')">A Ã— B</button>
                <button class="op-btn" onclick="doOp('transA')">Aáµ€</button>
                <button class="op-btn" onclick="doOp('transB')">Báµ€</button>
                <button class="op-btn" onclick="doOp('detA')">det(A)</button>
                <button class="op-btn" onclick="doOp('detB')">det(B)</button>
                <button class="op-btn" onclick="doOp('invA')">Aâ»Â¹</button>
                <button class="op-btn" onclick="doOp('invB')">Bâ»Â¹</button>
                <button class="op-btn" onclick="doOp('scalarA')">k Ã— A</button>
            </div>
        </div>

        <div class="card">
            <h2>ê²°ê³¼</h2>
            <div class="result-area" id="result">ì—°ì‚°ì„ ì„ íƒí•˜ì„¸ìš”...</div>
        </div>
    </div>

    <script>
        function buildMatrices() {
            buildGrid('matA', +document.getElementById('rowsA').value, +document.getElementById('colsA').value);
            buildGrid('matB', +document.getElementById('rowsB').value, +document.getElementById('colsB').value);
        }

        function buildGrid(id, rows, cols) {
            const el = document.getElementById(id);
            el.style.gridTemplateColumns = `repeat(${cols}, 64px)`;
            el.innerHTML = '';
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const inp = document.createElement('input');
                    inp.type = 'number';
                    inp.value = r === c ? '1' : '0';
                    inp.dataset.row = r;
                    inp.dataset.col = c;
                    el.appendChild(inp);
                }
            }
        }

        function readMatrix(id) {
            const el = document.getElementById(id);
            const inputs = el.querySelectorAll('input');
            const rows = id === 'matA' ? +document.getElementById('rowsA').value : +document.getElementById('rowsB').value;
            const cols = id === 'matA' ? +document.getElementById('colsA').value : +document.getElementById('colsB').value;
            const m = [];
            let i = 0;
            for (let r = 0; r < rows; r++) {
                m[r] = [];
                for (let c = 0; c < cols; c++) {
                    m[r][c] = parseFloat(inputs[i++].value) || 0;
                }
            }
            return m;
        }

        function showMatrix(m) {
            const rows = m.length, cols = m[0].length;
            let html = `<div class="result-matrix" style="grid-template-columns: repeat(${cols}, 72px)">`;
            m.forEach(row => row.forEach(v => {
                const display = Number.isInteger(v) ? v : v.toFixed(4).replace(/\.?0+$/, '');
                html += `<div class="result-cell">${display}</div>`;
            }));
            html += '</div>';
            return html;
        }

        function transpose(m) {
            const rows = m.length, cols = m[0].length;
            const r = [];
            for (let c = 0; c < cols; c++) {
                r[c] = [];
                for (let rr = 0; rr < rows; rr++) r[c][rr] = m[rr][c];
            }
            return r;
        }

        function determinant(m) {
            const n = m.length;
            if (n === 1) return m[0][0];
            if (n === 2) return m[0][0]*m[1][1] - m[0][1]*m[1][0];
            let det = 0;
            for (let c = 0; c < n; c++) {
                const sub = m.slice(1).map(row => [...row.slice(0,c), ...row.slice(c+1)]);
                det += (c % 2 === 0 ? 1 : -1) * m[0][c] * determinant(sub);
            }
            return det;
        }

        function inverse(m) {
            const n = m.length;
            // Augment with identity
            const aug = m.map((row, i) => {
                const r = [...row];
                for (let j = 0; j < n; j++) r.push(i === j ? 1 : 0);
                return r;
            });
            // Gauss-Jordan
            for (let i = 0; i < n; i++) {
                let maxRow = i;
                for (let k = i+1; k < n; k++) if (Math.abs(aug[k][i]) > Math.abs(aug[maxRow][i])) maxRow = k;
                [aug[i], aug[maxRow]] = [aug[maxRow], aug[i]];
                if (Math.abs(aug[i][i]) < 1e-10) return null;
                const pivot = aug[i][i];
                for (let j = 0; j < 2*n; j++) aug[i][j] /= pivot;
                for (let k = 0; k < n; k++) {
                    if (k === i) continue;
                    const factor = aug[k][i];
                    for (let j = 0; j < 2*n; j++) aug[k][j] -= factor * aug[i][j];
                }
            }
            return aug.map(row => row.slice(n));
        }

        function doOp(op) {
            const A = readMatrix('matA');
            const B = readMatrix('matB');
            const out = document.getElementById('result');

            try {
                switch(op) {
                    case 'add':
                    case 'sub': {
                        if (A.length !== B.length || A[0].length !== B[0].length) throw 'í–‰ë ¬ í¬ê¸°ê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤';
                        const r = A.map((row, i) => row.map((v, j) => op === 'add' ? v + B[i][j] : v - B[i][j]));
                        out.innerHTML = `<div class="matrix-label">${op === 'add' ? 'A + B' : 'A âˆ’ B'}</div>` + showMatrix(r);
                        break;
                    }
                    case 'mul': {
                        if (A[0].length !== B.length) throw 'Aì˜ ì—´ ìˆ˜ì™€ Bì˜ í–‰ ìˆ˜ê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤';
                        const r = [];
                        for (let i = 0; i < A.length; i++) {
                            r[i] = [];
                            for (let j = 0; j < B[0].length; j++) {
                                let sum = 0;
                                for (let k = 0; k < A[0].length; k++) sum += A[i][k] * B[k][j];
                                r[i][j] = sum;
                            }
                        }
                        out.innerHTML = '<div class="matrix-label">A Ã— B</div>' + showMatrix(r);
                        break;
                    }
                    case 'transA': out.innerHTML = '<div class="matrix-label">Aáµ€</div>' + showMatrix(transpose(A)); break;
                    case 'transB': out.innerHTML = '<div class="matrix-label">Báµ€</div>' + showMatrix(transpose(B)); break;
                    case 'detA': {
                        if (A.length !== A[0].length) throw 'ì •ì‚¬ê°í–‰ë ¬ì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                        const d = determinant(A);
                        out.innerHTML = `<div class="scalar-result">det(A) = ${Number.isInteger(d) ? d : d.toFixed(6)}</div>`;
                        break;
                    }
                    case 'detB': {
                        if (B.length !== B[0].length) throw 'ì •ì‚¬ê°í–‰ë ¬ì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                        const d = determinant(B);
                        out.innerHTML = `<div class="scalar-result">det(B) = ${Number.isInteger(d) ? d : d.toFixed(6)}</div>`;
                        break;
                    }
                    case 'invA': {
                        if (A.length !== A[0].length) throw 'ì •ì‚¬ê°í–‰ë ¬ì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                        const inv = inverse(A);
                        if (!inv) throw 'ì—­í–‰ë ¬ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (íŠ¹ì´í–‰ë ¬)';
                        out.innerHTML = '<div class="matrix-label">Aâ»Â¹</div>' + showMatrix(inv);
                        break;
                    }
                    case 'invB': {
                        if (B.length !== B[0].length) throw 'ì •ì‚¬ê°í–‰ë ¬ì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                        const inv = inverse(B);
                        if (!inv) throw 'ì—­í–‰ë ¬ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (íŠ¹ì´í–‰ë ¬)';
                        out.innerHTML = '<div class="matrix-label">Bâ»Â¹</div>' + showMatrix(inv);
                        break;
                    }
                    case 'scalarA': {
                        const k = parseFloat(prompt('ìŠ¤ì¹¼ë¼ ê°’ kë¥¼ ì…ë ¥í•˜ì„¸ìš”:', '2'));
                        if (isNaN(k)) return;
                        const r = A.map(row => row.map(v => v * k));
                        out.innerHTML = `<div class="matrix-label">${k} Ã— A</div>` + showMatrix(r);
                        break;
                    }
                }
            } catch(e) {
                out.innerHTML = `<div style="color:#dc3545;font-weight:600;">âš ï¸ ${e}</div>`;
            }
        }

        function fillIdentity(which) {
            const id = which === 'A' ? 'matA' : 'matB';
            const inputs = document.getElementById(id).querySelectorAll('input');
            const rows = which === 'A' ? +document.getElementById('rowsA').value : +document.getElementById('rowsB').value;
            const cols = which === 'A' ? +document.getElementById('colsA').value : +document.getElementById('colsB').value;
            let i = 0;
            for (let r = 0; r < rows; r++)
                for (let c = 0; c < cols; c++)
                    inputs[i++].value = r === c ? 1 : 0;
        }

        function fillRandom(which) {
            const id = which === 'A' ? 'matA' : 'matB';
            document.getElementById(id).querySelectorAll('input').forEach(inp => {
                inp.value = Math.floor(Math.random() * 19) - 9;
            });
        }

        function fillZero(which) {
            const id = which === 'A' ? 'matA' : 'matB';
            document.getElementById(id).querySelectorAll('input').forEach(inp => inp.value = 0);
        }

        function toggleTheme() {
            const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
        }
        document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');
        buildMatrices();
    </script>
</body>
</html>
