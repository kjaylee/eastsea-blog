<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë¯¸ì§€ íŒ”ë ˆíŠ¸ ì¶”ì¶œê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s;
        }

        body.dark {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        body.dark .container {
            background: #2d2d44;
            color: #e0e0e0;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        body.dark h1 {
            color: #818cf8;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        body.dark .subtitle {
            color: #999;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            gap: 15px;
        }

        .theme-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        body.dark .theme-toggle {
            background: #818cf8;
        }

        .upload-area {
            border: 3px dashed #e0e0e0;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        body.dark .upload-area {
            border-color: #444;
        }

        body.dark .upload-area:hover {
            border-color: #818cf8;
            background: #1a1a2e;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            font-size: 1.1em;
        }

        body.dark .upload-text {
            color: #999;
        }

        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: none;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .color-card {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }

        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        body.dark .color-card {
            background: #1a1a2e;
        }

        .color-swatch {
            height: 120px;
            width: 100%;
        }

        .color-info {
            padding: 15px;
            text-align: center;
        }

        .color-hex {
            font-family: monospace;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        body.dark .color-hex {
            color: #e0e0e0;
        }

        .color-rgb {
            font-size: 0.85em;
            color: #666;
        }

        body.dark .color-rgb {
            color: #999;
        }

        .options {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }

        body.dark .options {
            background: #1a1a2e;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .option-label {
            font-weight: 500;
            min-width: 100px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        body.dark input[type="range"] {
            background: #444;
        }

        body.dark input[type="range"]::-webkit-slider-thumb {
            background: #818cf8;
        }

        body.dark input[type="range"]::-moz-range-thumb {
            background: #818cf8;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        body.dark button {
            background: #818cf8;
        }

        body.dark button:hover {
            background: #6366f1;
        }

        #fileInput {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .controls {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .palette-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h1>ğŸ¨ ì´ë¯¸ì§€ íŒ”ë ˆíŠ¸ ì¶”ì¶œê¸°</h1>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
        </div>
        <p class="subtitle">ì´ë¯¸ì§€ì—ì„œ ì£¼ìš” ìƒ‰ìƒì„ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤</p>

        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">ğŸ–¼ï¸</div>
            <div class="upload-text">ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”</div>
        </div>

        <input type="file" id="fileInput" accept="image/*">

        <img id="imagePreview" class="image-preview">

        <div class="options" id="options">
            <div class="option-group">
                <label class="option-label">ìƒ‰ìƒ ê°œìˆ˜: <span id="colorCountValue">5</span></label>
                <input type="range" id="colorCount" min="3" max="10" value="5" step="1">
            </div>
        </div>

        <div class="palette-grid" id="paletteGrid"></div>

        <div class="button-group" id="buttonGroup" style="display: none;">
            <button onclick="exportPalette()">ğŸ’¾ íŒ”ë ˆíŠ¸ ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="reset()">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>

        <canvas id="canvas" style="display: none;"></canvas>
    </div>

    <script>
        let currentColors = [];

        function init() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');

            fileInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#667eea';
                uploadArea.style.background = '#f8f9fa';
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#e0e0e0';
                uploadArea.style.background = 'transparent';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#e0e0e0';
                uploadArea.style.background = 'transparent';

                if (e.dataTransfer.files.length > 0) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });

            document.getElementById('colorCount').addEventListener('input', function() {
                document.getElementById('colorCountValue').textContent = this.value;
                if (document.getElementById('imagePreview').src) {
                    extractColors();
                }
            });
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('imagePreview');
                img.src = e.target.result;
                img.style.display = 'block';
                document.getElementById('uploadArea').style.display = 'none';
                document.getElementById('options').style.display = 'block';
                document.getElementById('buttonGroup').style.display = 'flex';

                img.onload = () => extractColors();
            };
            reader.readAsDataURL(file);
        }

        function extractColors() {
            const img = document.getElementById('imagePreview');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            // Resize canvas for performance
            const maxSize = 200;
            const scale = Math.min(maxSize / img.width, maxSize / img.height);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;

            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;

            // Simple color extraction using k-means-like approach
            const colorCount = parseInt(document.getElementById('colorCount').value);
            const colors = [];

            // Sample pixels
            const sampleSize = Math.floor(pixels.length / (4 * 100)); // Sample every 100 pixels
            for (let i = 0; i < pixels.length; i += sampleSize * 4) {
                colors.push({
                    r: pixels[i],
                    g: pixels[i + 1],
                    b: pixels[i + 2]
                });
            }

            // Get dominant colors
            const dominantColors = getDominantColors(colors, colorCount);
            currentColors = dominantColors;

            displayPalette(dominantColors);
        }

        function getDominantColors(colors, count) {
            // Simple clustering by color space
            const sorted = colors.sort((a, b) => {
                return (a.r * 299 + a.g * 587 + a.b * 114) - (b.r * 299 + b.g * 587 + b.b * 114);
            });

            const step = Math.floor(sorted.length / count);
            const dominant = [];

            for (let i = 0; i < count; i++) {
                const index = Math.min(i * step, sorted.length - 1);
                dominant.push(sorted[index]);
            }

            return dominant;
        }

        function displayPalette(colors) {
            const grid = document.getElementById('paletteGrid');
            grid.innerHTML = '';

            colors.forEach(color => {
                const hex = rgbToHex(color.r, color.g, color.b);
                const rgb = `${color.r}, ${color.g}, ${color.b}`;

                const card = document.createElement('div');
                card.className = 'color-card';
                card.onclick = () => copyColor(hex);

                card.innerHTML = `
                    <div class="color-swatch" style="background-color: rgb(${rgb});"></div>
                    <div class="color-info">
                        <div class="color-hex">${hex}</div>
                        <div class="color-rgb">RGB(${rgb})</div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = Math.round(x).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('').toUpperCase();
        }

        function copyColor(hex) {
            navigator.clipboard.writeText(hex).then(() => {
                alert(`âœ… ${hex} ìƒ‰ìƒì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            });
        }

        function exportPalette() {
            const data = currentColors.map(color => ({
                hex: rgbToHex(color.r, color.g, color.b),
                rgb: `rgb(${color.r}, ${color.g}, ${color.b})`
            }));

            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `palette-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function reset() {
            document.getElementById('imagePreview').src = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('options').style.display = 'none';
            document.getElementById('buttonGroup').style.display = 'none';
            document.getElementById('paletteGrid').innerHTML = '';
            document.getElementById('fileInput').value = '';
            currentColors = [];
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            const btn = document.querySelector('.theme-toggle');
            btn.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ëª¨ë“œ';
        }

        init();
    </script>
</body>
</html>
