<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRI Hash Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #ffffff; --bg-secondary: #f8f9fa; --bg-tertiary: #e9ecef;
            --text-primary: #212529; --text-secondary: #6c757d;
            --accent: #10b981; --border: #dee2e6; --shadow: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] {
            --bg-primary: #0f0f23; --bg-secondary: #1a1a2e; --bg-tertiary: #16213e;
            --text-primary: #e4e4e7; --text-secondary: #a1a1aa;
            --border: #27272a; --shadow: rgba(0,0,0,0.5);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: var(--bg-primary); color: var(--text-primary);
            padding: 20px; min-height: 100vh; transition: background 0.3s, color 0.3s;
        }
        .container { max-width: 700px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 2rem; color: var(--accent); margin-bottom: 8px; }
        .subtitle { color: var(--text-secondary); font-size: 0.9rem; }
        .theme-toggle {
            position: fixed; top: 20px; right: 20px; width: 44px; height: 44px;
            border-radius: 50%; background: var(--bg-secondary); border: 2px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3rem; cursor: pointer; z-index: 1000;
        }
        .card {
            background: var(--bg-secondary); border-radius: 16px; padding: 24px;
            border: 1px solid var(--border); margin-bottom: 20px;
        }
        .card h2 { font-size: 1.1rem; margin-bottom: 16px; color: var(--accent); }
        label { font-size: 0.85rem; color: var(--text-secondary); display: block; margin-bottom: 6px; }
        input[type="text"], textarea {
            width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 10px;
            background: var(--bg-primary); color: var(--text-primary); font-size: 0.95rem;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }
        textarea { resize: vertical; min-height: 120px; }
        .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
        .tab {
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;
            border: 1px solid var(--border); background: var(--bg-tertiary); font-weight: 600;
        }
        .tab.active { background: var(--accent); color: white; border-color: var(--accent); }
        .algo-group { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
        .algo-group label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.9rem; color: var(--text-primary); }
        .btn {
            padding: 12px 24px; border: none; border-radius: 10px;
            background: var(--accent); color: white; font-weight: 700;
            cursor: pointer; font-size: 1rem; width: 100%;
        }
        .btn:hover { opacity: 0.85; }
        .result-box {
            background: var(--bg-tertiary); border-radius: 12px; padding: 16px;
            margin-top: 16px; border: 1px solid var(--border); position: relative;
        }
        .result-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 6px; }
        .result-code {
            font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;
            word-break: break-all; line-height: 1.6; white-space: pre-wrap;
        }
        .copy-btn {
            position: absolute; top: 12px; right: 12px; padding: 4px 10px;
            border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary);
            color: var(--text-secondary); cursor: pointer; font-size: 0.75rem;
        }
        .copy-btn:hover { background: var(--accent); color: white; }
        .info {
            background: var(--bg-tertiary); border-radius: 10px; padding: 14px;
            font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;
            border-left: 3px solid var(--accent);
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">ğŸŒ™</button>
    <div class="container">
        <header>
            <h1>ğŸ”’ SRI Hash Generator</h1>
            <p class="subtitle">Subresource Integrity í•´ì‹œ ìƒì„±ê¸°</p>
        </header>

        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="setMode('url')" id="tab-url">URL</div>
                <div class="tab" onclick="setMode('text')" id="tab-text">ì§ì ‘ ì…ë ¥</div>
                <div class="tab" onclick="setMode('file')" id="tab-file">íŒŒì¼ ì—…ë¡œë“œ</div>
            </div>

            <div id="mode-url">
                <label>ë¦¬ì†ŒìŠ¤ URL (JS/CSS CDN ë§í¬)</label>
                <input type="text" id="url-input" placeholder="https://cdn.example.com/lib.min.js">
            </div>
            <div id="mode-text" style="display:none">
                <label>ì†ŒìŠ¤ ì½”ë“œ / í…ìŠ¤íŠ¸</label>
                <textarea id="text-input" placeholder="ì—¬ê¸°ì— ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            </div>
            <div id="mode-file" style="display:none">
                <label>íŒŒì¼ ì„ íƒ</label>
                <input type="file" id="file-input" style="padding:8px">
            </div>

            <div style="margin-top:16px">
                <label>í•´ì‹œ ì•Œê³ ë¦¬ì¦˜</label>
                <div class="algo-group">
                    <label><input type="checkbox" value="sha256" checked> SHA-256</label>
                    <label><input type="checkbox" value="sha384"> SHA-384</label>
                    <label><input type="checkbox" value="sha512"> SHA-512</label>
                </div>
            </div>

            <button class="btn" onclick="generate()">í•´ì‹œ ìƒì„±</button>

            <div id="results"></div>
        </div>

        <div class="info">
            ğŸ’¡ <strong>SRI (Subresource Integrity)</strong>ë€?<br>
            CDNì—ì„œ ë¡œë“œí•˜ëŠ” ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ë‚˜ ìŠ¤íƒ€ì¼ì‹œíŠ¸ê°€ ë³€ì¡°ë˜ì§€ ì•Šì•˜ëŠ”ì§€ ë¸Œë¼ìš°ì €ê°€ ê²€ì¦í•˜ëŠ” ë³´ì•ˆ ê¸°ëŠ¥ì…ë‹ˆë‹¤.
            <code>&lt;script&gt;</code> ë˜ëŠ” <code>&lt;link&gt;</code> íƒœê·¸ì— <code>integrity</code> ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
        </div>
    </div>
    <script>
        let mode = 'url';
        function initTheme() {
            const s = localStorage.getItem('sri-theme') || 'light';
            document.documentElement.setAttribute('data-theme', s);
            document.getElementById('theme-btn').textContent = s === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
        function toggleTheme() {
            const c = document.documentElement.getAttribute('data-theme') || 'light';
            const n = c === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', n);
            localStorage.setItem('sri-theme', n);
            document.getElementById('theme-btn').textContent = n === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function setMode(m) {
            mode = m;
            ['url','text','file'].forEach(t => {
                document.getElementById('mode-' + t).style.display = t === m ? '' : 'none';
                document.getElementById('tab-' + t).classList.toggle('active', t === m);
            });
        }

        async function hashBuffer(buf, algo) {
            const hashBuf = await crypto.subtle.digest(algo, buf);
            return btoa(String.fromCharCode(...new Uint8Array(hashBuf)));
        }

        async function generate() {
            let data;
            try {
                if (mode === 'url') {
                    const url = document.getElementById('url-input').value.trim();
                    if (!url) return alert('URLì„ ì…ë ¥í•˜ì„¸ìš”');
                    const resp = await fetch(url);
                    if (!resp.ok) throw new Error('Fetch failed: ' + resp.status);
                    data = await resp.arrayBuffer();
                } else if (mode === 'text') {
                    const text = document.getElementById('text-input').value;
                    if (!text) return alert('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                    data = new TextEncoder().encode(text).buffer;
                } else {
                    const file = document.getElementById('file-input').files[0];
                    if (!file) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
                    data = await file.arrayBuffer();
                }
            } catch (e) {
                return alert('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + e.message + '\n\nCORS ì œí•œìœ¼ë¡œ URLì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ” ê²½ìš° "ì§ì ‘ ì…ë ¥" ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.');
            }

            const algos = [...document.querySelectorAll('.algo-group input:checked')].map(i => i.value);
            if (!algos.length) return alert('ì•Œê³ ë¦¬ì¦˜ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”');

            const algoMap = { sha256: 'SHA-256', sha384: 'SHA-384', sha512: 'SHA-512' };
            let html = '';
            const integrityParts = [];

            for (const algo of algos) {
                const hash = await hashBuffer(data, algoMap[algo]);
                const integrity = `${algo}-${hash}`;
                integrityParts.push(integrity);
                html += `
                    <div class="result-box">
                        <button class="copy-btn" onclick="copy(this, '${integrity}')">ë³µì‚¬</button>
                        <div class="result-label">${algoMap[algo]}</div>
                        <div class="result-code">${integrity}</div>
                    </div>`;
            }

            const integrityFull = integrityParts.join(' ');
            const url = mode === 'url' ? document.getElementById('url-input').value.trim() : 'YOUR_URL_HERE';
            const isCSS = url.endsWith('.css');
            const tag = isCSS
                ? `&lt;link rel="stylesheet" href="${esc(url)}" integrity="${esc(integrityFull)}" crossorigin="anonymous"&gt;`
                : `&lt;script src="${esc(url)}" integrity="${esc(integrityFull)}" crossorigin="anonymous"&gt;&lt;/script&gt;`;

            html += `
                <div class="result-box">
                    <button class="copy-btn" onclick="copyTag(this)">ë³µì‚¬</button>
                    <div class="result-label">HTML íƒœê·¸</div>
                    <div class="result-code" id="tag-code">${tag}</div>
                </div>`;

            document.getElementById('results').innerHTML = html;
        }

        function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
        function copy(btn, text) {
            navigator.clipboard.writeText(text);
            btn.textContent = 'âœ“';
            setTimeout(() => btn.textContent = 'ë³µì‚¬', 1500);
        }
        function copyTag(btn) {
            const el = document.getElementById('tag-code');
            const text = el.textContent;
            navigator.clipboard.writeText(text);
            btn.textContent = 'âœ“';
            setTimeout(() => btn.textContent = 'ë³µì‚¬', 1500);
        }

        initTheme();
    </script>
</body>
</html>
