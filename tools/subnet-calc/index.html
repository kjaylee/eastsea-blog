<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subnet Calculator - ì„œë¸Œë„· ê³„ì‚°ê¸°</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#f0f2f5;--bg2:#fff;--text:#212529;--text2:#6c757d;--accent:#667eea;--accent2:#764ba2;--border:#dee2e6;--shadow:rgba(0,0,0,.08);--tag-bg:#e9ecef;--success:#28a745;--code-bg:#f1f3f5}
[data-theme="dark"]{--bg:#0f0f0f;--bg2:#1a1a2e;--text:#e8e8e8;--text2:#adb5bd;--accent:#7c8cf8;--accent2:#9b6dff;--border:#2d2d44;--shadow:rgba(0,0,0,.3);--tag-bg:#252540;--success:#51cf66;--code-bg:#16162a}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:all .3s}
.container{max-width:900px;margin:0 auto;padding:20px}
header{text-align:center;padding:30px 0 20px}
h1{font-size:2rem;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
.subtitle{color:var(--text2);font-size:.95rem}
.theme-btn{position:fixed;top:16px;right:16px;width:44px;height:44px;border-radius:50%;border:2px solid var(--border);background:var(--bg2);cursor:pointer;font-size:1.3rem;display:flex;align-items:center;justify-content:center;z-index:99}
.card{background:var(--bg2);border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 4px 20px var(--shadow)}
.card h2{font-size:1.1rem;color:var(--accent);margin-bottom:16px}
.input-row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;margin-bottom:16px}
.input-group{display:flex;flex-direction:column;gap:6px;flex:1;min-width:180px}
.input-group label{font-size:.85rem;color:var(--text2);font-weight:500}
.input-group input,.input-group select{padding:10px 14px;border:2px solid var(--border);border-radius:10px;background:var(--bg);color:var(--text);font-size:.95rem;font-family:monospace;transition:border .2s}
.input-group input:focus,.input-group select:focus{outline:none;border-color:var(--accent)}
.btn{padding:10px 24px;border:none;border-radius:10px;cursor:pointer;font-size:.9rem;font-weight:600;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;height:42px}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 15px rgba(102,126,234,.4)}
.result-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.result-item{background:var(--code-bg);border-radius:12px;padding:14px 18px;border-left:4px solid var(--accent)}
.result-label{font-size:.8rem;color:var(--text2);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.result-value{font-family:'Fira Code',monospace;font-size:1rem;font-weight:600;word-break:break-all}
.result-value.highlight{color:var(--accent)}
.binary-display{background:var(--code-bg);border-radius:12px;padding:16px;margin-top:16px;font-family:monospace;font-size:.85rem;line-height:1.8;overflow-x:auto;white-space:pre}
.binary-display .net{color:var(--accent);font-weight:700}
.binary-display .host{color:var(--success);font-weight:700}
.binary-display .label{color:var(--text2);display:inline-block;width:100px}
.cidr-table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:10px}
.cidr-table th{background:var(--tag-bg);padding:10px 12px;text-align:left;font-weight:600;white-space:nowrap;position:sticky;top:0}
.cidr-table td{padding:10px 12px;border-bottom:1px solid var(--border);font-family:monospace;white-space:nowrap}
.cidr-table tr:hover td{background:var(--code-bg)}
.cidr-table tr.active td{background:rgba(102,126,234,.12);font-weight:700}
.quick-btns{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px}
.quick-btn{padding:6px 14px;border:1.5px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text2);cursor:pointer;font-size:.8rem;font-family:monospace;transition:all .2s}
.quick-btn:hover,.quick-btn.active{border-color:var(--accent);color:var(--accent);background:rgba(102,126,234,.08)}
.tab-bar{display:flex;gap:0;margin-bottom:20px}
.tab{flex:1;padding:12px;text-align:center;border:2px solid var(--border);background:var(--bg);color:var(--text2);cursor:pointer;font-size:.9rem;font-weight:500;transition:all .2s}
.tab:first-child{border-radius:10px 0 0 10px}
.tab:last-child{border-radius:0 10px 10px 0}
.tab.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border-color:var(--accent)}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:#333;color:#fff;padding:12px 24px;border-radius:10px;font-size:.9rem;transition:transform .3s;z-index:999}
.toast.show{transform:translateX(-50%) translateY(0)}
.table-wrap{overflow-x:auto;max-height:400px;overflow-y:auto}
.hidden{display:none}
.error{color:#e03131;font-size:.85rem;margin-top:6px}
@media(max-width:600px){h1{font-size:1.5rem}.input-row{flex-direction:column}.result-grid{grid-template-columns:1fr}.cidr-table{font-size:.75rem}}
</style>
</head>
<body>
<button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
<div class="container">
<header>
<h1>ğŸŒ Subnet Calculator</h1>
<p class="subtitle">IPv4 ì„œë¸Œë„· ê³„ì‚° ë° ë„¤íŠ¸ì›Œí¬ ë¶„ì„ ë„êµ¬</p>
</header>

<div class="tab-bar">
<div class="tab active" onclick="switchTab('calc')">ì„œë¸Œë„· ê³„ì‚°</div>
<div class="tab" onclick="switchTab('ref')">CIDR ë ˆí¼ëŸ°ìŠ¤</div>
</div>

<div id="tabCalc">
<div class="card">
<h2>ğŸ“¥ ì…ë ¥</h2>
<div class="quick-btns" id="quickBtns">
<span style="font-size:.85rem;color:var(--text2);margin-right:4px">ë¹ ë¥¸ ì…ë ¥:</span>
<button class="quick-btn" onclick="quickFill('192.168.1.0',24)">192.168.1.0/24</button>
<button class="quick-btn" onclick="quickFill('10.0.0.0',8)">10.0.0.0/8</button>
<button class="quick-btn" onclick="quickFill('172.16.0.0',16)">172.16.0.0/16</button>
<button class="quick-btn" onclick="quickFill('192.168.0.0',16)">192.168.0.0/16</button>
<button class="quick-btn" onclick="quickFill('10.10.10.0',28)">10.10.10.0/28</button>
</div>
<div class="input-row">
<div class="input-group">
<label>IP ì£¼ì†Œ</label>
<input type="text" id="ipInput" value="192.168.1.100" placeholder="192.168.1.0" oninput="autoCalc()">
</div>
<div class="input-group" style="max-width:160px">
<label>ì„œë¸Œë„· ë§ˆìŠ¤í¬ (CIDR)</label>
<select id="cidrSelect" onchange="autoCalc()">
</select>
</div>
<button class="btn btn-primary" onclick="calculate()">ê³„ì‚°</button>
</div>
<div id="error" class="error hidden"></div>
</div>

<div class="card" id="resultCard" style="display:none">
<h2>ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
<div class="result-grid" id="resultGrid"></div>
<div class="binary-display" id="binaryDisplay"></div>
</div>
</div>

<div id="tabRef" class="hidden">
<div class="card">
<h2>ğŸ“‹ CIDR ë ˆí¼ëŸ°ìŠ¤ í…Œì´ë¸”</h2>
<div class="table-wrap">
<table class="cidr-table">
<thead><tr><th>CIDR</th><th>ì„œë¸Œë„· ë§ˆìŠ¤í¬</th><th>ì™€ì¼ë“œì¹´ë“œ</th><th>í˜¸ìŠ¤íŠ¸ ìˆ˜</th><th>í´ë˜ìŠ¤</th></tr></thead>
<tbody id="cidrTable"></tbody>
</table>
</div>
</div>
</div>
</div>
<div class="toast" id="toast"></div>

<script>
function initCIDR(){
  const sel=document.getElementById('cidrSelect');
  const tbody=document.getElementById('cidrTable');
  for(let c=0;c<=32;c++){
    const mask=cidrToMask(c);
    const hosts=c>=31?(c===32?1:2):Math.pow(2,32-c)-2;
    const cls=c<=8?'A':c<=16?'B':c<=24?'C':'CIDR';
    sel.innerHTML+=`<option value="${c}"${c===24?' selected':''}> /${c} (${mask})</option>`;
    tbody.innerHTML+=`<tr><td>/${c}</td><td>${mask}</td><td>${wildcardMask(c)}</td><td>${hosts<0?0:hosts.toLocaleString()}</td><td>${cls}</td></tr>`;
  }
}

function cidrToMask(cidr){
  const m=(0xFFFFFFFF<<(32-cidr))>>>0;
  return [(m>>>24)&255,(m>>>16)&255,(m>>>8)&255,m&255].join('.');
}

function wildcardMask(cidr){
  const m=(0xFFFFFFFF<<(32-cidr))>>>0;
  const w=(~m)>>>0;
  return [(w>>>24)&255,(w>>>16)&255,(w>>>8)&255,w&255].join('.');
}

function ipToInt(ip){
  const p=ip.split('.').map(Number);
  return((p[0]<<24)|(p[1]<<16)|(p[2]<<8)|p[3])>>>0;
}

function intToIP(n){
  return [(n>>>24)&255,(n>>>16)&255,(n>>>8)&255,n&255].join('.');
}

function toBin(n,bits){return n.toString(2).padStart(bits,'0')}

function ipToBin(ip){return ip.split('.').map(o=>parseInt(o).toString(2).padStart(8,'0')).join('.')}

function validateIP(ip){
  const parts=ip.trim().split('.');
  if(parts.length!==4)return false;
  return parts.every(p=>{const n=parseInt(p);return!isNaN(n)&&n>=0&&n<=255&&String(n)===p.trim()});
}

function quickFill(ip,cidr){
  document.getElementById('ipInput').value=ip;
  document.getElementById('cidrSelect').value=cidr;
  calculate();
}

function autoCalc(){
  const ip=document.getElementById('ipInput').value.trim();
  // Support CIDR notation in IP field
  if(ip.includes('/')){
    const[addr,cidr]=ip.split('/');
    if(validateIP(addr)&&parseInt(cidr)>=0&&parseInt(cidr)<=32){
      document.getElementById('ipInput').value=addr;
      document.getElementById('cidrSelect').value=parseInt(cidr);
      calculate();
    }
  }
}

function calculate(){
  const ip=document.getElementById('ipInput').value.trim();
  const cidr=parseInt(document.getElementById('cidrSelect').value);
  const err=document.getElementById('error');

  if(!validateIP(ip)){
    err.textContent='ìœ íš¨í•œ IPv4 ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 192.168.1.0)';
    err.classList.remove('hidden');
    document.getElementById('resultCard').style.display='none';
    return;
  }
  err.classList.add('hidden');

  const ipInt=ipToInt(ip);
  const maskInt=(0xFFFFFFFF<<(32-cidr))>>>0;
  const wildInt=(~maskInt)>>>0;
  const netInt=(ipInt&maskInt)>>>0;
  const broadInt=(netInt|wildInt)>>>0;
  const firstHost=cidr>=31?netInt:(netInt+1)>>>0;
  const lastHost=cidr>=31?broadInt:(broadInt-1)>>>0;
  const totalHosts=cidr>=31?(cidr===32?1:2):Math.pow(2,32-cidr)-2;

  const isPrivate=(ip.startsWith('10.')||(ip.startsWith('172.')&&parseInt(ip.split('.')[1])>=16&&parseInt(ip.split('.')[1])<=31)||ip.startsWith('192.168.'));
  const cls=cidr<=8?'A':cidr<=16?'B':cidr<=24?'C':'CIDR';

  const results=[
    {label:'IP ì£¼ì†Œ',value:ip,hl:false},
    {label:'ì„œë¸Œë„· ë§ˆìŠ¤í¬',value:cidrToMask(cidr)+` (/${cidr})`,hl:false},
    {label:'ì™€ì¼ë“œì¹´ë“œ ë§ˆìŠ¤í¬',value:wildcardMask(cidr),hl:false},
    {label:'ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ',value:intToIP(netInt),hl:true},
    {label:'ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì£¼ì†Œ',value:intToIP(broadInt),hl:false},
    {label:'ì‚¬ìš© ê°€ëŠ¥í•œ í˜¸ìŠ¤íŠ¸ ë²”ìœ„',value:`${intToIP(firstHost)} ~ ${intToIP(lastHost)}`,hl:true},
    {label:'ì‚¬ìš© ê°€ëŠ¥ í˜¸ìŠ¤íŠ¸ ìˆ˜',value:totalHosts.toLocaleString()+' ê°œ',hl:true},
    {label:'ì „ì²´ IP ìˆ˜',value:Math.pow(2,32-cidr).toLocaleString()+' ê°œ',hl:false},
    {label:'ë„¤íŠ¸ì›Œí¬ í´ë˜ìŠ¤',value:`Class ${cls}`,hl:false},
    {label:'IP íƒ€ì…',value:isPrivate?'ğŸ”’ ì‚¬ì„¤ IP (Private)':'ğŸŒ ê³µì¸ IP (Public)',hl:false}
  ];

  const grid=document.getElementById('resultGrid');
  grid.innerHTML=results.map(r=>`<div class="result-item"><div class="result-label">${r.label}</div><div class="result-value${r.hl?' highlight':''}">${r.value}</div></div>`).join('');

  // Binary display
  const ipBin=toBin(ipInt,32);
  const maskBin=toBin(maskInt,32);
  const netBin=toBin(netInt,32);
  const fmt=(bin,cidr)=>{
    const net=bin.substring(0,cidr);
    const host=bin.substring(cidr);
    const fmtBin=(s)=>s.match(/.{1,8}/g)?.join('.') || '';
    // color split
    return `<span class="net">${fmtBin(net+host).substring(0,net.length+Math.floor(net.length/8))}</span>` +
           (host?`<span class="host">${fmtBin(net+host).substring(net.length+Math.floor(net.length/8))}</span>`:'');
  };

  const fmtBin=(n)=>{const b=toBin(n,32);return b.match(/.{8}/g).join('.')};
  const colorBin=(b,c)=>{
    const bits=b.replace(/\./g,'');
    const net=bits.substring(0,c);const host=bits.substring(c);
    const full=net+host;
    let result='';
    for(let i=0;i<32;i++){
      if(i>0&&i%8===0)result+='.';
      result+=i<c?`<span class="net">${full[i]}</span>`:`<span class="host">${full[i]}</span>`;
    }
    return result;
  };

  document.getElementById('binaryDisplay').innerHTML=
    `<span class="label">IP ì£¼ì†Œ:</span>  ${colorBin(fmtBin(ipInt),cidr)}\n`+
    `<span class="label">ì„œë¸Œë„· ë§ˆìŠ¤í¬:</span>${colorBin(fmtBin(maskInt),cidr)}\n`+
    `<span class="label">ë„¤íŠ¸ì›Œí¬:</span>  ${colorBin(fmtBin(netInt),cidr)}\n`+
    `<span class="label">ë¸Œë¡œë“œìºìŠ¤íŠ¸:</span>${colorBin(fmtBin(broadInt),cidr)}\n\n`+
    `<span style="color:var(--text2)">ğŸŸ¦ <span class="net">ë„¤íŠ¸ì›Œí¬ ë¹„íŠ¸</span>  ğŸŸ© <span class="host">í˜¸ìŠ¤íŠ¸ ë¹„íŠ¸</span></span>`;

  document.getElementById('resultCard').style.display='block';

  // Highlight CIDR table row
  document.querySelectorAll('.cidr-table tr').forEach(r=>r.classList.remove('active'));
  const rows=document.querySelectorAll('.cidr-table tbody tr');
  if(rows[cidr])rows[cidr].classList.add('active');
}

function switchTab(tab){
  document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',i===(tab==='calc'?0:1)));
  document.getElementById('tabCalc').classList.toggle('hidden',tab!=='calc');
  document.getElementById('tabRef').classList.toggle('hidden',tab!=='ref');
}

function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function toggleTheme(){const d=document.documentElement;const c=d.getAttribute('data-theme')==='dark'?'light':'dark';d.setAttribute('data-theme',c);localStorage.setItem('theme',c)}
document.documentElement.setAttribute('data-theme',localStorage.getItem('theme')||'light');

initCIDR();
calculate();
</script>
</body>
</html>