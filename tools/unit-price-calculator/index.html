<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‹¨ìœ„ê°€ê²© ë¹„êµê¸° | Unit Price Calculator</title>
  <meta name="description" content="ì œí’ˆë³„ ë‹¨ìœ„ë‹¹ ê°€ê²©ì„ ìë™ ê³„ì‚°í•˜ê³  í• ì¸/ì¦ì • ìˆ˜ëŸ‰ê¹Œì§€ ë°˜ì˜í•´ ê°€ì¥ ì €ë ´í•œ ìƒí’ˆì„ ì°¾ëŠ” ë„êµ¬" />
  <style>
    :root{
      --bg:#f5f7ff;--panel:#fff;--text:#13203a;--muted:#627196;--line:#dce4f4;
      --primary:#2563eb;--soft:#ecf2ff;--success:#059669;--danger:#dc2626;--radius:14px;
      --shadow:0 14px 32px rgba(15,23,42,.08);
    }
    [data-theme="dark"]{
      --bg:#0d1428;--panel:#111b33;--text:#ebf2ff;--muted:#9caed1;--line:#2a3d63;
      --primary:#5f8dff;--soft:#182845;--success:#10b981;--danger:#ff7a7a;
      --shadow:0 16px 40px rgba(2,8,20,.5);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;padding:18px;line-height:1.45}
    .wrap{max-width:1120px;margin:0 auto}
    .back{display:inline-flex;gap:8px;align-items:center;color:var(--muted);text-decoration:none;margin-bottom:10px}
    .head{display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;align-items:flex-start;margin-bottom:14px}
    h1{font-size:clamp(1.45rem,2.9vw,2rem);letter-spacing:-.02em}
    .sub{margin-top:6px;color:var(--muted);font-size:.95rem}
    .btn{border:1px solid var(--line);background:var(--panel);color:var(--text);padding:9px 12px;border-radius:10px;font-size:.88rem;font-weight:700;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--primary),#4f7fff);color:#fff;border:none}
    .btn.danger{background:rgba(220,38,38,.1);color:var(--danger)}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
    .panel + .panel{margin-top:14px}
    .cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-top:10px}
    .card{border:1px solid var(--line);border-radius:11px;padding:10px;background:var(--soft)}
    .k{font-size:.74rem;color:var(--muted);font-weight:800}
    .v{margin-top:4px;font-size:1.08rem;font-weight:800}
    .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
    table{width:100%;border-collapse:collapse;min-width:980px}
    th,td{border-bottom:1px solid var(--line);padding:9px 8px;text-align:left;font-size:.84rem;vertical-align:middle}
    th{background:var(--soft);font-size:.75rem;color:var(--muted);font-weight:800}
    input,select{width:100%;border:1px solid var(--line);border-radius:9px;background:transparent;color:var(--text);padding:8px 9px;font-family:inherit;font-size:.86rem}
    input:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.14)}
    .pill{display:inline-flex;padding:4px 8px;border-radius:999px;font-size:.75rem;font-weight:800}
    .pill.best{background:rgba(5,150,105,.14);color:var(--success)}
    .pill.bad{background:rgba(217,119,6,.14);color:#b45309}
    .bar{height:8px;background:rgba(148,163,184,.2);border-radius:999px;overflow:hidden}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--primary),#7ea2ff)}
    .tiny{font-size:.79rem;color:var(--muted)}
    @media (max-width:900px){.cards{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media (max-width:680px){body{padding:14px}.cards{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="/tools/">â† ë„êµ¬ ëª©ë¡ìœ¼ë¡œ</a>
    <div class="head">
      <div>
        <h1>ğŸ›’ ë‹¨ìœ„ê°€ê²© ë¹„êµê¸°</h1>
        <p class="sub">ê°€ê²© + í• ì¸ + ì¦ì •ìˆ˜ëŸ‰ì„ í•¨ê»˜ ê³„ì‚°í•´ ì‹¤ì œ ë‹¨ìœ„ë‹¹ ê°€ê²©(ì›/g, ì›/ml, ì›/ê°œ)ì„ ë¹„êµí•©ë‹ˆë‹¤.</p>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="themeBtn">ğŸŒ™ í…Œë§ˆ</button>
        <button class="btn" id="sampleBtn">ìƒ˜í”Œ ë°ì´í„°</button>
        <button class="btn primary" id="addBtn">+ ìƒí’ˆ ì¶”ê°€</button>
        <button class="btn danger" id="resetBtn">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <section class="panel">
      <h2 style="font-size:1rem">ğŸ“¦ ìƒí’ˆ ë¹„êµ</h2>
      <p class="tiny" style="margin:6px 0 10px">ë‹¨ìœ„ëŠ” g/ml/ê°œ ë‹¨ìœ„ë¡œ ìë™ ì •ê·œí™”ë©ë‹ˆë‹¤. kg/LëŠ” 1000ë°°ë¡œ í™˜ì‚°ë©ë‹ˆë‹¤.</p>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="min-width:140px">ìƒí’ˆëª…</th>
              <th>í‘œì‹œê°€ê²©(ì›)</th>
              <th>í• ì¸(%)</th>
              <th>ê¸°ë³¸ìˆ˜ëŸ‰</th>
              <th>ë‹¨ìœ„</th>
              <th>ì¦ì •ìˆ˜ëŸ‰</th>
              <th>ì‹¤ê²°ì œê°€</th>
              <th>ì´ìˆ˜ëŸ‰</th>
              <th>ë‹¨ìœ„ê°€</th>
              <th>ë¹„êµ</th>
              <th>ì‚­ì œ</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <div class="cards" id="summary"></div>
    </section>

    <section class="panel">
      <h2 style="font-size:1rem">ğŸ“Š ë‹¨ìœ„ê°€ ì‹œê°í™”</h2>
      <div id="bars" style="display:flex;flex-direction:column;gap:10px;margin-top:10px"></div>
    </section>
  </div>

<script>
(() => {
  const KEY='es_unit_price_calc_v1';
  const $ = (id) => document.getElementById(id);
  const num = (v) => Number(v||0);
  const money = (v) => 'â‚©' + Math.round(v||0).toLocaleString('ko-KR');

  function uid(){ return Date.now()+Math.floor(Math.random()*99999); }
  function defaults(){
    return { items:[
      {id:uid(), name:'ì˜¬ë¦¬ë¸Œì˜¤ì¼ A', price:18900, discount:15, qty:500, unit:'ml', bonus:0},
      {id:uid(), name:'ì˜¬ë¦¬ë¸Œì˜¤ì¼ B', price:24900, discount:25, qty:750, unit:'ml', bonus:50},
      {id:uid(), name:'ì˜¬ë¦¬ë¸Œì˜¤ì¼ C', price:12900, discount:5, qty:300, unit:'ml', bonus:0}
    ]};
  }

  let state = load();
  function load(){
    try{ const v = JSON.parse(localStorage.getItem(KEY)||'null'); return v?.items?.length ? v : defaults(); }
    catch{ return defaults(); }
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  function initTheme(){ document.documentElement.setAttribute('data-theme', localStorage.getItem('es_tool_theme') || 'light'); }
  function toggleTheme(){
    const next = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
    document.documentElement.setAttribute('data-theme',next); localStorage.setItem('es_tool_theme',next);
  }

  function baseQty(q,u){
    const unit = (u||'g').toLowerCase();
    if(unit==='kg' || unit==='l') return num(q)*1000;
    return num(q);
  }

  function calc(item){
    const pay = num(item.price) * (1 - Math.max(0,Math.min(95,num(item.discount)))/100);
    const totalQty = baseQty(item.qty,item.unit) + baseQty(item.bonus,item.unit);
    const unitPrice = totalQty>0 ? pay/totalQty : Infinity;
    return {pay,totalQty,unitPrice};
  }

  function render(){
    const withCalc = state.items.map(i => ({...i, ...calc(i)}));
    const valid = withCalc.filter(i => isFinite(i.unitPrice) && i.totalQty>0);
    const best = valid.length ? valid.reduce((a,b)=>a.unitPrice<=b.unitPrice?a:b) : null;

    $('rows').innerHTML = withCalc.map(item => {
      const diff = best ? ((item.unitPrice/best.unitPrice)-1)*100 : 0;
      const compare = !best ? '-' : item.id===best.id
        ? '<span class="pill best">ìµœì €ê°€</span>'
        : `<span class="pill bad">+${Math.max(0,diff).toFixed(1)}%</span>`;

      const unitLabel = ['ml','l'].includes(item.unit.toLowerCase()) ? 'ì›/ml' : 'ì›/'+(item.unit.toLowerCase()==='kg'?'g':item.unit.toLowerCase());
      return `
      <tr data-id="${item.id}">
        <td><input data-field="name" value="${esc(item.name)}" placeholder="ìƒí’ˆëª…"/></td>
        <td><input data-field="price" type="number" min="0" step="100" value="${Math.round(item.price)}"/></td>
        <td><input data-field="discount" type="number" min="0" max="95" step="0.1" value="${item.discount}"/></td>
        <td><input data-field="qty" type="number" min="0" step="1" value="${item.qty}"/></td>
        <td>
          <select data-field="unit">
            <option value="g" ${item.unit==='g'?'selected':''}>g</option>
            <option value="kg" ${item.unit==='kg'?'selected':''}>kg</option>
            <option value="ml" ${item.unit==='ml'?'selected':''}>ml</option>
            <option value="L" ${item.unit==='L'?'selected':''}>L</option>
            <option value="ea" ${item.unit==='ea'?'selected':''}>ea</option>
          </select>
        </td>
        <td><input data-field="bonus" type="number" min="0" step="1" value="${item.bonus}"/></td>
        <td>${money(item.pay)}</td>
        <td>${Math.round(item.totalQty).toLocaleString('ko-KR')} ${normalizedUnit(item.unit)}</td>
        <td>${isFinite(item.unitPrice)? money(item.unitPrice) + ` / ${normalizedUnit(item.unit)}` : '-'}</td>
        <td>${compare}</td>
        <td><button class="btn danger" data-act="del" style="padding:6px 8px;font-size:.76rem">ì‚­ì œ</button></td>
      </tr>`;
    }).join('');

    const cheapest = best ? `${best.name} (${money(best.unitPrice)} / ${normalizedUnit(best.unit)})` : '-';
    const avg = valid.length ? valid.reduce((a,b)=>a+b.unitPrice,0)/valid.length : 0;
    const spread = valid.length>1 ? Math.max(...valid.map(v=>v.unitPrice)) - Math.min(...valid.map(v=>v.unitPrice)) : 0;

    $('summary').innerHTML = [
      ['ìµœì € ë‹¨ìœ„ê°€', cheapest],
      ['ë¹„êµ ìƒí’ˆ ìˆ˜', valid.length + 'ê°œ'],
      ['í‰ê·  ë‹¨ìœ„ê°€', money(avg)],
      ['ìµœê³ -ìµœì € ì°¨ì´', money(spread)]
    ].map(([k,v])=>`<article class="card"><div class="k">${k}</div><div class="v">${v}</div></article>`).join('');

    const maxPrice = valid.length ? Math.max(...valid.map(v=>v.unitPrice)) : 1;
    $('bars').innerHTML = valid.sort((a,b)=>a.unitPrice-b.unitPrice).map(v=>{
      const w = Math.max(6, Math.round((v.unitPrice/maxPrice)*100));
      const bestText = best && v.id===best.id ? ' Â· ìµœì €' : '';
      return `<div>
        <div class="tiny" style="margin-bottom:5px"><strong>${esc(v.name)}</strong> â€” ${money(v.unitPrice)} / ${normalizedUnit(v.unit)}${bestText}</div>
        <div class="bar"><span style="width:${w}%"></span></div>
      </div>`;
    }).join('') || '<p class="tiny">ë¹„êµí•  ìƒí’ˆì„ ì¶”ê°€í•˜ì„¸ìš”.</p>';
  }

  function normalizedUnit(unit){
    const u = (unit||'g').toLowerCase();
    if(u==='kg') return 'g';
    if(u==='l') return 'ml';
    return u;
  }

  function esc(s){ return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

  function add(){
    state.items.push({id:uid(),name:'ìƒˆ ìƒí’ˆ',price:0,discount:0,qty:100,unit:'g',bonus:0});
    save(); render();
  }

  function sample(){ state = defaults(); save(); render(); }
  function reset(){ if(confirm('ëª¨ë“  ìƒí’ˆ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')){ state={items:[]}; save(); render(); }}

  function onTable(e){
    const tr = e.target.closest('tr[data-id]');
    if(!tr) return;
    const id = Number(tr.dataset.id);
    const row = state.items.find(x=>Number(x.id)===id);
    if(!row) return;

    if(e.target.dataset.act==='del'){
      state.items = state.items.filter(x=>Number(x.id)!==id);
      save(); render(); return;
    }

    const f = e.target.dataset.field;
    if(!f) return;
    const v = e.target.value;
    if(['price','discount','qty','bonus'].includes(f)) row[f] = num(v);
    else row[f] = v;
    save(); render();
  }

  $('themeBtn').addEventListener('click',toggleTheme);
  $('addBtn').addEventListener('click',add);
  $('sampleBtn').addEventListener('click',sample);
  $('resetBtn').addEventListener('click',reset);
  $('rows').addEventListener('input',onTable);
  $('rows').addEventListener('change',onTable);
  $('rows').addEventListener('click',onTable);

  initTheme();
  render();
})();
</script>
</body>
</html>
